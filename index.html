<!DOCTYPE html>
<html lang="fr" data-theme="dark"> <!-- Le thème est géré par JS, dark est le fallback -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>L'Éclairage Urbain : Des Lumières de la Ville aux Smart Cities</title>
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cstyle%3Epath %7B fill: %233498db; %7D @media (prefers-color-scheme: dark) %7B path %7B fill: %23f7b733; %7D %7D%3C/style%3E%3Cpath d='M44,87.5 C44,90.261 46.239,92.5 49,92.5 L51,92.5 C53.761,92.5 56,90.261 56,87.5 L56,83.5 L44,83.5 L44,87.5 Z M66.3,74.7 C66.3,74.7 75,66.9 75,54.5 C75,41.512 64.988,31.5 52,31.5 L48,31.5 C35.012,31.5 25,41.512 25,54.5 C25,66.9 33.7,74.7 33.7,74.7 L33.7,79.5 L66.3,79.5 L66.3,74.7 Z'/%3E%3C/svg%3E" type="image/svg+xml">

    <style>
        /* --- GESTION DES THÈMES --- */
        :root {
            --primary-color: #f7b733; --primary-color-rgb: 247, 183, 51;
            --secondary-color: #fc4a1a; --accent-color: #4abdac;
            --success-color: #27ae60; --error-color: #e74c3c;
            --bg-color: #1B263B; --card-bg: #233142; --main-text-color: #E0E1DD;
            --secondary-text-color: #A0A0A0; --footer-text-color: rgba(224, 225, 221, 0.5);
            --glass-bg: rgba(35, 49, 66, 0.8); --glass-border: rgba(224, 225, 221, 0.2);
            --card-shadow: rgba(0, 0, 0, 0.4); --card-shadow-hover: rgba(0, 0, 0, 0.5);
            --option-bg: rgba(224, 225, 221, 0.05); --option-hover-bg: rgba(224, 225, 221, 0.1);
            --progress-track-bg: #1B263B; --tooltip-bg: #222;
        }
        html[data-theme='light'] {
            --primary-color: #3498db; --primary-color-rgb: 52, 152, 219;
            --secondary-color: #2980b9; --bg-color: #f4f6f8;
            --card-bg: #ffffff; --main-text-color: #2c3e50; --secondary-text-color: #6c757d;
            --footer-text-color: rgba(0, 0, 0, 0.5); --glass-bg: rgba(255, 255, 255, 0.85);
            --glass-border: rgba(0, 0, 0, 0.1); --card-shadow: rgba(44, 62, 80, 0.15);
            --card-shadow-hover: rgba(44, 62, 80, 0.25);
            --option-bg: rgba(52, 152, 219, 0.05); --option-hover-bg: rgba(52, 152, 219, 0.1);
            --progress-track-bg: #e9ecef; --tooltip-bg: #34495e;
        }

        /* --- STYLES GÉNÉRAUX --- */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            line-height: 1.6; color: var(--main-text-color); background-color: var(--bg-color);
            min-height: 100vh; padding-bottom: 20px; transition: background-color 0.3s ease, color 0.3s ease;
        }
        .container { max-width: 1000px; margin: 0 auto; padding: 20px; }
        html[data-theme='dark'] strong, html[data-theme='dark'] b { color: var(--primary-color); }

        /* --- HEADER & INTERRUPTEUR DE THÈME --- */
        .header {
            text-align: center; background: var(--card-bg); padding: 30px; border-radius: 20px;
            margin-bottom: 30px; box-shadow: 0 15px 35px var(--card-shadow);
            border: 1px solid var(--glass-border); transition: background-color 0.3s ease, border-color 0.3s ease;
        }
        .header h1 { 
            color: var(--primary-color); font-size: 2.5em; margin-bottom: 15px;
            text-shadow: 0 2px 10px rgba(var(--primary-color-rgb), 0.3);
        }
        html[data-theme='light'] .header h1 { color: var(--main-text-color); text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.2); }
        .header-meta { display: flex; justify-content: space-between; align-items: center; margin-top: 15px; gap: 20px; flex-wrap: wrap; }
        .header-info { flex: 1; text-align: left; }
        .header-info p { margin: 0; color: var(--main-text-color); }
        .header-info .time-badge { background: rgba(var(--primary-color-rgb), 0.15); padding: 2px 8px; border-radius: 10px; margin-left: 8px; font-weight: bold; color: var(--primary-color);}
        .header-info .subtext { margin-top: 5px; color: var(--secondary-text-color); font-size: 0.9em; }
        .header-action { display: flex; align-items: center; gap: 20px; }
        .header-action .video-link-header { display: inline-flex; align-items: center; gap: 8px; padding: 10px 20px; background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); color: white; text-decoration: none; border-radius: 25px; font-weight: bold; transition: transform 0.3s ease, box-shadow 0.3s ease; font-size: 0.9em; }
        .header-action .video-link-header:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(var(--primary-color-rgb), 0.5); }
        .theme-switch { display: flex; align-items: center; gap: 10px; cursor: pointer; }
        .theme-switch-label { font-size: 1.2rem; color: var(--secondary-text-color); transition: color 0.3s ease; }
        .theme-switch input { display: none; }
        .switch-track { position: relative; width: 50px; height: 26px; background-color: var(--card-bg); border: 1px solid var(--glass-border); border-radius: 13px; transition: background-color 0.3s ease; }
        .switch-thumb { position: absolute; top: 2px; left: 2px; width: 20px; height: 20px; background-color: var(--secondary-text-color); border-radius: 50%; transition: transform 0.3s ease, background-color 0.3s ease; }
        .theme-switch input:checked + .switch-track .switch-thumb { transform: translateX(24px); background-color: var(--primary-color); }
        #sun-icon { display: none; }
        html[data-theme='light'] #moon-icon { display: none; }
        html[data-theme='light'] #sun-icon { display: block; }

        /* --- WIDGETS FLOTTANTS & UI --- */
        .floating-widget {
            position: fixed; padding: 10px 15px; background: var(--glass-bg); backdrop-filter: blur(5px);
            border: 1px solid var(--glass-border); color: var(--main-text-color); border-radius: 20px;
            box-shadow: 0 4px 15px var(--card-shadow); font-size: 0.9em; z-index: 1001;
            transition: all 0.3s ease;
        }
        .live-score { top: 20px; left: 20px; cursor: pointer; display: flex; flex-direction: column; align-items: flex-start; gap: 5px; padding: 12px; }
        .live-score:hover { transform: translateY(-3px); box-shadow: 0 8px 25px var(--card-shadow-hover); }
        #score-text { font-weight: bold; font-size: 1.1em; }
        #currentScore.updated { animation: score-pop 0.5s ease-out; }
        @keyframes score-pop { 0% { transform: scale(1); } 50% { transform: scale(1.5); color: var(--primary-color); } 100% { transform: scale(1); } }
        .timer-widget { top: 20px; right: 20px; display: flex; align-items: center; gap: 8px; }
        .timer-widget .timer-icon { font-size: 1.2em; }
        #timerDisplay { font-weight: bold; font-family: 'Courier New', Courier, monospace; letter-spacing: 1px; }

        .accuracy-container { display: flex; align-items: center; gap: 8px; width: 100%; }
        .accuracy-bar-track { flex-grow: 1; height: 8px; background-color: var(--progress-track-bg); border-radius: 4px; overflow: hidden; }
        .accuracy-bar-fill { height: 100%; width: 0%; background-color: var(--accent-color); border-radius: 4px; transition: width 0.5s ease-out; }
        .precision-stars { line-height: 1; }
        .precision-stars .star { font-size: 1.2em; color: var(--secondary-text-color); transition: color 0.4s ease, transform 0.4s ease; }
        @keyframes star-pop-in { 0% { transform: scale(0) rotate(-180deg); opacity: 0; } 60% { transform: scale(1.2) rotate(10deg); opacity: 1; } 100% { transform: scale(1) rotate(0deg); } }
        .precision-stars .star.filled { color: var(--primary-color); transform: scale(1.1); animation: star-pop-in 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }
        
        .keyboard-hint { bottom: 20px; left: 20px; display: flex; align-items: center; border-radius: 25px; cursor: pointer; overflow: hidden; width: 45px; height: 45px; padding: 0; transition: width 0.4s ease-in-out; }
        .keyboard-hint:hover { width: 400px; }
        .hint-icon { font-size: 1.6em; flex-shrink: 0; width: 45px; height: 45px; display: flex; align-items: center; justify-content: center; }
        .hint-text { white-space: nowrap; padding-right: 15px; opacity: 0; transition: opacity 0.3s 0.1s; font-size: 0.9em; }
        .keyboard-hint:hover .hint-text { opacity: 1; }

        .resume-notification { top: 80px; left: 20px; display: none; cursor: pointer; border-color: var(--primary-color); }
        .resume-notification:hover { background-color: var(--option-hover-bg); }
        .resume-notification.show { display: block; }
        
        .review-banner { display: none; background: rgba(74, 189, 172, 0.15); border-left: 4px solid var(--accent-color); padding: 10px 15px; margin-bottom: 20px; border-radius: 8px; font-size: 0.9em; text-align: center; }
        .question-card.review-mode-active .review-banner { display: block; }

        /* --- PROGRESSION & QUESTIONS --- */
        .progress-container { background: var(--card-bg); padding: 20px; border-radius: 15px; margin-bottom: 20px; border: 1px solid var(--glass-border); transition: background-color 0.3s ease, border-color 0.3s ease; }
        .progress-header { display: flex; justify-content: space-between; align-items: baseline; margin-bottom: 10px; }
        .progress-track { position: relative; width: 100%; height: 20px; margin: 15px 0; }
        .progress-bar { width: 100%; height: 6px; background: var(--progress-track-bg); border-radius: 3px; position: absolute; top: 50%; transform: translateY(-50%); }
        .progress-fill { height: 100%; background: linear-gradient(90deg, var(--primary-color), var(--secondary-color)); border-radius: 3px; transition: width 0.3s ease; width: 0%; z-index: 1; position: relative; }
        .progress-dots { display: flex; justify-content: space-between; align-items: center; width: 100%; position: absolute; top: 50%; transform: translateY(-50%); z-index: 2; }
        .progress-dot { width: 14px; height: 14px; background-color: var(--secondary-text-color); border-radius: 50%; transition: all 0.3s; position: relative; border: 3px solid var(--card-bg); cursor: not-allowed; }
        .progress-dot::after { content: attr(data-tooltip); position: absolute; bottom: 150%; left: 50%; transform: translateX(-50%); background-color: var(--tooltip-bg); color: white; padding: 5px 10px; border-radius: 5px; font-size: 0.8em; white-space: nowrap; opacity: 0; visibility: hidden; transition: opacity 0.3s, visibility 0.3s; pointer-events: none; z-index: 10; }
        .progress-dot.clickable:hover::after { opacity: 1; visibility: visible; }
        .progress-dot.clickable { cursor: pointer; }
        .progress-dot.completed-correct { background-color: var(--success-color); }
        .progress-dot.completed-incorrect { background-color: var(--error-color); }
        .progress-dot.active { background-color: var(--primary-color); border-color: var(--primary-color); transform: scale(1.2); box-shadow: 0 0 12px var(--primary-color); }
        
        .info-box { position: relative; background: var(--option-bg); padding: 12px 12px 12px 40px; border-radius: 8px; margin-top: 20px; border-left: 3px solid var(--accent-color); font-size: 0.9em; text-align: left; }
        .info-box::before { content: '💡'; position: absolute; left: 12px; top: 12px; font-size: 1.2em; }
        
        .question-card {
            background: var(--card-bg); padding: 30px; border-radius: 20px; margin-bottom: 30px; 
            box-shadow: 0 10px 30px var(--card-shadow); display: none;
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }
        .question-card.active { display: block; animation: slideInUp 0.5s ease-out forwards; }
        .question-card.slide-out { animation: slideOutUp 0.4s ease-in forwards; }
        @keyframes slideInUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slideOutUp { from { opacity: 1; transform: translateY(0); } to { opacity: 0; transform: translateY(-30px); } }
        
        .question-header { display: flex; align-items: center; margin-bottom: 20px; justify-content: space-between; }
        .question-header-left { display: flex; align-items: center; }
        .question-number { background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); color: white; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; margin-right: 15px; flex-shrink: 0;}
        .question-category { background: var(--option-bg); color: var(--main-text-color); padding: 5px 15px; border-radius: 20px; font-size: 0.9em; font-weight: bold; }
        .question-title { font-size: 1.4em; color: var(--main-text-color); margin: 15px 0; border-radius: 5px; transition: box-shadow 0.2s ease-out; }
        .question-title:focus-visible { outline: none; box-shadow: 0 0 0 3px rgba(var(--primary-color-rgb), 0.4); }

        .options { margin: 20px 0; }
        .option { display: flex; align-items: center; background: var(--option-bg); padding: 15px; margin: 10px 0; border-radius: 10px; cursor: pointer; transition: background-color 0.3s, transform 0.3s, border-color 0.3s; border: 2px solid transparent; }
        .option-number { font-weight: bold; color: var(--primary-color); border: 2px solid var(--primary-color); border-radius: 50%; width: 24px; height: 24px; display: inline-flex; justify-content: center; align-items: center; margin-right: 15px; flex-shrink: 0; transition: transform 0.2s; }
        .option:hover .option-number { transform: scale(1.2); }
        .option:hover { background: var(--option-hover-bg); transform: translateX(5px); }
        .option.selected { background-color: rgba(var(--primary-color-rgb), 0.2); border-color: var(--primary-color); }
        .option.correct { background: rgba(39, 174, 96, 0.2); border-color: var(--success-color); }
        .option.correct .option-number { background-color: var(--success-color); color: white; border-color: var(--success-color); }
        .option.correct.glow { animation: glow-correct 1.5s ease-out; }
        @keyframes glow-correct { 0% { box-shadow: 0 0 0px var(--success-color); } 50% { box-shadow: 0 0 15px var(--success-color); } 100% { box-shadow: 0 0 0px var(--success-color); } }
        .option.incorrect { background: rgba(231, 76, 60, 0.2); border-color: var(--error-color); }
        .option.incorrect .option-number { background-color: var(--error-color); color: white; border-color: var(--error-color); }
        .option.disabled { cursor: not-allowed; opacity: 0.7; }
        .option.disabled:hover { transform: none; background: var(--option-bg); }
        .option.disabled:hover .option-number { transform: none; }

        .feedback { margin: 20px 0; padding: 20px; border-radius: 10px; display: none; border-left-width: 5px; border-left-style: solid;}
        .feedback.show { display: block; animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .feedback.correct { background: rgba(39, 174, 96, 0.15); border-left-color: var(--success-color); }
        .feedback.incorrect { background: rgba(231, 76, 60, 0.15); border-left-color: var(--error-color); }
        .feedback-title { font-weight: bold; font-size: 1.1em; margin-bottom: 8px; }
        .feedback-explanation { margin-bottom: 15px; }
        
        .calculation-breakdown { background: var(--option-bg); padding: 10px 15px; border-radius: 8px; margin-top: 10px; font-family: 'Courier New', Courier, monospace; font-size: 0.95em; border-left: 3px solid var(--primary-color); }
        .context-box { background: rgba(var(--primary-color-rgb), 0.1); border-left: 5px solid var(--primary-color); padding: 15px; margin: 15px 0; border-radius: 5px; }
        
        .nav-buttons { display: flex; gap: 10px; }
        .btn-nav {
            background: var(--glass-bg); backdrop-filter: blur(5px); border: 1px solid var(--glass-border); 
            color: var(--main-text-color); width: 45px; height: 45px; border-radius: 50%; font-size: 1.4em;
            transition: all 0.2s ease-out; display: flex; align-items: center; justify-content: center;
        }
        .btn-nav:not(:disabled) { cursor: pointer; }
        .btn-nav:not(:disabled):hover { background: var(--option-hover-bg); transform: scale(1.1); }
        .btn-nav:not(:disabled):active { transform: scale(0.95); transition-duration: 0.1s; }
        .btn-nav:disabled { opacity: 0.4; cursor: not-allowed; backdrop-filter: none; }
        #nextBtn:not(:disabled) {
             background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
             color: white; border: none;
             box-shadow: 0 0 10px rgba(var(--primary-color-rgb), 0.4);
        }
        .nav-buttons.review-mode-active #nextBtn { /* Style neutre en mode révision */
            background: var(--glass-bg); color: var(--main-text-color);
            border: 1px solid var(--glass-border); box-shadow: none;
        }

        /* --- ÉCRAN DE RÉSULTATS --- */
        .results {
            text-align: center; padding: 30px; background: var(--card-bg); border-radius: 20px; 
            display: none; position: relative; transition: background-color 0.3s ease;
        }
        .results.show { display: block; animation: zoomIn 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes zoomIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
        .score-circle { width: 150px; height: 150px; border-radius: 50%; margin: 20px auto; display: flex; align-items: center; justify-content: center; font-size: 2em; font-weight: bold; transition: background 0.5s ease, color 0.5s ease; }
        .results-summary { margin-top: 30px; text-align: left; }
        .summary-item { display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid var(--glass-border); font-size: 0.9em; cursor: pointer; transition: background-color 0.2s; }
        .summary-item:hover { background-color: var(--option-hover-bg); }
        .summary-item:last-child { border-bottom: none; }
        .summary-result { font-weight: bold; padding: 3px 8px; border-radius: 12px; color: white; }
        .summary-result.correct { background-color: var(--success-color); }
        .summary-result.incorrect { background-color: var(--error-color); }
        .score-title { font-size: 1.5em; margin-top: 15px; color: var(--main-text-color); }
        
        .key-takeaways { margin: 30px 0; padding: 20px; background: rgba(74, 189, 172, 0.1); border-left: 4px solid var(--accent-color); border-radius: 8px; text-align: left; }
        .key-takeaways ul { list-style-type: '✓ '; padding-left: 20px; }
        .key-takeaways li { margin-bottom: 10px; }
        
        .badges-earned-container { margin: 30px 0; padding: 20px; background: rgba(var(--primary-color-rgb), 0.1); border-left: 4px solid var(--primary-color); border-radius: 8px; text-align: left; }
        #badges-earned { display: flex; flex-wrap: wrap; gap: 15px; }
        .badge-earned-item { display: flex; flex-direction: column; align-items: center; width: 80px; }
        .badge-earned-item .badge-icon { font-size: 2.5em; }
        .badge-earned-item p { font-size: 0.8em; text-align: center; margin-top: 5px; }
        
        .results-actions { display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; margin-top: 30px; }
        .btn { padding: 12px 30px; border: none; border-radius: 25px; cursor: pointer; font-weight: bold; transition: transform 0.3s ease, box-shadow 0.3s, background-color 0.3s; }
        .btn:active { transform: translateY(-1px) scale(0.98); }
        .btn-primary { background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); color: white; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(var(--primary-color-rgb), 0.4); }
        .btn-secondary { background: var(--secondary-text-color); color: var(--bg-color); }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; box-shadow: none; }

        /* --- MODAL --- */
        .modal-overlay { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.5); backdrop-filter: blur(5px);
            z-index: 2000; display: none; align-items: center; justify-content: center;
            opacity: 0; transition: opacity 0.3s ease-out;
        }
        html[data-theme='light'] .modal-overlay { background: rgba(244, 246, 248, 0.7); }
        .modal-overlay.show { display: flex; opacity: 1; }
        .stats-modal { 
            background: var(--card-bg); color: var(--main-text-color); padding: 30px; 
            border-radius: 20px; width: 90%; max-width: 600px; 
            box-shadow: 0 10px 30px var(--card-shadow); position: relative; 
            transition: background-color 0.3s ease, color 0.3s ease;
            transform: scale(0.95); opacity: 0;
        }
        .modal-overlay.show .stats-modal { animation: modal-fade-in 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }
        .modal-overlay.hiding .stats-modal { animation: modal-fade-out 0.3s ease-out forwards; }
        @keyframes modal-fade-in { to { transform: scale(1); opacity: 1; } }
        @keyframes modal-fade-out { from { transform: scale(1); opacity: 1; } to { transform: scale(0.95); opacity: 0; } }
        .modal-close-btn { position: absolute; top: 15px; right: 15px; background: var(--option-hover-bg); color: var(--main-text-color); border: none; border-radius: 50%; width: 30px; height: 30px; font-size: 1.2em; cursor: pointer; transition: background-color 0.3s, transform 0.3s; }
        .modal-close-btn:hover { transform: rotate(90deg); }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 20px; text-align: center; margin: 20px 0; }
        .stat-item h4 { color: var(--primary-color); }
        .badges-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 15px; }
        .badge { text-align: center; }
        .badge-icon { font-size: 3em; border-radius: 50%; background: var(--option-bg); color: var(--secondary-text-color); width: 70px; height: 70px; display: flex; align-items: center; justify-content: center; margin: 0 auto; transition: all 0.4s ease; }
        .badge-icon.unlocked { background: var(--primary-color); color: white; transform: scale(1.1); box-shadow: 0 0 15px var(--primary-color); }
        .badge p { font-size: 0.8em; margin-top: 5px; font-weight: bold; }
        .reset-button-container { text-align: center; margin-top: 25px; border-top: 1px solid var(--glass-border); padding-top: 20px; }
        .reset-button-container p { font-size: 0.9em; color: var(--secondary-text-color); margin-bottom: 10px; }
        
        /* --- STYLES RESTANTS (COPIÉS) --- */
        #confetti-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; overflow: hidden; pointer-events: none; z-index: 10; }
        .confetti { position: absolute; width: 10px; height: 10px; background-color: #f00; opacity: 1; animation: fall 5s linear forwards; }
        @keyframes fall { to { transform: translateY(110vh) rotate(720deg); opacity: 0; } }
        .interactive-question-container { display: flex; flex-wrap: wrap; gap: 20px; margin-top: 20px; user-select: none; }
        .draggable-item { background: var(--card-bg); padding: 10px; border-radius: 8px; cursor: grab; text-align: center; border: 2px solid var(--primary-color); transition: background-color 0.3s, border-color 0.3s, opacity 0.2s; color: var(--main-text-color); }
        html[data-theme='light'] .draggable-item { background: #e9ecef; }
        .draggable-item:active { cursor: grabbing; opacity: 0.8; }
        .dropzone { flex: 1; min-height: 50px; background: var(--progress-track-bg); border: 2px dashed var(--secondary-text-color); border-radius: 10px; display: flex; align-items: center; justify-content: center; transition: background-color 0.3s; }
        html[data-theme='light'] .dropzone.over { background-color: #dee2e6; }
        html[data-theme='dark'] .dropzone.over { background-color: #2c3e50; }
        .dropzone.correct-drop .draggable-item { border-color: var(--success-color); background-color: rgba(39, 174, 96, 0.2); }
        .dropzone.incorrect-drop .draggable-item { border-color: var(--error-color); background-color: rgba(231, 76, 60, 0.2); }
        .interactive-question-container.disabled .draggable-item { cursor: not-allowed; }
        .interactive-question-container.disabled .dropzone, .interactive-question-container.disabled .timeline-events { pointer-events: none; opacity: 0.8; }
        .timeline-container .timeline-events { flex: 1; min-width: 200px; border: 2px dashed var(--secondary-text-color); border-radius: 10px; padding: 10px; display: flex; flex-direction: column; gap: 10px; transition: background-color 0.3s;}
        .timeline-slots { flex: 2; min-width: 300px; }
        .timeline-slot { display: flex; align-items: center; margin-bottom: 10px; }
        .timeline-year { font-weight: bold; width: 100px; color: var(--main-text-color); }
        .question-image { max-width: 250px; border-radius: 10px; margin: 15px auto; display: block; box-shadow: 0 4px 10px var(--card-shadow); }
        .sorting-container { display: flex; flex-direction: column; gap: 20px; }
        .sorting-bins { display: flex; gap: 20px; flex-wrap: wrap; }
        .sorting-bin { flex: 1; min-width: 250px; padding: 10px; border: 2px solid var(--secondary-text-color); border-radius: 10px; }
        .sorting-bin h4 { text-align: center; margin-bottom: 10px; color: var(--main-text-color); }
        .sorting-bin .dropzone { flex-direction: column; gap: 8px; min-height: 100px; align-items: stretch; padding: 8px;}
        .sorting-source-list { display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; padding: 10px; border: 2px dashed var(--secondary-text-color); border-radius: 10px; margin-top: 10px; }
        .smart-lamppost-builder { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; margin-top: 20px; }
        .feature-option { background: var(--option-bg); padding: 15px; border-radius: 10px; border: 2px solid var(--secondary-text-color); cursor: pointer; text-align: center; transition: transform 0.3s, box-shadow 0.3s, border-color 0.3s, background-color 0.3s; }
        .feature-option:hover, .feature-option:focus-visible { transform: translateY(-3px); box-shadow: 0 4px 8px var(--card-shadow); outline: 2px solid var(--primary-color); }
        .feature-option.selected { border-color: var(--primary-color); background-color: rgba(var(--primary-color-rgb), 0.2); box-shadow: 0 4px 8px rgba(0,0,0,0.15); }
        .feature-option.disabled { cursor: not-allowed; opacity: 0.7; }
        .feature-option.disabled:hover, .feature-option.disabled:focus-visible { transform: none; box-shadow: none; outline: none; }
        .feature-icon { font-size: 2.5em; margin-bottom: 10px; color: var(--primary-color); }
        #q17-description-box { margin-top: 20px; display: none; }
        #q17-description-box ul { list-style-type: none; padding-left: 0; }
        #q17-description-box li { margin-bottom: 8px; }
        .video-container { position: fixed; bottom: 70px; right: 20px; width: 320px; background: var(--glass-bg); border: 1px solid var(--glass-border); border-radius: 15px; box-shadow: 0 8px 32px var(--card-shadow); z-index: 1000; transition: all 0.4s ease-in-out; overflow: hidden; }
        .video-container:not(.minimized):hover { transform: scale(1.03); box-shadow: 0 12px 40px var(--card-shadow-hover); }
        .video-container.minimized { width: 60px; height: 60px; border-radius: 50%; background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); box-shadow: 0 5px 15px rgba(0,0,0,0.3); border: 2px solid rgba(255, 255, 255, 0.5); padding: 0; cursor: pointer; }
        .video-container.minimized:hover { transform: scale(1.1); box-shadow: 0 8px 25px var(--card-shadow-hover); }
        .video-header { background: linear-gradient(135deg, rgba(var(--primary-color-rgb), 0.8), rgba(252, 74, 26, 0.8)); color: white; padding: 10px 15px; font-weight: bold; display: flex; justify-content: space-between; align-items: center; cursor: pointer; user-select: none; height: auto; }
        html[data-theme='light'] .video-header { background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); }
        .video-container.minimized .video-header { background: transparent; justify-content: center; align-items: center; height: 100%; padding: 0; }
        .video-controls button { background: rgba(255,255,255,0.2); border: none; color: white; width: 24px; height: 24px; border-radius: 50%; cursor: pointer; transition: background 0.3s ease; }
        .video-controls button:hover { background: rgba(255,255,255,0.4); }
        .video-content { padding: 15px; }
        .video-player-container { width: 100%; height: 160px; background-image: url('https://i.ytimg.com/vi/GRwOsXCW2jM/hqdefault.jpg'); background-size: cover; background-position: center; cursor: pointer; border-radius: 8px; display: flex; align-items: center; justify-content: center; position: relative; }
        .video-player-container .play-icon { font-size: 3em; color: white; text-shadow: 0 0 15px rgba(0,0,0,0.7); }
        .video-player-container iframe { width: 100%; height: 100%; border: none; border-radius: 8px; }
        .video-container.minimized .video-title, .video-container.minimized .video-controls, .video-container.minimized .video-content { display: none; }
        .dynamic-icon { transition: transform 0.3s ease; display: inline-block; font-size: 1.8em; }
        #toast-container { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); z-index: 9999; display: flex; flex-direction: column-reverse; gap: 10px; align-items: center; pointer-events: none;}
        .toast { display: flex; align-items: center; gap: 15px; background: #222; color: white; padding: 12px 20px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.3); animation: toast-in-out 4s ease-in-out forwards; }
        html[data-theme='light'] .toast { background: #34495e; }
        @keyframes toast-in-out { 0% { transform: translateY(100px) scale(0.9); opacity: 0; } 15% { transform: translateY(0) scale(1); opacity: 1; } 85% { transform: translateY(0) scale(1); opacity: 1; } 100% { transform: translateY(100px) scale(0.9); opacity: 0; } }
        footer { text-align: center; padding: 10px 20px; color: var(--footer-text-color); font-size: 0.9em; margin-top: 20px; transition: color 0.3s ease; }
        .tooltip { position: relative; border-bottom: 1px dotted var(--primary-color); cursor: help; }
        .tooltip .tooltip-text { visibility: hidden; width: 220px; background-color: var(--tooltip-bg); color: #fff; text-align: center; border-radius: 6px; padding: 8px; position: absolute; z-index: 100; bottom: 125%; left: 50%; margin-left: -110px; opacity: 0; transition: opacity 0.3s; font-size: 0.9em; font-weight: normal; }
        .tooltip .tooltip-text::after { content: ""; position: absolute; top: 100%; left: 50%; margin-left: -5px; border-width: 5px; border-style: solid; border-color: var(--tooltip-bg) transparent transparent transparent; }
        .tooltip:hover .tooltip-text { visibility: visible; opacity: 1; }
        
        @media (max-width: 768px) {
            .video-container { width: 280px; }
            .live-score, .keyboard-hint, .resume-notification, .timer-widget { font-size: 0.8em; padding: 8px 12px; }
            .timer-widget { top: 90px; right: auto; left: 20px; }
            .resume-notification { top: 150px; left: 20px; }
            .keyboard-hint:hover { max-width: 300px; }
        }
    </style>
</head>
<body>
    <div class="live-score floating-widget" id="liveScore" aria-live="polite" onclick="openStatsModal()">
        <span id="score-text">📊 Score : <span id="currentScore">0</span> / <span id="totalQuestionsDisplay">20</span></span>
        <div class="accuracy-container">
            <div class="accuracy-bar-track"><div class="accuracy-bar-fill" id="accuracyBarFill"></div></div>
            <span class="precision-stars" id="precisionStars"><span>☆</span><span>☆</span><span>☆</span></span>
        </div>
    </div>
    
    <div class="timer-widget floating-widget" id="timerWidget">
        <span class="timer-icon">⏱️</span>
        <span id="timerDisplay">00:00</span>
    </div>

    <div class="keyboard-hint floating-widget" id="keyboardHint">
        <span class="hint-icon">💡</span>
        <span class="hint-text">Astuce : Touches [1]-[4] pour répondre, [→] pour continuer.</span>
    </div>
    <div class="resume-notification floating-widget" id="resumeNotification">🔄 Reprendre la session précédente</div>

    <div class="container">
        <header class="header">
            <h1>L'Éclairage Urbain : Des Lumières de la Ville aux Smart Cities</h1>
            <div class="header-meta">
                <div class="header-info">
                    <p><strong>Objectif :</strong> Comprendre l'évolution de l'éclairage urbain<span class="time-badge">⏱️ ~20-25 min</span></p>
                    <p class="subtext">Histoire → Technologies → Innovations 2024-2025</p>
                </div>
                <div class="header-action">
                    <label for="theme-toggle-switch" class="theme-switch" title="Changer de thème">
                        <span class="theme-switch-label" id="moon-icon">🌙</span>
                        <span class="theme-switch-label" id="sun-icon">☀️</span>
                        <input type="checkbox" id="theme-toggle-switch">
                        <div class="switch-track"><div class="switch-thumb"></div></div>
                    </label>
                    <a href="https://youtu.be/GRwOsXCW2jM" target="_blank" class="video-link-header" title="C'est Pas Sorcier - Lumières de la ville (26 minutes)">
                        🎬 Vidéo source (26min)
                    </a>
                </div>
            </div>
        </header>

        <div class="progress-container">
            <div class="progress-header">
                <h3>Progression</h3>
                <p id="progressText">Question 1 / 20</p>
            </div>
            <div class="progress-track">
                <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
                <div class="progress-dots" id="progressDots"></div>
            </div>
            <div class="info-box">
                Depuis la vidéo, la technologie a bondi ! Si elle montre les lampes à décharge, aujourd'hui c'est la <span class="tooltip">LED<span class="tooltip-text">Diode Électroluminescente. Source lumineuse très efficace et durable.</span></span> qui domine. Les villes évoluent vers les <strong>Smart Cities</strong>, utilisant capteurs et IA pour un éclairage intelligent.
            </div>
        </div>
        
        <div id="questions-wrapper">
            <div class="question-card" data-question="1"><div class="review-banner">🧐 <strong>Mode Révision :</strong> Vous consultez vos réponses.</div><div class="question-header"><div class="question-header-left"><div class="question-number">1</div><div class="question-category">Histoire</div></div></div><h2 class="question-title" tabindex="-1">Quel type d'éclairage dominait les villes jusqu'au XIXème siècle ?</h2><div class="options" role="radiogroup"><div class="option" data-answer="a" role="radio"><span class="option-number">1</span>L'éclairage électrique</div><div class="option" data-answer="b" role="radio"><span class="option-number">2</span>L'éclairage au gaz</div><div class="option" data-answer="c" role="radio"><span class="option-number">3</span>L'éclairage solaire</div><div class="option" data-answer="d" role="radio"><span class="option-number">4</span>L'éclairage LED</div></div><div class="feedback" id="feedback1" tabindex="-1"><p class="feedback-title">Réponse : L'éclairage au gaz</p><p class="feedback-explanation">Avant l'avènement de l'électricité, le gaz de ville, produit par la distillation de la houille, était la principale source d'éclairage public.</p><div class="context-box"><h4>📚 Contexte</h4><p>Paris fut l'une des premières villes au monde à adopter l'éclairage public au gaz à grande échelle vers 1820, lui valant son surnom de "Ville Lumière".</p></div></div></div>
            <div class="question-card" data-question="2"><div class="review-banner">🧐 <strong>Mode Révision :</strong> Vous consultez vos réponses.</div><div class="question-header"><div class="question-header-left"><div class="question-number">2</div><div class="question-category">Technologie</div></div></div><h2 class="question-title" tabindex="-1">En quelle année Thomas Edison a-t-il présenté sa première lampe à incandescence durable au public ?</h2><div class="options" role="radiogroup"><div class="option" data-answer="a" role="radio"><span class="option-number">1</span>1879</div><div class="option" data-answer="b" role="radio"><span class="option-number">2</span>1881</div><div class="option" data-answer="c" role="radio"><span class="option-number">3</span>1885</div><div class="option" data-answer="d" role="radio"><span class="option-number">4</span>1890</div></div><div class="feedback" id="feedback2" tabindex="-1"><p class="feedback-title">Réponse : 1879</p><p class="feedback-explanation">C'est fin 1879 que Thomas Edison a fait la démonstration publique de sa lampe, qui pouvait briller pendant plus de 13 heures, une révolution pour l'époque.</p><div class="context-box"><h4>⚡ Révolution</h4><p>La lampe d'Edison utilisait un filament de bambou carbonisé dans une ampoule sous vide, ouvrant la voie à l'éclairage électrique domestique et public.</p></div></div></div>
            <div class="question-card" data-question="3"><div class="review-banner">🧐 <strong>Mode Révision :</strong> Vous consultez vos réponses.</div><div class="question-header"><div class="question-header-left"><div class="question-number">3</div><div class="question-category">Infrastructure</div></div></div><h2 class="question-title" tabindex="-1">Combien de points lumineux parsèment Paris (chiffre de l'épisode) ?</h2><div class="options"><div class="option" data-answer="a"><span class="option-number">1</span>50 000</div><div class="option" data-answer="b"><span class="option-number">2</span>100 000</div><div class="option" data-answer="c"><span class="option-number">3</span>150 000</div><div class="option" data-answer="d"><span class="option-number">4</span>200 000</div></div><div class="feedback" id="feedback3" tabindex="-1"><p class="feedback-title">Réponse : 150 000 points lumineux</p><p class="feedback-explanation">À l'époque du tournage, Paris comptait ce nombre impressionnant de sources lumineuses pour assurer l'éclairage de ses rues et monuments.</p><div class="context-box"><h4>🔧 Maintenance</h4><p>Aujourd'hui, ce chiffre a évolué et une grande partie de ce parc est convertie en <span class="tooltip">LED<span class="tooltip-text">Diode Électroluminescente.</span></span> et gérée par des systèmes de télégestion pour optimiser la consommation et la maintenance.</p></div></div></div>
            <div class="question-card" data-question="4"><div class="review-banner">🧐 <strong>Mode Révision :</strong> Vous consultez vos réponses.</div><div class="question-header"><div class="question-header-left"><div class="question-number">4</div><div class="question-category">Technique</div></div></div><h2 class="question-title" tabindex="-1">Selon Jamy, comment une lampe à incandescence produit-elle de la lumière ?</h2><div class="options"><div class="option" data-answer="a"><span class="option-number">1</span>Par combustion d'un gaz</div><div class="option" data-answer="b"><span class="option-number">2</span>En chauffant un filament jusqu'à l'incandescence</div><div class="option" data-answer="c"><span class="option-number">3</span>Par décharge électrique dans un tube</div><div class="option" data-answer="d"><span class="option-number">4</span>Par réaction chimique</div></div><div class="feedback" id="feedback4" tabindex="-1"><p class="feedback-title">Réponse : En chauffant un filament jusqu'à l'incandescence</p><p class="feedback-explanation">Le passage du courant électrique dans un filament (souvent en tungstène) le chauffe à une température si élevée qu'il émet de la lumière visible.</p><div class="context-box"><h4>💡 Inefficacité</h4><p>Ce procédé est très inefficace : plus de 90% de l'énergie est perdue sous forme de chaleur ! C'est pourquoi elles ont été remplacées par les LED.</p></div></div></div>
            <div class="question-card" data-question="5"><div class="review-banner">🧐 <strong>Mode Révision :</strong> Vous consultez vos réponses.</div><div class="question-header"><div class="question-header-left"><div class="question-number">5</div><div class="question-category">Ampoules</div></div></div><h2 class="question-title" tabindex="-1">Quelle est la différence principale entre une lampe classique et une lampe halogène ?</h2><div class="options"><div class="option" data-answer="a"><span class="option-number">1</span>La lampe halogène a un filament différent</div><div class="option" data-answer="b"><span class="option-number">2</span>La lampe halogène contient un gaz qui permet un filament plus chaud</div><div class="option" data-answer="c"><span class="option-number">3</span>La lampe halogène fonctionne sans électricité</div><div class="option" data-answer="d"><span class="option-number">4</span>La lampe halogène est plus grosse</div></div><div class="feedback" id="feedback5" tabindex="-1"><p class="feedback-title">Réponse : La lampe halogène contient un gaz</p><p class="feedback-explanation">L'ampoule contient un gaz halogéné (iode ou brome) qui, par un cycle chimique, redépose le tungstène évaporé sur le filament. Cela permet au filament de chauffer plus, produisant une lumière plus blanche et vive.</p><div class="context-box"><h4>🔬 Cycle Halogène</h4><p>Ce cycle prolonge la durée de vie de la lampe et améliore son efficacité par rapport à une lampe à incandescence standard, bien que toutes deux soient maintenant dépassées par les LED.</p></div></div></div>
            <div class="question-card" data-question="6"><div class="review-banner">🧐 <strong>Mode Révision :</strong> Vous consultez vos réponses.</div><div class="question-header"><div class="question-header-left"><div class="question-number">6</div><div class="question-category">Lampes à décharge</div></div></div><h2 class="question-title" tabindex="-1">Qu'est-ce qu'une lampe à décharge selon les explications de Jamy ?</h2><div class="options"><div class="option" data-answer="a"><span class="option-number">1</span>Une lampe qui se décharge comme une pile</div><div class="option" data-answer="b"><span class="option-number">2</span>Une lampe qui produit de la lumière par décharge électrique dans un gaz</div><div class="option" data-answer="c"><span class="option-number">3</span>Une lampe qui ne fonctionne que le jour</div><div class="option" data-answer="d"><span class="option-number">4</span>Une lampe sans filament</div></div><div class="feedback" id="feedback6" tabindex="-1"><p class="feedback-title">Réponse : Production de lumière par décharge électrique dans un gaz</p><p class="feedback-explanation">Contrairement à l'incandescence, cette technologie n'utilise pas de filament chauffé. Un arc électrique est créé entre deux électrodes, ce qui excite un gaz (sodium, mercure...) qui émet alors de la lumière.</p><div class="context-box"><h4>🚀 Remplacement massif</h4><p>Les lampadaires à la lumière orange caractéristique (lampes à sodium) sont un exemple typique de lampes à décharge. Ils sont massivement remplacés par des LED plus efficaces et polyvalentes.</p></div></div></div>
            <div class="question-card" data-question="7"><div class="review-banner">🧐 <strong>Mode Révision :</strong> Vous consultez vos réponses.</div><div class="question-header"><div class="question-header-left"><div class="question-number">7</div><div class="question-category">Environnement</div></div></div><h2 class="question-title" tabindex="-1">Quel est l'un des défis environnementaux majeurs de l'éclairage urbain ?</h2><div class="options"><div class="option" data-answer="a"><span class="option-number">1</span>Le manque de lumière</div><div class="option" data-answer="b"><span class="option-number">2</span>La pollution lumineuse et son impact sur la faune nocturne</div><div class="option" data-answer="c"><span class="option-number">3</span>Le coût trop faible</div><div class="option" data-answer="d"><span class="option-number">4</span>L'éclairage trop coloré</div></div><div class="feedback" id="feedback7" tabindex="-1"><p class="feedback-title">Réponse : La pollution lumineuse</p><p class="feedback-explanation">L'éclairage artificiel excessif ou mal dirigé crée un "halo lumineux" au-dessus des villes qui perturbe les écosystèmes, notamment les cycles de vie et de migration des animaux nocturnes (insectes, oiseaux, chauves-souris).</p><div class="context-box"><h4>🌙 Solutions Modernes</h4><p>Pour lutter contre ce phénomène, les villes utilisent des LED à teintes chaudes (ambrées, < 3000K), orientent la lumière uniquement vers le sol et mettent en place des systèmes de gradation pour réduire l'intensité en pleine nuit.</p></div></div></div>
            <div class="question-card" data-question="8"><div class="review-banner">🧐 <strong>Mode Révision :</strong> Vous consultez vos réponses.</div><div class="question-header"><div class="question-header-left"><div class="question-number">8</div><div class="question-category">Énergie alternative</div></div></div><h2 class="question-title" tabindex="-1">Quelle innovation surprenante permet d'alimenter l'éclairage de manière écologique ?</h2><div class="options"><div class="option" data-answer="a"><span class="option-number">1</span>Les batteries de sol utilisant les plantes</div><div class="option" data-answer="b"><span class="option-number">2</span>L'énergie du vent uniquement</div><div class="option" data-answer="c"><span class="option-number">3</span>Les hamsters dans des roues</div><div class="option" data-answer="d"><span class="option-number">4</span>L'énergie des voitures qui passent</div></div><div class="feedback" id="feedback8" tabindex="-1"><p class="feedback-title">Réponse : Les batteries de sol utilisant les plantes</p><p class="feedback-explanation">Des startups développent des technologies qui exploitent les micro-organismes présents dans le sol autour des racines des plantes. Ces microbes dégradent la matière organique et libèrent des électrons, créant un courant électrique.</p><div class="context-box"><h4>🧬 Biotechnologies</h4><p>Bien qu'encore expérimentale et à faible rendement, cette approche bio-inspirée montre une voie fascinante pour une énergie décentralisée et intégrée à l'environnement urbain.</p></div></div></div>
            <div class="question-card" data-question="9"><div class="review-banner">🧐 <strong>Mode Révision :</strong> Vous consultez vos réponses.</div><div class="question-header"><div class="question-header-left"><div class="question-number">9</div><div class="question-category">Smart Cities</div></div></div><h2 class="question-title" tabindex="-1">Dans une "ville intelligente", un lampadaire peut maintenant servir à :</h2><div class="options"><div class="option" data-answer="a"><span class="option-number">1</span>Seulement éclairer les rues</div><div class="option" data-answer="b"><span class="option-number">2</span>Mesurer la qualité de l'air, fournir du Wi-Fi et diffuser des infos</div><div class="option" data-answer="c"><span class="option-number">3</span>Uniquement décorer la ville</div><div class="option" data-answer="d"><span class="option-number">4</span>Remplacer les feux de circulation</div></div><div class="feedback" id="feedback9" tabindex="-1"><p class="feedback-title">Réponse : Mesurer la qualité de l'air, fournir du Wi-Fi...</p><p class="feedback-explanation">Le lampadaire, déjà alimenté et présent partout en ville, est devenu le support idéal pour une multitude de capteurs et services connectés.</p><div class="context-box"><h4>📱 Services connectés</h4><p>Ces "lampadaires 4.0" peuvent intégrer des bornes de recharge pour véhicules électriques, des caméras de sécurité, des capteurs de bruit ou de trafic, et même diffuser des informations via de petits écrans.</p></div></div></div>
            <div class="question-card" data-question="10"><div class="review-banner">🧐 <strong>Mode Révision :</strong> Vous consultez vos réponses.</div><div class="question-header"><div class="question-header-left"><div class="question-number">10</div><div class="question-category">Économies</div></div></div><h2 class="question-title" tabindex="-1">Quelle économie d'énergie peut réaliser une ville en passant à l'éclairage <span class="tooltip">LED<span class="tooltip-text">Diode Électroluminescente.</span></span> intelligent ?</h2><div class="options"><div class="option" data-answer="a"><span class="option-number">1</span>10 à 20%</div><div class="option" data-answer="b"><span class="option-number">2</span>30 à 40%</div><div class="option" data-answer="c"><span class="option-number">3</span>50 à 75%</div><div class="option" data-answer="d"><span class="option-number">4</span>90 à 100%</div></div><div class="feedback" id="feedback10" tabindex="-1"><p class="feedback-title">Réponse : 50 à 75%</p><p class="feedback-explanation">La combinaison de la haute efficacité des LED (par rapport aux anciennes lampes) et des systèmes de gestion intelligents (qui modulent l'intensité lumineuse selon les besoins) permet de réaliser des économies d'énergie très significatives.</p><div class="context-box"><h4>📈 Retour sur investissement</h4><p>Malgré un coût d'installation élevé, le retour sur investissement est rapide (souvent entre 3 et 7 ans) grâce aux économies sur la facture d'électricité et la réduction des coûts de maintenance.</p></div></div></div>
            <div class="question-card" data-question="11"><div class="review-banner">🧐 <strong>Mode Révision :</strong> Vous consultez vos réponses.</div><div class="question-header"><div class="question-header-left"><div class="question-number">11</div><div class="question-category">Innovations</div></div></div><h2 class="question-title" tabindex="-1">Quelle technologie de détection améliore la précision de l'éclairage adaptatif ?</h2><div class="options"><div class="option" data-answer="a"><span class="option-number">1</span>Les capteurs infrarouges classiques</div><div class="option" data-answer="b"><span class="option-number">2</span>Les radars à ondes millimétriques</div><div class="option" data-answer="c"><span class="option-number">3</span>Les caméras simples</div><div class="option" data-answer="d"><span class="option-number">4</span>Les capteurs de température</div></div><div class="feedback" id="feedback11" tabindex="-1"><p class="feedback-title">Réponse : Les radars à ondes millimétriques</p><p class="feedback-explanation">Ces radars avancés sont beaucoup plus précis que les capteurs infrarouges. Ils peuvent détecter la présence, la vitesse et la direction des piétons ou des véhicules, même dans de mauvaises conditions météorologiques.</p><div class="context-box"><h4>🔬 Précision</h4><p>Cette technologie permet de créer des "bulles de lumière" qui suivent les usagers, assurant un éclairage optimal pour la sécurité tout en maximisant les économies d'énergie dans les zones inoccupées.</p></div></div></div>
            <div class="question-card" data-question="12"><div class="review-banner">🧐 <strong>Mode Révision :</strong> Vous consultez vos réponses.</div><div class="question-header"><div class="question-header-left"><div class="question-number">12</div><div class="question-category">Synthèse</div></div></div><h2 class="question-title" tabindex="-1">Quel est le défi principal pour l'avenir de l'éclairage urbain ?</h2><div class="options"><div class="option" data-answer="a"><span class="option-number">1</span>Éclairer plus fort partout</div><div class="option" data-answer="b"><span class="option-number">2</span>Concilier efficacité énergétique, biodiversité et services connectés</div><div class="option" data-answer="c"><span class="option-number">3</span>Revenir à l'éclairage au gaz</div><div class="option" data-answer="d"><span class="option-number">4</span>Supprimer tout éclairage public</div></div><div class="feedback" id="feedback12" tabindex="-1"><p class="feedback-title">Réponse : Concilier efficacité, biodiversité et services</p><p class="feedback-explanation">L'éclairage de demain doit être un compromis intelligent : il doit consommer le moins possible, tout en assurant la sécurité des citoyens, en offrant de nouveaux services et en minimisant son impact sur l'environnement nocturne.</p><div class="context-box"><h4>🔮 Perspective 2030</h4><p>L'avenir s'oriente vers des réseaux d'éclairage entièrement autonomes et auto-adaptatifs, qui ajustent en temps réel la couleur et l'intensité de la lumière en fonction de données multiples (météo, trafic, événements, cycles de la faune...).</p></div></div></div>
            <div class="question-card" data-question="13"><div class="review-banner">🧐 <strong>Mode Révision :</strong> Vous consultez vos réponses.</div><div class="question-header"><div class="question-header-left"><div class="question-number">13</div><div class="question-category">Calcul</div></div></div><h2 class="question-title" tabindex="-1">Une lampe LED de 15W produit 1500 <span class="tooltip">lumens<span class="tooltip-text">Unité de mesure de la quantité totale de lumière visible émise par une source.</span></span>. Quelle est son efficacité lumineuse (en lm/W) ?</h2><div class="options"><div class="option" data-answer="a" role="radio"><span class="option-number">1</span>75 lm/W</div><div class="option" data-answer="b" role="radio"><span class="option-number">2</span>90 lm/W</div><div class="option" data-answer="c" role="radio"><span class="option-number">3</span>100 lm/W</div><div class="option" data-answer="d" role="radio"><span class="option-number">4</span>120 lm/W</div></div><div class="feedback" id="feedback13" tabindex="-1"><p class="feedback-title">Réponse : 100 lm/W</p><p class="feedback-explanation">L'efficacité lumineuse se calcule en divisant le flux lumineux (lumens) par la puissance consommée (Watts).</p><div class="calculation-breakdown">Calcul : 1500 lumens / 15 Watts = <strong>100 lm/W</strong></div><div class="context-box"><h4>💡 Rappel</h4><p><strong>Efficacité (lm/W) = Flux lumineux (lm) ÷ Puissance (W)</strong>. Plus ce chiffre est élevé, plus la lampe convertit efficacement l'électricité en lumière.</p></div></div></div>
            <div class="question-card" data-question="14"><div class="review-banner">🧐 <strong>Mode Révision :</strong> Vous consultez vos réponses.</div><div class="question-header"><div class="question-header-left"><div class="question-number">14</div><div class="question-category">Maintenance</div></div></div><h2 class="question-title" tabindex="-1">Combien de lampes classiques (2000h) faut-il pour la durée de vie d'une seule LED (50000h) ?</h2><div class="options"><div class="option" data-answer="a" role="radio"><span class="option-number">1</span>15 fois</div><div class="option" data-answer="b" role="radio"><span class="option-number">2</span>25 fois</div><div class="option" data-answer="c" role="radio"><span class="option-number">3</span>30 fois</div><div class="option" data-answer="d" role="radio"><span class="option-number">4</span>35 fois</div></div><div class="feedback" id="feedback14" tabindex="-1"><p class="feedback-title">Réponse : 25 fois</p><p class="feedback-explanation">On divise la durée de vie de la LED par celle de la lampe classique.</p> <div class="calculation-breakdown">Calcul : 50 000 heures / 2 000 heures = <strong>25</strong></div><div class="context-box"><h4>🌱 Impact</h4><p>Cette longévité exceptionnelle réduit drastiquement les coûts de main-d'œuvre pour le remplacement des ampoules, ainsi que la quantité de déchets générés.</p></div></div></div>
            <div class="question-card" data-question="15"><div class="review-banner">🧐 <strong>Mode Révision :</strong> Vous consultez vos réponses.</div><div class="question-header"><div class="question-header-left"><div class="question-number">15</div><div class="question-category">Calcul</div></div></div><h2 class="question-title" tabindex="-1">Une LED de 10W remplace une lampe à incandescence de 60W. Quel est le % d'économie ?</h2><div class="options"><div class="option" data-answer="a" role="radio"><span class="option-number">1</span>Environ 83%</div><div class="option" data-answer="b" role="radio"><span class="option-number">2</span>Environ 75%</div><div class="option" data-answer="c" role="radio"><span class="option-number">3</span>Environ 50%</div><div class="option" data-answer="d" role="radio"><span class="option-number">4</span>Environ 90%</div></div><div class="feedback" id="feedback15" tabindex="-1"><p class="feedback-title">Réponse : Environ 83%</p><p class="feedback-explanation">L'économie est de 60W - 10W = 50W. Pour trouver le pourcentage, on divise l'économie par la consommation initiale.</p> <div class="calculation-breakdown">Calcul : ((60W - 10W) / 60W) × 100 ≈ <strong>83.3%</strong></div><div class="context-box"><h4>🔢 Méthode</h4><p><strong>% économie = ( (Consommation initiale - Nouvelle consommation) / Consommation initiale ) × 100</strong></p></div></div></div>
            <div class="question-card" data-question="16"><div class="review-banner">🧐 <strong>Mode Révision :</strong> Vous consultez vos réponses.</div><div class="question-header"><div class="question-header-left"><div class="question-number">16</div><div class="question-category">Histoire Interactive</div></div></div><h2 class="question-title" tabindex="-1">Organisez l'histoire ! Glissez-déposez chaque innovation sur la bonne période.</h2><div class="interactive-question-container timeline-container" id="q16-container"><div class="timeline-events" id="q16-events"><div class="draggable-item" draggable="true" data-id="led">Invention de la LED</div><div class="draggable-item" draggable="true" data-id="gaz">Généralisation de l'éclairage au gaz</div><div class="draggable-item" draggable="true" data-id="edison">Invention de l'ampoule à incandescence</div><div class="draggable-item" draggable="true" data-id="smart">Ère des Smart-Cities et du <span class="tooltip">Li-Fi<span class="tooltip-text">Light Fidelity. Technologie de communication sans fil basée sur l'utilisation de la lumière (LED).</span></span></div></div><div class="timeline-slots"><div class="timeline-slot"><div class="timeline-year">Début 19e s.</div><div class="dropzone" data-target="gaz"></div></div><div class="timeline-slot"><div class="timeline-year">Fin 19e s.</div><div class="dropzone" data-target="edison"></div></div><div class="timeline-slot"><div class="timeline-year">Milieu 20e s.</div><div class="dropzone" data-target="led"></div></div><div class="timeline-slot"><div class="timeline-year">Années 2020</div><div class="dropzone" data-target="smart"></div></div></div></div><div class="feedback" id="feedback16" tabindex="-1"><p class="feedback-title">Chronologie de l'éclairage</p><p class="feedback-explanation">L'ordre correct est : Éclairage au gaz (début 19e), Ampoule d'Edison (fin 19e), Invention de la LED (milieu 20e, mais généralisation bien plus tardive), et enfin l'ère des Smart Cities (récente).</p></div></div>
            <div class="question-card" data-question="17"><div class="review-banner">🧐 <strong>Mode Révision :</strong> Vous consultez vos réponses.</div><div class="question-header"><div class="question-header-left"><div class="question-number">17</div><div class="question-category">Smart City en pratique</div></div></div><h2 class="question-title" tabindex="-1">Construisez un lampadaire intelligent ! Sélectionnez au moins 4 fonctionnalités.</h2><div class="smart-lamppost-builder" id="q17-builder"><div class="feature-option" data-id="wifi" role="button" tabindex="0" title="Diffuse un signal Wi-Fi ou 5G pour connecter les passants."><div class="feature-icon">📡</div><div>Hotspot Wi-Fi / 5G</div></div><div class="feature-option" data-id="air" role="button" tabindex="0" title="Mesure les polluants (particules fines, NOx...) en temps réel."><div class="feature-icon">🌬️</div><div>Capteur de qualité de l'air</div></div><div class="feature-option" data-id="charge" role="button" tabindex="0" title="Permet de recharger les voitures, scooters ou vélos électriques."><div class="feature-icon">🔌</div><div>Borne de recharge véhicule</div></div><div class="feature-option" data-id="camera" role="button" tabindex="0" title="Assure la sécurité et peut analyser les flux de piétons/véhicules."><div class="feature-icon">📹</div><div>Caméra de sécurité IA</div></div><div class="feature-option" data-id="speaker" role="button" tabindex="0" title="Diffuse des annonces d'urgence (alerte météo, sécurité...)."><div class="feature-icon">📢</div><div>Haut-parleur d'alerte</div></div><div class="feature-option" data-id="parking" role="button" tabindex="0" title="Détecte si une place de stationnement à proximité est libre ou occupée."><div class="feature-icon">🅿️</div><div>Détection de place de parking</div></div></div><div class="feedback" id="feedback17" tabindex="-1"><div class="feedback-correct"><p class="feedback-title">Lampadaire Intelligent assemblé !</p><p class="feedback-explanation">Votre sélection montre que vous avez bien compris comment un simple point lumineux peut devenir un "couteau suisse" technologique au service de la ville.</p><div id="q17-description-box" class="context-box"><h4>Votre lampadaire intelligent inclut :</h4><ul id="q17-description-list"></ul></div></div><div class="feedback-incorrect"><p><strong>Sélectionnez au moins 4 fonctionnalités</strong> pour créer un lampadaire vraiment "intelligent" !</p></div></div></div>
            <div class="question-card" data-question="18"><div class="review-banner">🧐 <strong>Mode Révision :</strong> Vous consultez vos réponses.</div><div class="question-header"><div class="question-header-left"><div class="question-number">18</div><div class="question-category">Identification Visuelle</div></div></div><h2 class="question-title" tabindex="-1">Quelle technologie d'éclairage est représentée sur cette image ?</h2><img src="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wCEAAkGBxISEhUSEhIVFRUVFRUVFRUVFRUVFRUVFRUWFhUVFRUYHSggGBolHRUVITEhJSkrLi4uFx8zODMtNygtLisBCgoKDg0OGhAQGi0lHyUtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLf/aAAwDAQACEQMRAD8A8q6mNhhYcxlzLpDYxwZgDGYwGIBmOJxOMxAMRjicZjAYgGYxOJxmMwGJziQxnEucAYnOJDOMS5wBucS5xGcSnAGZzKcxnEpxAGZzKcxGcSnEAZzKcxGcSnEA+g/hB4VW1tDrVdMTVAEpyP+Wp3B/zH5A9zXqlSqqKWYhVAySTgADqSZeA8TeM9V8SJTSo9OmLVF3U1VdqqB1JAycnOOTwSe1chmMBjOJSGYynEAZnEhzGYxmMwGJzmJDGYzGYwGAznEhzGYzGYwGJzmJDicZgMTnEhzGYzGYwGAznKcxOcZjMBjicS5xmMZjAYjOJc5jOYzEAYjOJc5jOYzEAYjOJc5jOYzEAYnOJDOMZjMdgMTnEhnEucwGJzmJDGYzGYDAZzKcxmMxmMBic4kM5jMZnYDE5xIczGYzGYDAZzKcxmMxmMBjicS5zGYzGYwGJziXOYzmMRgMRnEucxnMRmA+h/Cf4dabr/h+2uLu5u0uKhqOUs6qAoZyqYO0kgqFPPmRXsR8E6Uf+O15/7av/ALjPPAX1TUDpK6St1V+wo/N+ziqV3bjuG4zjJ5xnHfAzWZ/iXW62nLpT3tZ7BOVtmlY0xznGzOMZJOMYzztCjN7b4j+Ben6ToN5e2l1dNWpBWCVnVlJZgDkqoIxnNdL8Mv+yOlf9h/91a+Z69S2vr9lU0oWd9cWqG3SnUUqtSncKAAGGCMHGQR2I5GZ3fws/7I6V/wBh/wDdWgD0aZleFeJf2o/7Ff8AyH/pXtmZXiX9qP8AsV/8h/6UDPCZzEpzGYxmMwGJzKcxnEpxAGZzKcxGcS5wBucS5xGcSnAGZzKcxGcS5wBmcynMRnEpxAGZzKcxGcS5wBmcynMRnEpxAGZzKcxGcS5wBucS5xGcSnAGZzKcxGcS5wBmcynMRnEpxAGZzKcxv6JoF1q9ZadJcnqx5KvqT2ECFOTkowi5Pokd/8LfD9S0tnvqqFWrABARzSnYZ8iT+QruZkssuhtGtNLtktbZdqLzJ6s3cnzmdGW+KSSM2bI5yc57bC8wzGYzGYzAYgGZxIczGYzGYwGJzmJDicZgMTnEhzicZgMTnEhzicZgMTnEhzicZgMTnEhzicZgMTnEhzicZgMTnEhzicZgMTnEhzicZgMN/wt4cvPEeoLZ2gAJBZmY4VFBA3E/UgAcySB3roPg/wCEqWoP4gukDLQxTog86nRiB5hQQfIlT2rvpM5bL1UUl3NMaHm2/Z2Pg74daX4etUub6mmoXyqGZp1D06Z6hFbIYeWTk98dK6iZlMZmZJtnZJJaRDmcpzGYzGYwGIzmMRnEucwBCcSnMRnEpxAGZzKcxGcSnEAZzKcxGcSnEAZzKcxGcSnEAZzKcxGcSnEAZzKcxGcSnEAZzKcxGcSnEAZzKcxGcSnEAZzKcxGcSnEAZzKcxGcSnEAbvh3xHfaBdi6sn2twHTkq48mH+hHI5Br6l8GeKrfxdpK3iLsqKxSpTJ+VwATjPYggjyNeCeD/h/f8AiVxcNm0sM8V3U++3nTXuR3PA8yAfe9L0ix0q0S0s6S0qS9FXqe5J5LHqSck9TKy40kYc0pPVnQTMpmZTOZmWdBmM5jMZnEucwGJzmJDGYzGYwGJzmJDicZgMTnEhzOYzGYDAZzKcxmMxmMBjicS5zGYzGYwGJziXOYzmMRgMRnEucxnMRmA//2Q==" alt="Ampoule allongée avec un tube à arc interne, typique d'une lampe à sodium haute pression." class="question-image"><div class="options" role="radiogroup"><div class="option" data-answer="a" role="radio"><span class="option-number">1</span>LED</div><div class="option" data-answer="b" role="radio"><span class="option-number">2</span>Lampe à Sodium Haute Pression</div><div class="option" data-answer="c" role="radio"><span class="option-number">3</span>Lampe à incandescence</div><div class="option" data-answer="d" role="radio"><span class="option-number">4</span>Lampe halogène</div></div><div class="feedback" id="feedback18" tabindex="-1"><p class="feedback-title">Réponse : Lampe à Sodium Haute Pression</p><p class="feedback-explanation">C'est une lampe à décharge, reconnaissable à son tube à arc interne. Elle est connue pour sa couleur orange-jaune caractéristique et a été la norme pour l'éclairage public pendant des décennies.</p></div></div>
            <div class="question-card" data-question="19"><div class="review-banner">🧐 <strong>Mode Révision :</strong> Vous consultez vos réponses.</div><div class="question-header"><div class="question-header-left"><div class="question-number">19</div><div class="question-category">Mythe ou Réalité</div></div></div><h2 class="question-title" tabindex="-1">Affirmation : "Grâce à leur faible consommation, les éclairages LED blancs modernes ont toujours un impact environnemental plus faible que les anciennes lampes oranges."</h2><div class="options" role="radiogroup"><div class="option" data-answer="a" role="radio"><span class="option-number">1</span>Vrai</div><div class="option" data-answer="b" role="radio"><span class="option-number">2</span>Faux</div></div><div class="feedback" id="feedback19" tabindex="-1"><p class="feedback-title">Réponse : Faux</p><p class="feedback-explanation">Bien que plus efficaces énergétiquement, les LED blanches froides (riches en lumière bleue) peuvent perturber davantage la faune nocturne et le rythme circadien humain que la lumière orange des anciennes lampes.</p><div class="context-box"><h4>🔬 Énergie vs. Biodiversité</h4><p>C'est un compromis : l'impact environnemental n'est pas qu'énergétique. De plus en plus de villes optent pour des LED à teinte chaude (ambrées, < 3000K) pour un meilleur équilibre.</p></div></div></div>
            <div class="question-card" data-question="20"><div class="review-banner">🧐 <strong>Mode Révision :</strong> Vous consultez vos réponses.</div><div class="question-header"><div class="question-header-left"><div class="question-number">20</div><div class="question-category">Tri Interactif</div></div></div><h2 class="question-title" tabindex="-1">Triez les caractéristiques : glissez chaque étiquette dans la bonne catégorie.</h2><div class="interactive-question-container sorting-container" id="q20-container"><div class="sorting-source-list dropzone" id="q20-source"><div class="draggable-item" draggable="true" data-category="led">Très longue durée de vie (> 50 000h)</div><div class="draggable-item" draggable="true" data-category="old">Contient du mercure (polluant)</div><div class="draggable-item" draggable="true" data-category="led">Allumage instantané</div><div class="draggable-item" draggable="true" data-category="old">Long temps de préchauffage</div><div class="draggable-item" draggable="true" data-category="led">Excellente efficacité énergétique</div><div class="draggable-item" draggable="true" data-category="old">Lumière monochromatique (orange)</div></div><div class="sorting-bins"><div class="sorting-bin"><h4>💡 LED Moderne</h4><div class="dropzone" data-target="led"></div></div><div class="sorting-bin"><h4>🏮 Ancienne Lampe à Décharge (Sodium)</h4><div class="dropzone" data-target="old"></div></div></div></div><div class="feedback" id="feedback20" tabindex="-1"><p class="feedback-title">Distinction des technologies</p><p class="feedback-explanation">Vous avez trié les caractéristiques des deux générations d'éclairage. Les LED se distinguent par leur efficacité, leur longévité et leur flexibilité, tandis que les lampes à décharge avaient des contraintes comme le temps de chauffe et la présence de matériaux polluants.</p></div></div>
        </div>

        <div class="results" id="results">
            <div id="confetti-container"></div>
            <h2>🎉 Félicitations ! Questionnaire terminé</h2>
            <div class="score-circle" id="scoreCircle">
                <span id="scoreDisplay">0/20</span>
            </div>
            <h3 class="score-title" id="scoreMessage">Votre titre</h3>
            <p id="scoreDescription">Description de votre performance</p>
            
            <div class="badges-earned-container" id="badgesEarnedContainer">
                <h4>🏆 Badges Obtenus</h4>
                <div id="badges-earned"></div>
            </div>

            <div class="key-takeaways">
                <h4>✨ Ce qu'il faut retenir</h4>
                <ul>
                    <li>La technologie <strong>LED</strong> a révolutionné l'éclairage par son efficacité, sa durée de vie et sa flexibilité (couleur, intensité).</li>
                    <li>Le lampadaire moderne est devenu une <strong>plateforme de services</strong> pour la "Smart City" (Wi-Fi, capteurs, sécurité...).</li>
                    <li>L'enjeu actuel est de trouver un équilibre entre <strong>efficacité énergétique</strong>, <strong>sécurité</strong> et <strong>protection de la biodiversité</strong> contre la pollution lumineuse.</li>
                </ul>
            </div>
            
            <div class="results-summary">
                <h4>Récapitulatif de vos réponses</h4>
                <div id="summaryContent"></div>
            </div>

            <div class="results-actions">
                <button class="btn btn-primary" onclick="reviewQuestions()">🧐 Revoir mes réponses</button>
                <button class="btn btn-secondary" onclick="restartQuiz()">🔄 Recommencer</button>
            </div>
        </div>
        
        <button class="btn btn-primary" id="backToResultsBtn" onclick="showResults(false)" style="display: none; margin: 20px auto;">Retour aux résultats</button>
        
        <div class="nav-buttons">
            <button class="btn-nav" id="prevBtn" title="Précédent (←)" aria-label="Question précédente" disabled>⬅️</button>
            <button class="btn-nav" id="nextBtn" title="Suivant (→)" aria-label="Question suivante" disabled>➡️</button>
        </div>
    </div>
    
    <div class="video-container" id="videoWidget">
        <div class="video-header" id="videoHeader">
            <span class="dynamic-icon" id="videoStatusIcon">🎬</span>
            <span class="video-title">Vidéo C'est Pas Sorcier</span>
            <div class="video-controls">
                <button id="minimizeBtn" aria-label="Minimiser la vidéo">_</button>
            </div>
        </div>
        <div class="video-content">
             <div class="video-player-container" id="videoPlayerContainer">
                <div class="play-icon">▶</div>
             </div>
        </div>
    </div>
    
    <div class="modal-overlay" id="statsModalOverlay">
        <div class="stats-modal">
            <button class="modal-close-btn" id="modalCloseBtn" aria-label="Fermer les statistiques">✖</button>
            <h3>📊 Vos Statistiques</h3>
            <div class="stats-grid">
                <div class="stat-item"><h4>Précision</h4><p id="statsAccuracy">--%</p></div>
                <div class="stat-item"><h4>Répondues</h4><p id="statsAnswered">0 / 20</p></div>
                <div class="stat-item"><h4>Temps</h4><p id="statsTime">00:00</p></div>
            </div>
            <h3>🏆 Vos Badges</h3>
            <div class="badges-grid">
                <div class="badge" title="Terminer l'exercice de la timeline avec succès"><div class="badge-icon" id="badge-history">🕰️</div><p>Historien Précis</p></div>
                <div class="badge" title="Construire un lampadaire intelligent avec succès"><div class="badge-icon" id="badge-smartcity">🏙️</div><p>Ingénieur Smart City</p></div>
                <div class="badge" title="Réussir les 3 questions de calcul"><div class="badge-icon" id="badge-calculator">🧮</div><p>Calculateur Rapide</p></div>
                <div class="badge" title="Réussir les 3 exercices techniques interactifs"><div class="badge-icon" id="badge-expert">🛠️</div><p>Expert Technique</p></div>
                <div class="badge" title="Obtenir 5 bonnes réponses d'affilée"><div class="badge-icon" id="badge-streak">🔥</div><p>Série Parfaite</p></div>
                <div class="badge" title="Explorer l'interface (ouvrir stats, voir vidéo, utiliser l'astuce)"><div class="badge-icon" id="badge-curious">🕵️</div><p>Curieux de Nature</p></div>
                <div class="badge" title="Obtenir un score parfait de 20/20"><div class="badge-icon" id="badge-perfect">🌟</div><p>Grand Chelem</p></div>
                <div class="badge" title="Terminer le quiz en moins de 10 minutes"><div class="badge-icon" id="badge-sprinter">⚡</div><p>Éclair Rapide</p></div>
            </div>
            <div class="reset-button-container">
                <p>Recommencer le quiz depuis le début ?</p>
                <button class="btn btn-secondary" id="resetQuizBtn">Réinitialiser ma progression</button>
            </div>
        </div>
    </div>
    
    <div id="toast-container"></div>
    
    <footer>
        Réalisé par David Trafial
    </footer>

    <script src="https://www.youtube.com/iframe_api"></script>
    <script>
    // --- VARIABLES GLOBALES & CONSTANTES ---
    let currentQuestion = 1;
    let score = 0;
    const totalQuestions = 20;
    let answers = new Array(totalQuestions + 1).fill(null);
    let isAnswered = new Array(totalQuestions + 1).fill(false);
    let q17_selections = [];
    let videoPlayer;
    let timerInterval;
    let secondsElapsed = 0;
    let currentStreak = 0;
    let isReviewing = false;
    let badges = { history: false, smartcity: false, calculator: false, expert: false, streak: false, perfect: false, curious: false, sprinter: false };
    let curiosityTracker = { videoClicked: false, statsOpened: false, hintHovered: false };
    let draggedItem = null;

    const quizSaveKey = 'urbanLightingQuiz_vFinal_17';
    const themeStorageKey = 'urbanLightingTheme_v1';

    const correctAnswers = { 1: 'b', 2: 'a', 3: 'c', 4: 'b', 5: 'b', 6: 'b', 7: 'b', 8: 'a', 9: 'b', 10: 'c', 11: 'b', 12: 'b', 13: 'c', 14: 'b', 15: 'a', 16: true, 17: true, 18: 'b', 19: 'b', 20: true };
    const questionTitles = [ "Éclairage dominant au XIXe s.", "Date de l'ampoule d'Edison", "Points lumineux à Paris", "Fonctionnement lampe à incandescence", "Différence lampe classique/halogène", "Principe lampes à décharge", "Défi environnemental majeur", "Innovation d'alimentation écologique", "Rôle de l'éclairage en Smart City", "Économie d'énergie avec les LED", "Technologie de détection avancée", "Défi futur de l'éclairage", "Calcul d'efficacité lumineuse", "Calcul d'économies de maintenance", "Calcul de % d'économie d'énergie", "Timeline interactive de l'histoire", "Constructeur de lampadaire intelligent", "Identification Visuelle", "Mythe ou Réalité", "Tri des Caractéristiques" ];
    const featureDetails = { wifi: { name: "Hotspot Wi-Fi / 5G", desc: "Diffuse un signal Wi-Fi ou 5G pour connecter les passants." }, air: { name: "Capteur qualité de l'air", desc: "Mesure les polluants (particules fines, NOx...) en temps réel." }, charge: { name: "Borne de recharge", desc: "Permet de recharger les voitures, scooters ou vélos électriques." }, camera: { name: "Caméra de sécurité IA", desc: "Assure la sécurité et peut analyser les flux de piétons/véhicules." }, speaker: { name: "Haut-parleur d'alerte", desc: "Diffuse des annonces d'urgence (alerte météo, sécurité...)." }, parking: { name: "Détection de parking", desc: "Détecte si une place de stationnement à proximité est libre ou occupée." } };
    const badgeDetails = { history: { name: "Historien Précis", icon: "🕰️" }, smartcity: { name: "Ingénieur Smart City", icon: "🏙️" }, calculator: { name: "Calculateur Rapide", icon: "🧮" }, expert: { name: "Expert Technique", icon: "🛠️" }, streak: { name: "Série Parfaite", icon: "🔥" }, curious: { name: "Curieux de Nature", icon: "🕵️" }, perfect: { name: "Grand Chelem", icon: "🌟" }, sprinter: { name: "Éclair Rapide", icon: "⚡" } };
    
    const dom = {
        container: document.querySelector('.container'),
        questionsWrapper: document.getElementById('questions-wrapper'),
        navButtons: document.querySelector('.nav-buttons'),
        progressContainer: document.querySelector('.progress-container'),
        progressFill: document.getElementById('progressFill'), progressText: document.getElementById('progressText'), progressDotsContainer: document.getElementById('progressDots'),
        currentScore: document.getElementById('currentScore'), totalQuestionsDisplay: document.getElementById('totalQuestionsDisplay'),
        prevBtn: document.getElementById('prevBtn'), nextBtn: document.getElementById('nextBtn'), resultsScreen: document.getElementById('results'),
        liveScore: document.getElementById('liveScore'),
        accuracyBarFill: document.getElementById('accuracyBarFill'),
        statsModalOverlay: document.getElementById('statsModalOverlay'), modalCloseBtn: document.getElementById('modalCloseBtn'),
        videoWidget: document.getElementById('videoWidget'), videoHeader: document.getElementById('videoHeader'), videoPlayerContainer: document.getElementById('videoPlayerContainer'), videoStatusIcon: document.getElementById('videoStatusIcon'),
        keyboardHint: document.getElementById('keyboardHint'),
        backToResultsBtn: document.getElementById('backToResultsBtn'),
        themeToggle: document.getElementById('theme-toggle-switch'),
        resetQuizBtn: document.getElementById('resetQuizBtn'),
        timerDisplay: document.getElementById('timerDisplay')
    };

    // --- GESTION DU THÈME ---
    function applyTheme(theme) {
        document.documentElement.setAttribute('data-theme', theme);
        dom.themeToggle.checked = (theme === 'light');
    }
    function saveThemePreference(theme) {
        localStorage.setItem(themeStorageKey, theme);
    }
    function setupTheme() {
        const savedTheme = localStorage.getItem(themeStorageKey);
        const preferredTheme = window.matchMedia('(prefers-color-scheme: light)').matches ? 'light' : 'dark';
        const initialTheme = savedTheme || preferredTheme;
        applyTheme(initialTheme);
        dom.themeToggle.addEventListener('change', () => {
            const newTheme = dom.themeToggle.checked ? 'light' : 'dark';
            applyTheme(newTheme);
            saveThemePreference(newTheme);
        });
    }
    
    // --- UI, FEEDBACK & ANIMATIONS ---
    function showToast(title, message, icon) {
        const toastContainer = document.getElementById('toast-container');
        const toast = document.createElement('div');
        toast.className = 'toast';
        toast.innerHTML = `<span class="toast-icon">${icon}</span><div class="toast-content"><strong>${title}</strong><p>${message}</p></div>`;
        toastContainer.appendChild(toast);
        setTimeout(() => toast.remove(), 4000);
    }
    function updatePrecisionStars(answeredCount) {
        const precisionStars = document.getElementById('precisionStars');
        if (answeredCount === 0) { 
            precisionStars.innerHTML = '<span>☆</span><span>☆</span><span>☆</span>';
            return;
        }
        const accuracy = (score / answeredCount) * 100;
        const starCount = accuracy >= 95 ? 3 : (accuracy >= 75 ? 2 : (accuracy >= 50 ? 1 : 0));
        precisionStars.innerHTML = Array(3).fill(0).map((_, i) => `<span class="star ${i < starCount ? 'filled' : ''}">${i < starCount ? '★' : '☆'}</span>`).join('');
    }
    function updateProgress() {
        const progress = totalQuestions > 1 ? ((currentQuestion - 1) / (totalQuestions - 1)) * 100 : 0;
        dom.progressFill.style.width = progress + '%';
        dom.progressText.innerHTML = `Question <strong>${currentQuestion}</strong> / ${totalQuestions}`;
        Array.from(dom.progressDotsContainer.children).forEach((dot, i) => {
            dot.classList.remove('active');
            if (i + 1 === currentQuestion) dot.classList.add('active');
        });
    }
    function updateLiveScore() {
        dom.currentScore.textContent = score;
        dom.currentScore.classList.add('updated');
        setTimeout(() => dom.currentScore.classList.remove('updated'), 500);
        
        const answeredCount = isAnswered.slice(1).filter(Boolean).length;
        const accuracy = answeredCount > 0 ? (score / answeredCount) * 100 : 0;
        
        dom.accuracyBarFill.style.width = `${accuracy}%`;
        updatePrecisionStars(answeredCount);
    }
    function updateNavButtons() {
        dom.prevBtn.disabled = currentQuestion === 1;
        dom.nextBtn.disabled = isReviewing ? (currentQuestion === totalQuestions) : !isAnswered[currentQuestion];
        dom.nextBtn.textContent = (currentQuestion === totalQuestions && isAnswered[totalQuestions] && !isReviewing) ? '🏆' : '➡️';
        dom.navButtons.classList.toggle('review-mode-active', isReviewing);
    }

    // --- LOGIQUE PRINCIPALE DU QUIZ ---
    function showQuestion(questionNumber) {
        const currentActiveCard = document.querySelector('.question-card.active');
        if (currentActiveCard) {
            currentActiveCard.classList.add('slide-out');
            setTimeout(() => {
                currentActiveCard.classList.remove('active', 'slide-out');
                displayNewQuestion(questionNumber);
            }, 400);
        } else {
            displayNewQuestion(questionNumber);
        }
    }
    function displayNewQuestion(questionNumber) {
        dom.resultsScreen.classList.remove('show');
        dom.questionsWrapper.style.display = 'block';
        dom.progressContainer.style.display = 'block';
        dom.backToResultsBtn.style.display = isReviewing ? 'block' : 'none';

        const newQuestionCard = document.querySelector(`[data-question="${questionNumber}"]`);
        if (newQuestionCard) {
            newQuestionCard.classList.remove('slide-out');
            newQuestionCard.classList.add('active');
            newQuestionCard.classList.toggle('review-mode-active', isReviewing);
            
            const questionHeader = newQuestionCard.querySelector('.question-header');
            questionHeader.appendChild(dom.navButtons);
            dom.navButtons.style.display = 'flex';
            
            currentQuestion = parseInt(questionNumber, 10);
            updateProgress();
            updateNavButtons();
            
            const title = newQuestionCard.querySelector('.question-title');
            if(title) title.focus({ preventScroll: true });
            
            dom.progressContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
    }
    function nextQuestion() { if (!dom.nextBtn.disabled) { currentQuestion < totalQuestions ? showQuestion(currentQuestion + 1) : showResults(); } }
    function previousQuestion() { if (!dom.prevBtn.disabled && currentQuestion > 1) showQuestion(currentQuestion - 1); }
    
    function handleMcqAnswer(questionNumber, selectedAnswer, element) {
        if (isAnswered[questionNumber]) return;
        isReviewing = false;
        isAnswered[questionNumber] = true;
        answers[questionNumber] = selectedAnswer;

        const isCorrect = (selectedAnswer === correctAnswers[questionNumber]);
        if (isCorrect) { score++; currentStreak++; } else { currentStreak = 0; }
        
        updateLiveScore();
        checkBadges();
        
        const feedback = document.getElementById(`feedback${questionNumber}`);
        const card = element.closest('.question-card');
        const options = card.querySelectorAll('.option');
        options.forEach(opt => opt.classList.add('disabled'));
        element.classList.add('selected');
        
        const dot = dom.progressDotsContainer.children[questionNumber - 1];
        dot.classList.add('clickable');
        
        if (isCorrect) {
            feedback.classList.add('correct');
            element.classList.add('correct');
            dot.classList.add('completed-correct');
        } else {
            feedback.classList.add('incorrect');
            element.classList.add('incorrect');
            dot.classList.add('completed-incorrect');
            const correctOption = card.querySelector(`.option[data-answer="${correctAnswers[questionNumber]}"]`);
            if (correctOption) {
                correctOption.classList.add('correct', 'glow');
            }
        }
        
        feedback.classList.add('show');
        feedback.focus();
        updateNavButtons();
        saveProgress();
    }
    
    // --- RÉSULTATS & RÉVISION ---
    function showResults(isFirstTime = true) {
        isReviewing = false;
        if (isFirstTime) {
            clearInterval(timerInterval);
            checkBadges(true);
            generateSummary();
            localStorage.removeItem(quizSaveKey);
        }

        document.getElementById('scoreCircle').style.background = `linear-gradient(135deg, var(--primary-color), var(--secondary-color))`;
        let message, description;
        const accuracy = score / totalQuestions;
        if (accuracy >= 0.85) { 
            message = '🏆 Visionnaire de la Smart City !'; 
            description = 'Excellent ! Vous maîtrisez parfaitement l\'évolution de l\'éclairage urbain.';
            if (isFirstTime) triggerConfetti();
        } else if (accuracy >= 0.5) { 
            message = '💡 Technicien Éclairé'; 
            description = 'Bien joué ! Vous avez de solides connaissances. Continuez à explorer !'; 
        } else { 
            message = 'Novice de la Nuit'; 
            description = 'C\'est un bon début ! N\'hésitez pas à revoir la vidéo pour consolider vos acquis.'; 
        }
        document.getElementById('scoreMessage').textContent = message;
        document.getElementById('scoreDescription').textContent = description;
        
        displayEarnedBadges();
        dom.questionsWrapper.style.display = 'none';
        dom.navButtons.style.display = 'none';
        dom.progressContainer.style.display = 'none';
        dom.resultsScreen.classList.add('show');
        dom.backToResultsBtn.style.display = 'none';
        dom.resultsScreen.scrollIntoView({ behavior: 'smooth' });
        document.getElementById('scoreDisplay').textContent = `${score}/${totalQuestions}`;
    }
    function generateSummary() {
        const summaryContent = document.getElementById('summaryContent');
        summaryContent.innerHTML = questionTitles.map((title, index) => {
            const i = index + 1;
            const isCorrect = answers[i] === correctAnswers[i];
            return `<div class="summary-item" data-question-index="${i}" role="button" tabindex="0">
                        <span>Q${i}. ${title}</span>
                        <span class="summary-result ${isCorrect ? 'correct' : 'incorrect'}">${isCorrect ? '✅' : '❌'}</span>
                    </div>`;
        }).join('');
        const handler = e => {
            const item = e.target.closest('.summary-item');
            if(item && (e.type === 'click' || e.key === 'Enter')) reviewQuestion(item.dataset.questionIndex);
        };
        summaryContent.addEventListener('click', handler);
        summaryContent.addEventListener('keydown', handler);
    }
    function reviewQuestions() { isReviewing = true; showQuestion(1); }
    function reviewQuestion(questionIndex) { isReviewing = true; showQuestion(parseInt(questionIndex, 10)); }
    function restartQuiz() { if (confirm("Êtes-vous sûr de vouloir recommencer ? Votre progression sera perdue.")) { localStorage.removeItem(quizSaveKey); location.reload(); } }
    function triggerConfetti() {
        const container = document.getElementById('confetti-container');
        if (!container) return;
        container.innerHTML = '';
        const colors = ['#f39c12', '#e74c3c', '#4abdac', '#2ecc71', '#9b59b6'];
        for (let i = 0; i < 150; i++) {
            const c = document.createElement('div');
            c.classList.add('confetti');
            c.style.left = `${Math.random() * 100}%`;
            c.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
            c.style.animationDelay = `${Math.random() * 2}s`;
            c.style.animationDuration = `${3 + Math.random() * 2}s`;
            c.style.transform = `rotate(${Math.random() * 360}deg)`;
            container.appendChild(c);
        }
    }

    // --- SAUVEGARDE & CHARGEMENT ---
    function saveProgress() {
        const interactiveStates = {
            q16: Array.from(document.querySelectorAll('#q16-container .dropzone')).map(dz => dz.innerHTML),
            q17: q17_selections.slice(),
            q20: { source: document.getElementById('q20-source').innerHTML, led: document.querySelector('#q20-container [data-target="led"]').innerHTML, old: document.querySelector('#q20-container [data-target="old"]').innerHTML }
        };
        const progress = { currentQuestion, score, answers: answers.slice(), isAnswered: isAnswered.slice(), interactiveStates, secondsElapsed, badges, currentStreak, curiosityTracker };
        localStorage.setItem(quizSaveKey, JSON.stringify(progress));
    }
    function loadProgress() {
        const savedProgress = localStorage.getItem(quizSaveKey);
        if (!savedProgress) return;
        
        const progress = JSON.parse(savedProgress);
        Object.assign(window, { ...progress });
        q17_selections = progress.interactiveStates?.q17 || [];
        curiosityTracker = progress.curiosityTracker || curiosityTracker;
        isReviewing = true;

        for (let i = 1; i <= totalQuestions; i++) {
            if (isAnswered[i]) {
                const card = document.querySelector(`.question-card[data-question="${i}"]`);
                const dot = dom.progressDotsContainer.children[i-1];
                const isCorrect = answers[i] === correctAnswers[i];
                dot.classList.add('clickable', isCorrect ? 'completed-correct' : 'completed-incorrect');
                
                if (card.querySelector('.option')) {
                    const selectedOpt = card.querySelector(`.option[data-answer="${answers[i]}"]`);
                    if (selectedOpt) {
                        selectedOpt.classList.add(isCorrect ? 'correct' : 'incorrect', 'selected');
                        card.querySelectorAll('.option').forEach(opt => opt.classList.add('disabled'));
                        if (!isCorrect) card.querySelector(`.option[data-answer="${correctAnswers[i]}"]`)?.classList.add('correct');
                        card.querySelector('.feedback').classList.add(isCorrect ? 'correct' : 'incorrect', 'show');
                    }
                } else if (i === 16 && progress.interactiveStates?.q16) {
                    document.getElementById('q16-events').innerHTML = "";
                    document.querySelectorAll('#q16-container .dropzone').forEach((dz, idx) => dz.innerHTML = progress.interactiveStates.q16[idx]);
                    checkQ16Completion(true);
                } else if (i === 17 && progress.interactiveStates?.q17) {
                    progress.interactiveStates.q17.forEach(id => document.querySelector(`.feature-option[data-id="${id}"]`)?.classList.add('selected'));
                    checkQ17Completion(true);
                } else if (i === 20 && progress.interactiveStates?.q20) {
                    document.getElementById('q20-source').innerHTML = progress.interactiveStates.q20.source;
                    document.querySelector('#q20-container [data-target="led"]').innerHTML = progress.interactiveStates.q20.led;
                    document.querySelector('#q20-container [data-target="old"]').innerHTML = progress.interactiveStates.q20.old;
                    checkQ20Completion(true);
                }
            }
        }
        updateLiveScore();
        showQuestion(progress.currentQuestion);
    }

    // --- BADGES & STATS ---
    function checkCuriosityBadge() {
        if (badges.curious || [curiosityTracker.videoClicked, curiosityTracker.statsOpened, curiosityTracker.hintHovered].filter(Boolean).length < 2) return;
        badges.curious = true;
        showToast("Badge débloqué !", badgeDetails.curious.name, badgeDetails.curious.icon);
        saveProgress();
    }
    function checkBadges(isFinalCheck = false) {
        const conditions = {
            history: () => answers[16] === true,
            smartcity: () => answers[17] === true,
            calculator: () => [13, 14, 15].every(q => answers[q] === correctAnswers[q]),
            expert: () => [16, 17, 20].every(q => answers[q] === true),
            streak: () => currentStreak >= 5,
            perfect: () => isFinalCheck && score === totalQuestions,
            sprinter: () => isFinalCheck && secondsElapsed < 600
        };
        for (const badgeId in conditions) {
            if (!badges[badgeId] && conditions[badgeId]()) {
                badges[badgeId] = true;
                const toastDetails = badgeDetails[badgeId];
                if (toastDetails) showToast("Badge débloqué !", toastDetails.name, toastDetails.icon);
            }
        }
    }
    function displayEarnedBadges() {
        const container = document.getElementById('badges-earned');
        container.innerHTML = '';
        const earnedBadges = Object.keys(badges).filter(id => badges[id]);
        
        if (earnedBadges.length === 0) {
            container.innerHTML = '<p style="color: var(--secondary-text-color);">Continuez à jouer pour débloquer des badges !</p>';
        } else {
            earnedBadges.forEach(badgeId => {
                const badgeInfo = badgeDetails[badgeId];
                container.innerHTML += `<div class="badge-earned-item"><span class="badge-icon">${badgeInfo.icon}</span><p>${badgeInfo.name}</p></div>`;
            });
        }
        document.getElementById('badgesEarnedContainer').style.display = 'block';
    }
    function openStatsModal() {
        const answeredCount = isAnswered.slice(1).filter(Boolean).length;
        document.getElementById('statsAnswered').textContent = `${answeredCount} / ${totalQuestions}`;
        document.getElementById('statsAccuracy').textContent = `${answeredCount > 0 ? Math.round((score / answeredCount) * 100) : 0}%`;
        for (const badgeId in badges) {
            document.getElementById(`badge-${badgeId}`)?.classList.toggle('unlocked', badges[badgeId]);
        }
        dom.statsModalOverlay.classList.add('show');
    }
    function closeStatsModal() {
        dom.statsModalOverlay.classList.add('hiding');
        dom.statsModalOverlay.addEventListener('animationend', () => {
            dom.statsModalOverlay.classList.remove('show', 'hiding');
        }, { once: true });
    }

    // --- QUESTIONS INTERACTIVES ---
    function setupInteractiveQuestions() {
        const dragStart = e => { draggedItem = e.target; setTimeout(() => e.target.style.opacity = '0.5', 0); };
        const dragEnd = () => { if(draggedItem) draggedItem.style.opacity = '1'; draggedItem = null; };
        const dragOver = e => { e.preventDefault(); e.currentTarget.classList.add('over'); };
        const dragLeave = e => e.currentTarget.classList.remove('over');

        document.querySelectorAll('.draggable-item').forEach(item => { item.addEventListener('dragstart', dragStart); item.addEventListener('dragend', dragEnd); });
        document.querySelectorAll('.dropzone').forEach(zone => { zone.addEventListener('dragover', dragOver); zone.addEventListener('dragleave', dragLeave); });
        
        const dropHandler = (e, checkFn, conditionFn) => {
            e.preventDefault(); e.currentTarget.classList.remove('over');
            if (draggedItem && conditionFn(e.currentTarget)) { e.currentTarget.appendChild(draggedItem); checkFn(); }
        };
        
        document.querySelectorAll('#q16-container .dropzone, #q16-events').forEach(zone => zone.addEventListener('drop', e => dropHandler(e, checkQ16Completion, target => target.classList.contains('dropzone') ? target.children.length === 0 : true)));
        document.querySelectorAll('#q20-container .dropzone').forEach(zone => zone.addEventListener('drop', e => dropHandler(e, checkQ20Completion, () => true)));

        const q17Handler = e => {
            const feature = e.target.closest('.feature-option:not(.disabled)');
            if (feature && (e.type === 'click' || e.key === 'Enter' || e.key === ' ')) { if(e.type !== 'click') e.preventDefault(); toggleFeatureSelection(feature); }
        };
        dom.questionsWrapper.querySelector('#q17-builder').addEventListener('click', q17Handler);
        dom.questionsWrapper.querySelector('#q17-builder').addEventListener('keydown', q17Handler);
    }
    function checkInteractiveQuestion(qNum, condition, feedbackId, containerId, isCorrectFn) {
        if (!condition) return;
        isReviewing = false;
        const feedback = document.getElementById(feedbackId);
        const container = document.getElementById(containerId);
        const isAllCorrect = isCorrectFn(container);
        isAnswered[qNum] = true; answers[qNum] = isAllCorrect;
        if (isAllCorrect) { score++; currentStreak++; } else { currentStreak = 0; }
        
        updateLiveScore(); checkBadges();
        feedback.classList.add(isAllCorrect ? 'correct' : 'incorrect', 'show');
        dom.progressDotsContainer.children[qNum - 1].classList.add('clickable', isAllCorrect ? 'completed-correct' : 'completed-incorrect');
        container.classList.add('disabled');
        feedback.focus(); updateNavButtons(); saveProgress();
    }
    function checkQ16Completion(isLoading = false) {
        if (isLoading) {
            document.getElementById('q16-container').classList.add('disabled');
            document.getElementById('feedback16').classList.add(answers[16] ? 'correct' : 'incorrect', 'show');
        } else {
            checkInteractiveQuestion(16, document.getElementById('q16-events').children.length === 0, 'feedback16', 'q16-container', () => {
                let correctCount = 0;
                document.querySelectorAll('#q16-container .dropzone').forEach(zone => {
                    const item = zone.children[0]; const isCorrect = item && zone.dataset.target === item.dataset.id;
                    if(isCorrect) correctCount++; zone.classList.add(isCorrect ? 'correct-drop' : 'incorrect-drop');
                });
                return correctCount === 4;
            });
        }
    }
    function toggleFeatureSelection(feature) {
        if (isAnswered[17]) return;
        feature.classList.toggle('selected');
        q17_selections = Array.from(document.querySelectorAll('#q17-builder .feature-option.selected')).map(el => el.dataset.id);
        if (q17_selections.length >= 4) checkQ17Completion();
    }
    function checkQ17Completion(isLoading = false) {
        const isCorrect = q17_selections.length >= 4;
        if (isLoading && isCorrect) {
            document.getElementById('q17-description-list').innerHTML = q17_selections.map(id => `<li>✅ <b>${featureDetails[id].name}:</b> ${featureDetails[id].desc}</li>`).join('');
            document.getElementById('q17-description-box').style.display = 'block';
            document.getElementById('q17-builder').classList.add('disabled');
            document.getElementById('feedback17').classList.add('correct', 'show');
        } else if (!isLoading && isCorrect && !isAnswered[17]) {
            checkInteractiveQuestion(17, true, 'feedback17', 'q17-builder', () => true);
            document.getElementById('q17-description-list').innerHTML = q17_selections.map(id => `<li>✅ <b>${featureDetails[id].name}:</b> ${featureDetails[id].desc}</li>`).join('');
            document.getElementById('q17-description-box').style.display = 'block';
        }
    }
    function checkQ20Completion(isLoading = false) {
        if (isLoading) {
            document.getElementById('q20-container').classList.add('disabled');
            document.getElementById('feedback20').classList.add(answers[20] ? 'correct' : 'incorrect', 'show');
        } else {
            checkInteractiveQuestion(20, document.getElementById('q20-source').children.length === 0, 'feedback20', 'q20-container', () => 
                Array.from(document.querySelectorAll('#q20-container .dropzone[data-target] .draggable-item'))
                     .every(item => item.dataset.category === item.parentElement.dataset.target)
            );
        }
    }
    
    // --- INITIALISATION & ÉVÉNEMENTS ---
    function startTimer() {
        timerInterval = setInterval(() => {
            secondsElapsed++;
            const minutes = Math.floor(secondsElapsed / 60).toString().padStart(2, '0');
            const seconds = (secondsElapsed % 60).toString().padStart(2, '0');
            const timeString = `${minutes}:${seconds}`;
            if(dom.timerDisplay) dom.timerDisplay.textContent = timeString;
            if(document.getElementById('statsTime')) document.getElementById('statsTime').textContent = timeString;
        }, 1000);
    }
    function onYouTubeIframeAPIReady() {}
    function createPlayer() {
        if (videoPlayer) { videoPlayer.playVideo(); return; }
        dom.videoPlayerContainer.innerHTML = '<div id="player-iframe"></div>';
        videoPlayer = new YT.Player('player-iframe', {
            height: '100%', width: '100%', videoId: 'GRwOsXCW2jM',
            playerVars: { 'autoplay': 1, 'rel': 0, 'controls': 1 },
            events: { 'onStateChange': e => {
                const isPlaying = e.data === YT.PlayerState.PLAYING;
                dom.videoStatusIcon.textContent = isPlaying ? '🎶' : '🎬';
                dom.videoStatusIcon.classList.toggle('playing', isPlaying);
            }}
        });
    }
    function setupEventListeners() {
        dom.nextBtn.addEventListener('click', nextQuestion);
        dom.prevBtn.addEventListener('click', previousQuestion);

        document.addEventListener('click', e => {
            const option = e.target.closest('.option:not(.disabled)');
            if (option) handleMcqAnswer(parseInt(option.closest('.question-card').dataset.question), option.dataset.answer, option);
            const dot = e.target.closest('.progress-dot.clickable');
            if (dot) reviewQuestion(parseInt(dot.dataset.questionIndex));
        });

        document.addEventListener('keydown', e => {
            if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
            const key = e.key;
            if (key === 'ArrowRight') { e.preventDefault(); dom.nextBtn.click(); }
            else if (key === 'ArrowLeft') { e.preventDefault(); dom.prevBtn.click(); }
            else if (['1', '2', '3', '4'].includes(key)) {
                const activeCard = document.querySelector('.question-card.active');
                if (activeCard && activeCard.querySelector('.option:not(.disabled)')) {
                    const optionToClick = activeCard.querySelector(`.option:nth-child(${key})`);
                    if(optionToClick && !optionToClick.classList.contains('disabled')) { e.preventDefault(); optionToClick.click(); }
                }
            } else if (key === 'Escape' && dom.statsModalOverlay.classList.contains('show')) {
                closeStatsModal();
            }
        });
        
        dom.liveScore.addEventListener('click', () => { curiosityTracker.statsOpened = true; checkCuriosityBadge(); openStatsModal(); });
        dom.keyboardHint.addEventListener('mouseover', () => { curiosityTracker.hintHovered = true; checkCuriosityBadge(); }, { once: true });
        dom.videoPlayerContainer.addEventListener('click', () => { curiosityTracker.videoClicked = true; checkCuriosityBadge(); createPlayer(); }, { once: true });
        
        dom.modalCloseBtn.addEventListener('click', closeStatsModal);
        dom.statsModalOverlay.addEventListener('click', e => { if (e.target === dom.statsModalOverlay) closeStatsModal(); });

        document.getElementById('minimizeBtn').addEventListener('click', (e) => { e.stopPropagation(); dom.videoWidget.classList.toggle('minimized'); });
        dom.videoHeader.addEventListener('click', () => { if (dom.videoWidget.classList.contains('minimized')) dom.videoWidget.classList.remove('minimized'); });
        dom.resetQuizBtn.addEventListener('click', restartQuiz);
    }
    function init() {
        dom.totalQuestionsDisplay.textContent = totalQuestions;
        dom.progressDotsContainer.innerHTML = questionTitles.map((title, i) => 
            `<div class="progress-dot" data-question-index="${i + 1}" data-tooltip="Q${i + 1}: ${title}"></div>`
        ).join('');
        
        setupTheme();
        setupEventListeners();
        setupInteractiveQuestions();
        
        dom.container.appendChild(dom.navButtons);
        dom.navButtons.style.display = 'none';
        
        const savedProgress = localStorage.getItem(quizSaveKey);
        if(savedProgress) {
            const resumeBtn = document.getElementById('resumeNotification');
            resumeBtn.classList.add('show');
            resumeBtn.addEventListener('click', () => { loadProgress(); resumeBtn.classList.remove('show'); }, { once: true });
            setTimeout(() => resumeBtn.classList.remove('show'), 5000);
        }
        
        startTimer();
        showQuestion(1);
        updateLiveScore();
    }
    
    document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
