<!DOCTYPE html>
<html lang="fr" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>L'Éclairage Urbain : Des Lumières de la Ville aux Smart Cities</title>
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cstyle%3Epath %7B fill: %233498db; %7D @media (prefers-color-scheme: dark) %7B path %7B fill: %23f7b733; %7D %7D%3C/style%3E%3Cpath d='M44,87.5 C44,90.261 46.239,92.5 49,92.5 L51,92.5 C53.761,92.5 56,90.261 56,87.5 L56,83.5 L44,83.5 L44,87.5 Z M66.3,74.7 C66.3,74.7 75,66.9 75,54.5 C75,41.512 64.988,31.5 52,31.5 L48,31.5 C35.012,31.5 25,41.512 25,54.5 C25,66.9 33.7,74.7 33.7,74.7 L33.7,79.5 L66.3,79.5 L66.3,74.7 Z'/%3E%3C/svg%3E" type="image/svg+xml">

    <style>
        :root {
            --primary-color: #f7b733; --primary-color-rgb: 247, 183, 51;
            --secondary-color: #fc4a1a; --accent-color: #4abdac;
            --success-color: #27ae60; --error-color: #e74c3c;
            --bg-color: #1B263B; --card-bg: #233142; --main-text-color: #E0E1DD;
            --secondary-text-color: #A0A0A0; --footer-text-color: rgba(224, 225, 221, 0.5);
            --glass-bg: rgba(35, 49, 66, 0.8); --glass-border: rgba(224, 225, 221, 0.2);
            --card-shadow: rgba(0, 0, 0, 0.4); --card-shadow-hover: rgba(0, 0, 0, 0.5);
            --option-bg: rgba(224, 225, 221, 0.05); --option-hover-bg: rgba(224, 225, 221, 0.1);
            --progress-track-bg: #1B263B; --tooltip-bg: #222;
        }
        html[data-theme='light'] {
            --primary-color: #3498db; --primary-color-rgb: 52, 152, 219;
            --secondary-color: #2980b9; --bg-color: #f4f6f8;
            --card-bg: #ffffff; --main-text-color: #2c3e50; --secondary-text-color: #6c757d;
            --footer-text-color: rgba(0, 0, 0, 0.5); --glass-bg: rgba(255, 255, 255, 0.85);
            --glass-border: rgba(0, 0, 0, 0.1); --card-shadow: rgba(44, 62, 80, 0.15);
            --card-shadow-hover: rgba(44, 62, 80, 0.25);
            --option-bg: rgba(52, 152, 219, 0.05); --option-hover-bg: rgba(52, 152, 219, 0.1);
            --progress-track-bg: #e9ecef; --tooltip-bg: #34495e;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            line-height: 1.6; color: var(--main-text-color); background-color: var(--bg-color);
            min-height: 100vh; transition: background-color 0.3s ease, color 0.3s ease;
        }
        .container { max-width: 1000px; margin: 0 auto; padding: 20px; }
        html[data-theme='dark'] strong, html[data-theme='dark'] b { color: var(--primary-color); }
        .header { text-align: center; background: var(--card-bg); padding: 30px; border-radius: 20px; margin-bottom: 30px; box-shadow: 0 15px 35px var(--card-shadow); border: 1px solid var(--glass-border); transition: all 0.4s ease-in-out; display: flex; justify-content: space-between; align-items: center; }
        .header-title-container { text-align: left; }
        .header h1 { color: var(--primary-color); font-size: 2.2em; margin-bottom: 0px; text-shadow: 0 2px 10px rgba(var(--primary-color-rgb), 0.3); transition: font-size 0.4s ease-in-out; }
        .header .subtitle { font-size: 1.1em; color: var(--secondary-text-color); font-weight: 500; transition: opacity 0.3s, max-height 0.4s ease-in-out, margin 0.4s; max-height: 100px; opacity: 1; }
        html[data-theme='light'] .header h1 { color: var(--main-text-color); text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.2); }
        .header.header-compact { padding-top: 20px; padding-bottom: 20px; }
        .header.header-compact h1 { font-size: 1.6em; }
        .header.header-compact .subtitle { max-height: 0; opacity: 0; margin: 0; }
        .theme-switch { display: flex; align-items: center; gap: 10px; cursor: pointer; padding: 5px; border-radius: 20px; background: var(--option-bg); }
        .theme-switch-label { font-size: 1.2rem; color: var(--secondary-text-color); transition: color 0.3s ease; }
        .theme-switch input { display: none; }
        .switch-track { position: relative; width: 50px; height: 26px; background-color: var(--bg-color); border: 1px solid var(--glass-border); border-radius: 13px; transition: background-color 0.3s ease; }
        .switch-thumb { position: absolute; top: 2px; left: 2px; width: 20px; height: 20px; background-color: var(--secondary-text-color); border-radius: 50%; transition: transform 0.3s ease, background-color 0.3s ease; }
        .theme-switch input:checked + .switch-track .switch-thumb { transform: translateX(24px); background-color: var(--primary-color); }
        #sun-icon { display: none; } html[data-theme='light'] #moon-icon { display: none; } html[data-theme='light'] #sun-icon { display: block; }
        #startScreen { background: var(--card-bg); padding: 30px; border-radius: 20px; box-shadow: 0 10px 30px var(--card-shadow); text-align: left; animation: slideInUp 0.6s ease-out; margin-bottom: 20px; }
        #startScreen.hidden { display: none; }
        .start-title { font-size: 1.5em; color: var(--primary-color); margin-bottom: 10px; }
        .start-section { margin: 25px 0; }
        .start-section h4 { color: var(--accent-color); margin-bottom: 10px; border-bottom: 2px solid var(--glass-border); padding-bottom: 5px; }
        .start-section ul { list-style-type: '✓ '; padding-left: 20px; }
        .start-section li { margin-bottom: 8px; }
        .start-video-box, .start-update-box { background: var(--option-bg); padding: 15px; border-radius: 10px; border-left: 3px solid var(--primary-color); }
        .start-video-box { display: flex; align-items: center; gap: 20px; flex-wrap: wrap; }
        .video-link-start { display: inline-flex; align-items: center; gap: 8px; padding: 10px 20px; background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); color: white; text-decoration: none; border-radius: 25px; font-weight: bold; transition: transform 0.3s ease, box-shadow 0.3s ease; font-size: 0.9em; }
        .video-link-start:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(var(--primary-color-rgb), 0.5); }
        .start-actions { text-align: center; margin-top: 30px; display: flex; justify-content: center; gap: 15px; flex-wrap: wrap; }
        #startQuizBtn { font-size: 1.2em; padding: 15px 40px; }
        #resumeBtn { display: none; }
        .quiz-content.hidden { display: none; }
        .btn { padding: 12px 30px; border: none; border-radius: 25px; cursor: pointer; font-weight: bold; transition: all 0.3s ease; }
        .btn:active { transform: translateY(-1px) scale(0.98); }
        .btn-primary { background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); color: white; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(var(--primary-color-rgb), 0.4); }
        .btn-secondary { background: var(--option-hover-bg); color: var(--main-text-color); border: 1px solid var(--glass-border); }
        .btn-secondary:hover { background: var(--option-bg); }
        .floating-widget { display: none; }
        body.quiz-active .floating-widget, .video-container { display: flex; }
        .floating-widget { position: fixed; padding: 10px 15px; background: var(--glass-bg); backdrop-filter: blur(5px); border: 1px solid var(--glass-border); color: var(--main-text-color); border-radius: 20px; box-shadow: 0 4px 15px var(--card-shadow); font-size: 0.9em; z-index: 1001; transition: all 0.3s ease; }
        .live-score { top: 20px; right: 20px; cursor: pointer; flex-direction: column; align-items: flex-end; gap: 5px; padding: 12px; text-align: right; }
        .live-score:hover { transform: translateY(-3px); box-shadow: 0 8px 25px var(--card-shadow-hover); }
        #score-text { font-weight: bold; font-size: 1.4em; }
        #score-text-label { font-size: 0.8em; color: var(--secondary-text-color); }
        #currentScore.updated { animation: score-pop 0.5s ease-out; }
        @keyframes score-pop { 0% { transform: scale(1); } 50% { transform: scale(1.5); color: var(--primary-color); } 100% { transform: scale(1); } }
        .accuracy-container { align-items: center; gap: 8px; width: 100%; margin-top: 5px; }
        #accuracyText { font-size: 0.8em; font-weight: bold; color: var(--accent-color); }
        .accuracy-bar-track { flex-grow: 1; height: 5px; background-color: var(--progress-track-bg); border-radius: 4px; overflow: hidden; }
        .accuracy-bar-fill { height: 100%; width: 0%; background-color: var(--accent-color); border-radius: 4px; transition: width 0.5s ease-out; }
        .tool-widget { top: 20px; left: 20px; align-items: center; border-radius: 25px; cursor: pointer; overflow: hidden; height: 45px; padding: 0 10px; transition: width 0.4s ease-in-out; width: 110px; }
        .tool-widget:hover { width: 220px; }
        .tool-content { display: flex; align-items: center; gap: 10px; width: 100%; }
        .tool-timer { display: flex; align-items: center; gap: 8px; font-weight: bold; }
        #timerDisplay { font-family: 'Courier New', Courier, monospace; letter-spacing: 1px; }
        .tool-actions { display: flex; align-items: center; gap: 5px; margin-left: auto; opacity: 0; transition: opacity 0.3s 0.1s; }
        .tool-widget:hover .tool-actions { opacity: 1; }
        .tool-action-btn { background: none; border: none; color: var(--main-text-color); cursor: pointer; font-size: 1.4em; padding: 5px; border-radius: 50%; display: flex; transition: background-color 0.2s; position: relative; }
        .tool-action-btn:hover { background-color: var(--option-hover-bg); }
        .tool-action-btn svg { width: 20px; height: 20px; }
        .tool-action-btn .tooltip-text { visibility: hidden; width: 120px; background-color: var(--tooltip-bg); color: #fff; text-align: center; border-radius: 6px; padding: 5px 0; position: absolute; z-index: 1; bottom: 125%; left: 50%; margin-left: -60px; opacity: 0; transition: opacity 0.3s; font-size: 0.9em; }
        .tool-action-btn:hover .tooltip-text { visibility: visible; opacity: 1; }
        .keyboard-hint { bottom: 20px; left: 20px; position: fixed; align-items: center; border-radius: 25px; cursor: pointer; overflow: hidden; width: 45px; height: 45px; padding: 0; transition: width 0.4s ease-in-out; }
        .keyboard-hint:hover { width: 400px; }
        .hint-icon { position: absolute; top: 0; left: 0; width: 45px; height: 45px; display: flex; align-items: center; justify-content: center; font-size: 1.6em; z-index: 2; }
        .hint-text { padding-left: 55px; white-space: nowrap; padding-right: 15px; opacity: 0; transition: opacity 0.3s 0.1s; font-size: 0.9em; }
        .keyboard-hint:hover .hint-text { opacity: 1; }
        .review-banner { display: none; background: rgba(74, 189, 172, 0.15); border-left: 4px solid var(--accent-color); padding: 10px 15px; margin-bottom: 20px; border-radius: 8px; font-size: 0.9em; }
        .question-card.review-mode-active .review-banner { display: flex; align-items: center; gap: 15px; }
        .review-banner .btn-link-review { background: none; border: none; color: var(--accent-color); text-decoration: underline; cursor: pointer; font-size: 0.9em; margin-left: auto; font-weight: bold; padding: 5px; }
        .review-banner .btn-link-review:hover { text-decoration: none; }
        .progress-container { background: var(--card-bg); padding: 20px; border-radius: 15px; margin-bottom: 20px; border: 1px solid var(--glass-border); transition: background-color 0.3s ease, border-color 0.3s ease; }
        .progress-header { display: flex; justify-content: space-between; align-items: baseline; margin-bottom: 10px; }
        .progress-track { position: relative; width: 100%; height: 20px; margin: 15px 0; }
        .progress-bar { width: 100%; height: 6px; background: var(--progress-track-bg); border-radius: 3px; position: absolute; top: 50%; transform: translateY(-50%); overflow: hidden; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, var(--primary-color), var(--secondary-color)); border-radius: 3px; transition: width 0.4s ease-out; width: 0%; }
        .progress-dots { display: flex; justify-content: space-between; align-items: center; width: 100%; position: absolute; top: 50%; transform: translateY(-50%); z-index: 2; }
        .progress-dot { width: 14px; height: 14px; background-color: var(--secondary-text-color); border-radius: 50%; transition: all 0.3s; position: relative; border: 3px solid var(--card-bg); cursor: not-allowed; }
        .progress-dot::after { content: attr(data-tooltip); position: absolute; bottom: 150%; left: 50%; transform: translateX(-50%); background-color: var(--tooltip-bg); color: white; padding: 5px 10px; border-radius: 5px; font-size: 0.8em; white-space: nowrap; opacity: 0; visibility: hidden; transition: opacity 0.3s, visibility 0.3s; pointer-events: none; z-index: 10; }
        .progress-dot.clickable:hover::after { opacity: 1; visibility: visible; }
        .progress-dot.clickable { cursor: pointer; }
        .progress-dot.completed-correct { background-color: var(--success-color); }
        .progress-dot.completed-incorrect { background-color: var(--error-color); }
        .progress-dot.active { background-color: var(--primary-color); border-color: var(--primary-color); transform: scale(1.2); box-shadow: 0 0 12px var(--primary-color); }
        .question-card { background: var(--card-bg); padding: 30px; border-radius: 20px; margin-bottom: 0; box-shadow: 0 10px 30px var(--card-shadow); display: none; transition: background-color 0.3s ease, border-color 0.3s ease; }
        .question-card.active { display: block; animation: slideInRight 0.5s ease-out forwards; }
        .question-card.slide-out { animation: slideOutLeft 0.4s ease-in forwards; }
        @keyframes slideInRight { from { opacity: 0; transform: translateX(50px); } to { opacity: 1; transform: translateX(0); } }
        @keyframes slideOutLeft { from { opacity: 1; transform: translateX(0); } to { opacity: 0; transform: translateX(-50px); } }
        .question-header { display: flex; align-items: center; margin-bottom: 20px; justify-content: space-between; }
        .question-header-left { display: flex; align-items: center; }
        .question-number { background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); color: white; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; margin-right: 15px; flex-shrink: 0;}
        .question-category { background: var(--option-bg); color: var(--main-text-color); padding: 5px 15px; border-radius: 20px; font-size: 0.9em; font-weight: bold; }
        .modern-topic-tag { color: var(--accent-color); font-weight: bold; margin-left: 5px; cursor: help; }
        .question-title { font-size: 1.4em; color: var(--main-text-color); margin: 15px 0; border-radius: 5px; transition: box-shadow 0.2s ease-out; }
        .question-title:focus-visible { outline: none; box-shadow: 0 0 0 3px rgba(var(--primary-color-rgb), 0.4); }
        .options { margin: 20px 0; }
        .option { display: flex; align-items: center; background: var(--option-bg); padding: 15px; margin: 10px 0; border-radius: 10px; cursor: pointer; transition: background-color 0.3s, transform 0.3s, border-color 0.3s; border: 2px solid transparent; }
        .option-number { font-weight: bold; color: var(--primary-color); border: 2px solid var(--primary-color); border-radius: 50%; width: 24px; height: 24px; display: inline-flex; justify-content: center; align-items: center; margin-right: 15px; flex-shrink: 0; transition: transform 0.2s; }
        .option:hover .option-number { transform: scale(1.2); }
        .option:hover { background: var(--option-hover-bg); transform: translateX(5px); }
        .option.selected { background-color: rgba(var(--primary-color-rgb), 0.2); border-color: var(--primary-color); }
        .option.correct { background: rgba(39, 174, 96, 0.2); border-color: var(--success-color); }
        .option.correct .option-number { background-color: var(--success-color); color: white; border-color: var(--success-color); }
        .option.correct.glow { animation: glow-correct 1.5s ease-out; }
        @keyframes glow-correct { 0% { box-shadow: 0 0 0px var(--success-color); } 50% { box-shadow: 0 0 15px var(--success-color); } 100% { box-shadow: 0 0 0px var(--success-color); } }
        .option.incorrect { background: rgba(231, 76, 60, 0.2); border-color: var(--error-color); }
        .option.incorrect .option-number { background-color: var(--error-color); color: white; border-color: var(--error-color); }
        .option.disabled { cursor: not-allowed; opacity: 0.7; }
        .option.disabled:hover { transform: none; background: var(--option-bg); }
        .option.disabled:hover .option-number { transform: none; }
        .feedback { margin: 20px 0; padding: 20px; border-radius: 10px; display: none; border-left-width: 5px; border-left-style: solid;}
        .feedback.show { display: block; animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .feedback.correct { background: rgba(39, 174, 96, 0.15); border-left-color: var(--success-color); }
        .feedback.incorrect { background: rgba(231, 76, 60, 0.15); border-left-color: var(--error-color); }
        .feedback-title { font-weight: bold; font-size: 1.1em; margin-bottom: 8px; }
        .feedback-explanation { margin-bottom: 15px; }
        .calculation-breakdown { background: var(--option-bg); padding: 10px 15px; border-radius: 8px; margin-top: 10px; font-family: 'Courier New', Courier, monospace; font-size: 0.95em; border-left: 3px solid var(--primary-color); }
        .context-box { background: rgba(var(--primary-color-rgb), 0.1); border-left: 5px solid var(--primary-color); padding: 15px; margin: 15px 0; border-radius: 5px; }
        .nav-buttons { display: flex; gap: 10px; margin-top: 20px; }
        .btn-nav { background: var(--glass-bg); backdrop-filter: blur(5px); border: 1px solid var(--glass-border); width: 45px; height: 45px; border-radius: 50%; transition: all 0.2s ease-out; display: flex; align-items: center; justify-content: center; color: var(--main-text-color); font-size: 1.5em; }
        .btn-nav:not(:disabled) { cursor: pointer; }
        .btn-nav:not(:disabled):hover { background: var(--option-hover-bg); transform: scale(1.1); }
        .btn-nav:not(:disabled):active { transform: scale(0.95); transition-duration: 0.1s; }
        .btn-nav:disabled { opacity: 0.4; cursor: not-allowed; backdrop-filter: none; }
        .nav-buttons .btn-nav:last-child:not(:disabled) { background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); color: white; border: none; box-shadow: 0 0 10px rgba(var(--primary-color-rgb), 0.4); }
        .nav-buttons.review-mode-active .btn-nav:last-child { background: var(--glass-bg); color: var(--main-text-color); border: 1px solid var(--glass-border); box-shadow: none; }
        .nav-buttons.review-mode-active .btn-nav:not(:disabled):hover { background: var(--option-hover-bg); transform: scale(1.1); }
        .ranking-container { display: flex; flex-wrap: wrap; gap: 20px; justify-content: center; align-items: flex-start; }
        .ranking-source, .ranking-slots { padding: 10px; border-radius: 10px; border: 2px dashed var(--secondary-text-color); }
        .ranking-source { display: flex; flex-direction: column; gap: 10px; min-height: 150px; flex-basis: 200px; }
        .ranking-slots { flex-basis: 300px; }
        .ranking-slot { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; }
        .ranking-slot .rank-label { font-weight: bold; width: 100px; text-align: right; }
        .ranking-slot .dropzone { flex: 1; min-height: 45px; border-radius: 8px; }
        details { margin-top: 15px; background: var(--option-bg); border-radius: 8px; padding: 5px 15px; border-left: 3px solid var(--accent-color); }
        summary { cursor: pointer; font-weight: bold; padding: 10px 0; outline: none; display: flex; align-items: center; justify-content: space-between; list-style: none; }
        summary::-webkit-details-marker { display: none; }
        summary::after { content: '▼'; font-size: 0.8em; transition: transform 0.3s ease; }
        details[open] summary::after { transform: rotate(180deg); }
        .details-content { padding: 0 0 10px 0; font-size: 0.95em; }
        .results { text-align: center; padding: 30px; background: var(--card-bg); border-radius: 20px; display: none; position: relative; transition: background-color 0.3s ease; }
        .results.show { display: block; animation: zoomIn 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes zoomIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
        .score-circle { width: 150px; height: 150px; border-radius: 50%; margin: 20px auto; display: flex; align-items: center; justify-content: center; font-size: 2em; font-weight: bold; transition: background 0.5s ease, color 0.5s ease; }
        .results-summary { margin-top: 30px; text-align: left; }
        .summary-item { display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid var(--glass-border); font-size: 0.9em; cursor: pointer; transition: background-color 0.2s; }
        .summary-item:hover { background-color: var(--option-hover-bg); }
        .summary-item:last-child { border-bottom: none; }
        .summary-item > div { display: flex; align-items: center; }
        .summary-result { font-weight: bold; padding: 3px 8px; border-radius: 12px; color: white; }
        .summary-result.correct { background-color: var(--success-color); }
        .summary-result.incorrect { background-color: var(--error-color); }
        .score-title { font-size: 1.5em; margin-top: 15px; color: var(--main-text-color); }
        .key-takeaways { margin: 30px 0; padding: 20px; background: rgba(74, 189, 172, 0.1); border-left: 4px solid var(--accent-color); border-radius: 8px; text-align: left; }
        .key-takeaways ul { list-style-type: '✓ '; padding-left: 20px; }
        .key-takeaways li { margin-bottom: 10px; }
        .badges-earned-container { margin: 30px 0; padding: 20px; background: rgba(var(--primary-color-rgb), 0.1); border-left: 4px solid var(--primary-color); border-radius: 8px; text-align: left; }
        #badges-earned { display: flex; flex-wrap: wrap; gap: 15px; justify-content: center; }
        .badge-earned-item { display: flex; flex-direction: column; align-items: center; width: 80px; cursor: help; }
        .badge-earned-item .badge-icon { font-size: 2.5em; }
        .badge-earned-item p { font-size: 0.8em; text-align: center; margin-top: 5px; }
        .badge-earned-item.unearned { filter: grayscale(90%); opacity: 0.5; transition: filter 0.3s ease, opacity 0.3s ease; }
        .badge-earned-item.unearned:hover { filter: grayscale(0); opacity: 1; }
        .results-actions { display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; margin-top: 30px; }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; box-shadow: none; }
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); backdrop-filter: blur(5px); z-index: 2000; display: none; align-items: center; justify-content: center; opacity: 0; transition: opacity 0.3s ease-out; }
        html[data-theme='light'] .modal-overlay { background: rgba(244, 246, 248, 0.7); }
        .modal-overlay.show { display: flex; opacity: 1; }
        .stats-modal { background: var(--card-bg); color: var(--main-text-color); padding: 30px; border-radius: 20px; width: 90%; max-width: 600px; box-shadow: 0 10px 30px var(--card-shadow); position: relative; transition: background-color 0.3s ease, color 0.3s ease; transform: scale(0.95); opacity: 0; }
        .modal-overlay.show .stats-modal { animation: modal-fade-in 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }
        .modal-overlay.hiding .stats-modal { animation: modal-fade-out 0.3s ease-out forwards; }
        @keyframes modal-fade-in { to { transform: scale(1); opacity: 1; } }
        @keyframes modal-fade-out { from { transform: scale(1); opacity: 1; } to { transform: scale(0.95); opacity: 0; } }
        .modal-close-btn { position: absolute; top: 15px; right: 15px; background: var(--option-hover-bg); color: var(--main-text-color); border: none; border-radius: 50%; width: 30px; height: 30px; font-size: 1.2em; cursor: pointer; transition: background-color 0.3s, transform 0.3s; }
        .modal-close-btn:hover { transform: rotate(90deg); }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 20px; text-align: center; margin: 20px 0; }
        .stat-item h4 { color: var(--primary-color); }
        .badges-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 15px; }
        .badge { text-align: center; }
        .badge-icon { font-size: 3em; border-radius: 50%; background: var(--option-bg); color: var(--secondary-text-color); width: 70px; height: 70px; display: flex; align-items: center; justify-content: center; margin: 0 auto; transition: all 0.4s ease; }
        .badge-icon.unlocked { background: var(--primary-color); color: white; transform: scale(1.1); box-shadow: 0 0 15px var(--primary-color); }
        .badge p { font-size: 0.8em; margin-top: 5px; font-weight: bold; }
        .reset-button-container { text-align: center; margin-top: 25px; border-top: 1px solid var(--glass-border); padding-top: 20px; }
        .reset-button-container p { font-size: 0.9em; color: var(--secondary-text-color); margin-bottom: 10px; }
        #confetti-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; overflow: hidden; pointer-events: none; z-index: 10; }
        .confetti { position: absolute; width: 10px; height: 10px; background-color: #f00; opacity: 1; animation: fall 5s linear forwards; }
        @keyframes fall { to { transform: translateY(110vh) rotate(720deg); opacity: 0; } }
        .interactive-question-container { display: flex; flex-wrap: wrap; gap: 20px; margin-top: 20px; user-select: none; }
        .draggable-item { background: var(--card-bg); padding: 10px; border-radius: 8px; cursor: grab; text-align: center; border: 2px solid var(--primary-color); transition: background-color 0.3s, border-color 0.3s, opacity 0.2s; color: var(--main-text-color); }
        html[data-theme='light'] .draggable-item { background: #e9ecef; }
        .draggable-item:active { cursor: grabbing; opacity: 0.8; }
        .dropzone .draggable-item.correct { border-color: var(--success-color); background-color: rgba(39, 174, 96, 0.2); }
        .dropzone .draggable-item.incorrect { border-color: var(--error-color); background-color: rgba(231, 76, 60, 0.2); }
        .dropzone { flex: 1; min-height: 50px; background: var(--progress-track-bg); border: 2px dashed var(--secondary-text-color); border-radius: 10px; display: flex; align-items: center; justify-content: center; transition: background-color 0.3s; }
        html[data-theme='light'] .dropzone.over { background-color: #dee2e6; }
        html[data-theme='dark'] .dropzone.over { background-color: #2c3e50; }
        .interactive-question-container.disabled .draggable-item { cursor: not-allowed; }
        .interactive-question-container.disabled .dropzone, .interactive-question-container.disabled .timeline-events { pointer-events: none; opacity: 0.8; }
        .timeline-container .timeline-events { flex: 1; min-width: 200px; border: 2px dashed var(--secondary-text-color); border-radius: 10px; padding: 10px; display: flex; flex-direction: column; gap: 10px; transition: background-color 0.3s;}
        .timeline-slots { flex: 2; min-width: 300px; }
        .timeline-slot { display: flex; align-items: center; margin-bottom: 10px; }
        .timeline-year { font-weight: bold; width: 100px; color: var(--main-text-color); }
        .question-image { max-width: 100%; border-radius: 10px; margin: 15px auto; display: block; box-shadow: 0 4px 10px var(--card-shadow); }
        .sorting-container { display: flex; flex-direction: column; gap: 20px; }
        .sorting-bins { display: flex; gap: 20px; flex-wrap: wrap; }
        .sorting-bin { flex: 1; min-width: 250px; padding: 10px; border: 2px solid var(--secondary-text-color); border-radius: 10px; }
        .sorting-bin h4 { text-align: center; margin-bottom: 10px; color: var(--main-text-color); }
        .sorting-bin .dropzone { flex-direction: column; gap: 8px; min-height: 100px; align-items: stretch; padding: 8px;}
        .sorting-source-list { display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; padding: 10px; border: 2px dashed var(--secondary-text-color); border-radius: 10px; margin-top: 10px; }
        .smart-lamppost-builder { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; margin-top: 20px; }
        .feature-option { background: var(--option-bg); padding: 15px; border-radius: 10px; border: 2px solid var(--secondary-text-color); cursor: pointer; text-align: center; transition: transform 0.3s, box-shadow 0.3s, border-color 0.3s, background-color 0.3s; }
        .feature-option:hover, .feature-option:focus-visible { transform: translateY(-3px); box-shadow: 0 4px 8px var(--card-shadow); outline: 2px solid var(--primary-color); }
        .feature-option.selected { border-color: var(--primary-color); background-color: rgba(var(--primary-color-rgb), 0.2); box-shadow: 0 4px 8px rgba(0,0,0,0.15); }
        .feature-option.disabled { cursor: not-allowed; opacity: 0.7; }
        .feature-option.disabled:hover, .feature-option.disabled:focus-visible { transform: none; box-shadow: none; outline: none; }
        .feature-icon { font-size: 2.5em; margin-bottom: 10px; color: var(--primary-color); }
        #q17-description-box { margin-top: 20px; display: none; }
        #q17-description-box ul { list-style-type: none; padding-left: 0; }
        #q17-description-box li { margin-bottom: 8px; }
        .video-container { position: fixed; bottom: 80px; right: 20px; width: 280px; background: var(--glass-bg); border: 1px solid var(--glass-border); border-radius: 15px; box-shadow: 0 8px 32px var(--card-shadow); z-index: 1000; transition: all 0.4s ease-in-out; overflow: hidden; display: flex; flex-direction: column; }
        .video-container:not(.minimized):hover { transform: scale(1.03); box-shadow: 0 12px 40px var(--card-shadow-hover); }
        .video-container.minimized { width: 60px; height: 60px; border-radius: 50%; background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); box-shadow: 0 5px 15px rgba(0,0,0,0.3); border: 2px solid rgba(255, 255, 255, 0.5); padding: 0; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .video-container.minimized:hover { transform: scale(1.1); box-shadow: 0 8px 25px var(--card-shadow-hover); }
        .video-header { background: linear-gradient(135deg, rgba(var(--primary-color-rgb), 0.8), rgba(252, 74, 26, 0.8)); color: white; padding: 10px 15px; font-weight: bold; display: flex; justify-content: space-between; align-items: center; cursor: pointer; user-select: none; height: auto; }
        html[data-theme='light'] .video-header { background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); }
        .video-container.minimized .video-header { background: transparent; justify-content: center; align-items: center; height: 100%; padding: 0; }
        .video-controls button { background: rgba(255,255,255,0.2); border: none; color: white; width: 24px; height: 24px; border-radius: 50%; cursor: pointer; transition: background 0.3s ease; display: flex; align-items: center; justify-content: center; }
        .video-controls button:hover { background: rgba(255,255,255,0.4); }
        .video-content { padding: 5px; }
        .video-player-container { width: 100%; height: 152px; background-image: url('https://i.ytimg.com/vi/GRwOsXCW2jM/hqdefault.jpg'); background-size: cover; background-position: center; cursor: pointer; border-radius: 8px; display: flex; align-items: center; justify-content: center; position: relative; }
        .video-player-container::before { content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(0,0,0,0.4); border-radius: 8px; transition: background-color 0.3s; pointer-events: auto; }
        .video-player-container.player-active::before { display: none; }
        .video-player-container:hover::before { background-color: rgba(0,0,0,0.2); }
        .play-icon-svg { width: 50px; height: 50px; fill: rgba(255, 255, 255, 0.9); z-index: 1; transition: transform 0.3s; filter: drop-shadow(0 2px 5px rgba(0,0,0,0.5)); pointer-events: none; }
        .video-player-container.player-active .play-icon-svg { display: none; }
        .video-player-container iframe { width: 100%; height: 100%; border: none; border-radius: 8px; }
        .video-container.minimized .video-title, .video-container.minimized .video-controls, .video-container.minimized .video-content { display: none; }
        .dynamic-icon { transition: transform 0.3s ease; display: inline-block; font-size: 1.8em; }
        #toast-container { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); z-index: 9999; display: flex; flex-direction: column-reverse; gap: 10px; align-items: center; pointer-events: none;}
        .toast { display: flex; align-items: center; gap: 15px; background: #222; color: white; padding: 12px 20px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.3); animation: toast-in-out 4s ease-in-out forwards; }
        html[data-theme='light'] .toast { background: #34495e; }
        @keyframes toast-in-out { 0% { transform: translateY(100px) scale(0.9); opacity: 0; } 15% { transform: translateY(0) scale(1); opacity: 1; } 85% { transform: translateY(0) scale(1); opacity: 1; } 100% { transform: translateY(100px) scale(0.9); opacity: 0; } }
        footer { text-align: center; padding: 10px 20px; color: var(--footer-text-color); font-size: 0.9em; margin-top: 20px; transition: color 0.3s ease; }
        .tooltip { position: relative; border-bottom: 1px dotted var(--primary-color); cursor: help; }
        .tooltip .tooltip-text { visibility: hidden; width: 220px; background-color: var(--tooltip-bg); color: #fff; text-align: center; border-radius: 6px; padding: 8px; position: absolute; z-index: 100; bottom: 125%; left: 50%; margin-left: -110px; opacity: 0; transition: opacity 0.3s; font-size: 0.9em; font-weight: normal; }
        .tooltip .tooltip-text::after { content: ""; position: absolute; top: 100%; left: 50%; margin-left: -5px; border-width: 5px; border-style: solid; border-color: var(--tooltip-bg) transparent transparent transparent; }
        .tooltip:hover .tooltip-text { visibility: visible; opacity: 1; }
        @media (max-width: 768px) { .video-container { width: 250px; } .floating-widget { font-size: 0.8em; padding: 8px 12px; } .keyboard-hint:hover { width: 300px; } .tool-widget { width: 95px; } .tool-widget:hover { width: 180px; } }
        @media (max-width: 480px) { .header:not(.header-compact) h1 { font-size: 1.8em; } .start-actions { flex-direction: column; } }
    </style>
</head>
<body>
    <div class="live-score floating-widget" id="liveScore" aria-live="polite" onclick="openStatsModal()">
        <span id="score-text-label">Score</span>
        <span id="score-text"><span id="currentScore">0</span> / <span id="totalQuestionsDisplay">0</span></span>
        <div class="accuracy-container">
            <span id="accuracyText">--%</span>
            <div class="accuracy-bar-track"><div class="accuracy-bar-fill" id="accuracyBarFill"></div></div>
        </div>
    </div>
    
    <div class="tool-widget floating-widget" id="toolWidget">
        <div class="tool-content">
            <div class="tool-timer">
                <span class="timer-icon">⏱️</span>
                <span id="timerDisplay">00:00</span>
            </div>
            <div class="tool-actions">
                <button class="tool-action-btn" id="homeBtn"><span class="tooltip-text">Accueil</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8h5z" fill="currentColor"/></svg></button>
                <button class="tool-action-btn" id="toolResetBtn"><span class="tooltip-text">Réinitialiser</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17.65 6.35A7.958 7.958 0 0 0 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08A5.99 5.99 0 0 1 12 18c-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z" fill="currentColor"/></svg></button>
            </div>
        </div>
    </div>

    <div class="keyboard-hint floating-widget" id="keyboardHint">
        <span class="hint-icon">⌨️</span>
        <span class="hint-text">Astuce : [1-4] pour répondre, [→] pour continuer.</span>
    </div>
    
    <div class="container">
        <header class="header" id="mainHeader">
            <div class="header-title-container">
                <h1>L'Éclairage Urbain</h1>
                <p class="subtitle">Des Lumières de la Ville aux Smart Cities</p>
            </div>
            <label for="theme-toggle-switch" class="theme-switch" title="Changer de thème">
                <span class="theme-switch-label" id="moon-icon">🌙</span>
                <span class="theme-switch-label" id="sun-icon">☀️</span>
                <input type="checkbox" id="theme-toggle-switch">
                <div class="switch-track"><div class="switch-thumb"></div></div>
            </label>
        </header>

        <div id="startScreen">
            <h2 class="start-title">Bienvenue ! Prêt à illuminer vos connaissances ?</h2>
            <p>Ce quiz interactif vous fera voyager à travers l'histoire et les technologies de l'éclairage public, des premières lanternes à gaz jusqu'aux lampadaires intelligents de demain.</p>
            
            <div class="start-section">
                <h4>🧠 Compétences clés évaluées :</h4>
                <ul>
                    <li>Compréhension de l'évolution historique de l'éclairage.</li>
                    <li>Connaissance des différentes technologies (incandescence, décharge, LED).</li>
                    <li>Analyse des enjeux énergétiques et environnementaux.</li>
                    <li>Vision des innovations des Smart Cities.</li>
                </ul>
            </div>
            
            <div class="start-section">
                <h4>🎬 Conseil de préparation :</h4>
                <div class="start-video-box">
                    <p>Pour mettre toutes les chances de votre côté, visionnez la vidéo "C'est Pas Sorcier" (26 min). Vous pouvez la lancer ici ou utiliser le widget 🎬 en bas à droite pour la garder visible pendant le quiz.</p>
                    <a href="https://youtu.be/GRwOsXCW2jM" target="_blank" class="video-link-start" title="C'est Pas Sorcier - Lumières de la ville (26 minutes)">🎬 Voir la vidéo</a>
                </div>
            </div>

            <div class="start-section">
                <h4 style="color: var(--accent-color);">💡 Bon à savoir avant de commencer</h4>
                 <div class="start-update-box" style="border-left-color: var(--accent-color);">
                    <p>La vidéo de référence date un peu. Depuis, la technologie a bondi ! Si elle montre bien les anciennes lampes, aujourd'hui c'est la <span class="tooltip">LED<span class="tooltip-text">Diode Électroluminescente. Source lumineuse très efficace et durable.</span></span> qui domine. Ce quiz reflète ces évolutions en abordant des thèmes récents :</p>
                    <ul style="list-style-type: '› '; padding-left: 20px; font-size: 0.9em; margin-top: 10px;">
                        <li>Le rôle des lampadaires dans les <strong>Smart Cities</strong>.</li>
                        <li>Les technologies de détection avancées (radars).</li>
                        <li>Les enjeux de biodiversité liés à la couleur de la lumière.</li>
                    </ul>
                </div>
            </div>

            <div class="start-actions">
                <button class="btn btn-primary" id="startQuizBtn">🚀 Commencer le Quiz !</button>
                <button class="btn btn-secondary" id="resumeBtn">🔄 Reprendre la session</button>
            </div>
            <footer id="startFooter">Réalisé par David Trafial</footer>
        </div>

        <div class="quiz-content hidden">
            <div class="progress-container">
                <div class="progress-header"><h3>Progression</h3><p id="progressText">Question 1 / 20</p></div>
                <div class="progress-track">
                    <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
                    <div class="progress-dots" id="progressDots"></div>
                </div>
            </div>
            
            <div id="questions-wrapper">
                 <div class="question-card" data-question="1"><div class="review-banner">🧐 <strong>Mode Révision :</strong> Vous consultez vos réponses. <button class="btn-link-review">Retour aux résultats</button></div><div class="question-header"><div class="question-header-left"><div class="question-number">1</div><div class="question-category">Histoire</div></div><div class="nav-buttons"></div></div><h2 class="question-title" id="q1-title" tabindex="-1">Quel type d'éclairage dominait les villes jusqu'au XIXème siècle ?</h2><div class="options" role="radiogroup" aria-labelledby="q1-title"><div class="option" data-answer="a" role="radio" aria-checked="false"><span class="option-number">1</span>L'éclairage électrique</div><div class="option" data-answer="b" role="radio" aria-checked="false"><span class="option-number">2</span>L'éclairage au gaz</div><div class="option" data-answer="c" role="radio" aria-checked="false"><span class="option-number">3</span>L'éclairage solaire</div><div class="option" data-answer="d" role="radio" aria-checked="false"><span class="option-number">4</span>L'éclairage LED</div></div><div class="feedback" id="feedback1" tabindex="-1"><p class="feedback-title">Réponse : L'éclairage au gaz</p><p class="feedback-explanation">Avant l'avènement de l'électricité, le gaz de ville, produit par la distillation de la houille, était la principale source d'éclairage public.</p><div class="context-box"><h4>📚 Contexte</h4><p>Paris fut l'une des premières villes au monde à adopter l'éclairage public au gaz à grande échelle vers 1820, lui valant son surnom de "Ville Lumière".</p></div></div></div>
            
            <div class="question-card" data-question="2"><div class="review-banner">🧐 <strong>Mode Révision :</strong> Vous consultez vos réponses. <button class="btn-link-review">Retour aux résultats</button></div><div class="question-header"><div class="question-header-left"><div class="question-number">2</div><div class="question-category">Histoire</div></div><div class="nav-buttons"></div></div><h2 class="question-title" id="q2-title" tabindex="-1">En quelle année Thomas Edison a-t-il présenté sa première lampe à incandescence durable au public ?</h2><div class="options" role="radiogroup" aria-labelledby="q2-title"><div class="option" data-answer="a" role="radio" aria-checked="false"><span class="option-number">1</span>1879</div><div class="option" data-answer="b" role="radio" aria-checked="false"><span class="option-number">2</span>1881</div><div class="option" data-answer="c" role="radio" aria-checked="false"><span class="option-number">3</span>1885</div><div class="option" data-answer="d" role="radio" aria-checked="false"><span class="option-number">4</span>1890</div></div><div class="feedback" id="feedback2" tabindex="-1"><p class="feedback-title">Réponse : 1879</p><p class="feedback-explanation">C'est fin 1879 que Thomas Edison a fait la démonstration publique de sa lampe, qui pouvait briller pendant environ 13 heures, une révolution pour l'époque.</p><details><summary>En savoir + sur le filament</summary><div class="details-content"><p>Le filament de cette première lampe était un simple <strong>fil de coton à coudre, carbonisé</strong>. Cette innovation a été ensuite grandement améliorée, notamment avec l'utilisation de bambou du Japon carbonisé, permettant d'atteindre des durées de vie de plusieurs centaines d'heures.</p></div></details></div></div>
            
            <div class="question-card" data-question="3"><div class="review-banner">🧐 <strong>Mode Révision :</strong> Vous consultez vos réponses. <button class="btn-link-review">Retour aux résultats</button></div><div class="question-header"><div class="question-header-left"><div class="question-number">3</div><div class="question-category">Infrastructure</div></div><div class="nav-buttons"></div></div><h2 class="question-title" id="q3-title" tabindex="-1">Combien de points lumineux parsèment Paris (chiffre de l'épisode) ?</h2><div class="options" role="radiogroup" aria-labelledby="q3-title"><div class="option" data-answer="a" role="radio" aria-checked="false"><span class="option-number">1</span>50 000</div><div class="option" data-answer="b" role="radio" aria-checked="false"><span class="option-number">2</span>100 000</div><div class="option" data-answer="c" role="radio" aria-checked="false"><span class="option-number">3</span>150 000</div><div class="option" data-answer="d" role="radio" aria-checked="false"><span class="option-number">4</span>200 000</div></div><div class="feedback" id="feedback3" tabindex="-1"><p class="feedback-title">Réponse : 150 000 points lumineux</p><p class="feedback-explanation">À l'époque du tournage, Paris comptait ce nombre impressionnant de sources lumineuses pour assurer l'éclairage de ses rues et monuments.</p><div class="context-box"><h4>🔧 Maintenance</h4><p>Aujourd'hui, ce chiffre a évolué et une grande partie de ce parc est convertie en <span class="tooltip">LED<span class="tooltip-text">Diode Électroluminescente.</span></span> et gérée par des systèmes de télégestion pour optimiser la consommation et la maintenance.</p></div></div></div>
            
            <div class="question-card" data-question="4"><div class="review-banner">🧐 <strong>Mode Révision :</strong> Vous consultez vos réponses. <button class="btn-link-review">Retour aux résultats</button></div><div class="question-header"><div class="question-header-left"><div class="question-number">4</div><div class="question-category">Technique</div></div><div class="nav-buttons"></div></div><h2 class="question-title" id="q4-title" tabindex="-1">Selon Jamy, comment une lampe à incandescence produit-elle de la lumière ?</h2><div class="options" role="radiogroup" aria-labelledby="q4-title"><div class="option" data-answer="a" role="radio" aria-checked="false"><span class="option-number">1</span>Par combustion d'un gaz</div><div class="option" data-answer="b" role="radio" aria-checked="false"><span class="option-number">2</span>En chauffant un filament jusqu'à l'incandescence</div><div class="option" data-answer="c" role="radio" aria-checked="false"><span class="option-number">3</span>Par décharge électrique dans un tube</div><div class="option" data-answer="d" role="radio" aria-checked="false"><span class="option-number">4</span>Par réaction chimique</div></div><div class="feedback" id="feedback4" tabindex="-1"><p class="feedback-title">Réponse : En chauffant un filament jusqu'à l'incandescence</p><p class="feedback-explanation">Le passage du courant électrique dans un filament (souvent en tungstène) le chauffe à une température si élevée qu'il émet de la lumière visible.</p><details><summary>En savoir + sur l'inefficacité</summary><div class="details-content"><p>Ce procédé est très inefficace : <strong>plus de 90% de l'énergie est perdue sous forme de chaleur !</strong> C'est pourquoi ces ampoules sont très chaudes au toucher. En comparaison, une LED moderne convertit jusqu'à 95% de son énergie en lumière, ce qui explique sa faible consommation et pourquoi elle reste froide.</p></div></details></div></div>
            
            <div class="question-card" data-question="5"><div class="review-banner">🧐 <strong>Mode Révision :</strong> Vous consultez vos réponses. <button class="btn-link-review">Retour aux résultats</button></div><div class="question-header"><div class="question-header-left"><div class="question-number">5</div><div class="question-category">Ampoules</div></div><div class="nav-buttons"></div></div><h2 class="question-title" id="q5-title" tabindex="-1">Quelle est la différence principale entre une lampe classique et une lampe halogène ?</h2><div class="options" role="radiogroup" aria-labelledby="q5-title"><div class="option" data-answer="a" role="radio" aria-checked="false"><span class="option-number">1</span>La lampe halogène a un filament différent</div><div class="option" data-answer="b" role="radio" aria-checked="false"><span class="option-number">2</span>La lampe halogène contient un gaz qui permet un filament plus chaud</div><div class="option" data-answer="c" role="radio" aria-checked="false"><span class="option-number">3</span>La lampe halogène fonctionne sans électricité</div><div class="option" data-answer="d" role="radio" aria-checked="false"><span class="option-number">4</span>La lampe halogène est plus grosse</div></div><div class="feedback" id="feedback5" tabindex="-1"><p class="feedback-title">Réponse : La lampe halogène contient un gaz</p><p class="feedback-explanation">L'ampoule contient un gaz halogéné (iode ou brome) qui, par un cycle chimique, redépose le tungstène évaporé sur le filament. Cela permet au filament de chauffer plus, produisant une lumière plus blanche et vive.</p><details><summary>En savoir + sur le cycle halogène</summary><div class="details-content"><p>Ce cycle a permis d'augmenter la durée de vie (de 1000h à 2000h) et l'efficacité des lampes à incandescence. C'était une amélioration importante, mais elles restent bien moins performantes que les lampes fluocompactes ou les LED qui les ont remplacées.</p></div></details></div></div>
            
            <div class="question-card" data-question="6"><div class="review-banner">🧐 <strong>Mode Révision :</strong> Vous consultez vos réponses. <button class="btn-link-review">Retour aux résultats</button></div><div class="question-header"><div class="question-header-left"><div class="question-number">6</div><div class="question-category">Lampes à décharge</div></div><div class="nav-buttons"></div></div><h2 class="question-title" id="q6-title" tabindex="-1">Qu'est-ce qu'une lampe à décharge selon les explications de Jamy ?</h2><div class="options" role="radiogroup" aria-labelledby="q6-title"><div class="option" data-answer="a" role="radio" aria-checked="false"><span class="option-number">1</span>Une lampe qui se décharge comme une pile</div><div class="option" data-answer="b" role="radio" aria-checked="false"><span class="option-number">2</span>Une lampe qui produit de la lumière par décharge électrique dans un gaz</div><div class="option" data-answer="c" role="radio" aria-checked="false"><span class="option-number">3</span>Une lampe qui ne fonctionne que le jour</div><div class="option" data-answer="d" role="radio" aria-checked="false"><span class="option-number">4</span>Une lampe sans filament</div></div><div class="feedback" id="feedback6" tabindex="-1"><p class="feedback-title">Réponse : Production de lumière par décharge électrique dans un gaz</p><p class="feedback-explanation">Contrairement à l'incandescence, cette technologie n'utilise pas de filament chauffé. Un arc électrique est créé entre deux électrodes, ce qui excite un gaz (sodium, mercure...) qui émet alors de la lumière.</p><div class="context-box"><h4>🚀 Remplacement massif</h4><p>Les lampadaires à la lumière orange caractéristique (lampes à sodium) sont un exemple typique de lampes à décharge. Ils sont massivement remplacés par des LED plus efficaces et polyvalentes.</p></div></div></div>
            
            <div class="question-card" data-question="7"><div class="review-banner">🧐 <strong>Mode Révision :</strong> Vous consultez vos réponses. <button class="btn-link-review">Retour aux résultats</button></div><div class="question-header"><div class="question-header-left"><div class="question-number">7</div><div class="question-category">Environnement</div></div><div class="nav-buttons"></div></div><h2 class="question-title" id="q7-title" tabindex="-1">Quel est l'un des défis environnementaux majeurs de l'éclairage urbain ?</h2><div class="options" role="radiogroup" aria-labelledby="q7-title"><div class="option" data-answer="a" role="radio" aria-checked="false"><span class="option-number">1</span>Le manque de lumière</div><div class="option" data-answer="b" role="radio" aria-checked="false"><span class="option-number">2</span>La pollution lumineuse et son impact sur la faune nocturne</div><div class="option" data-answer="c" role="radio" aria-checked="false"><span class="option-number">3</span>Le coût trop faible</div><div class="option" data-answer="d" role="radio" aria-checked="false"><span class="option-number">4</span>L'éclairage trop coloré</div></div><div class="feedback" id="feedback7" tabindex="-1"><p class="feedback-title">Réponse : La pollution lumineuse</p><p class="feedback-explanation">L'éclairage artificiel excessif ou mal dirigé crée un "halo lumineux" au-dessus des villes qui perturbe les écosystèmes, notamment les cycles de vie et de migration des animaux nocturnes (insectes, oiseaux, chauves-souris).</p><details><summary>En savoir + sur les couleurs (Kelvin)</summary><div class="details-content"><p>La "couleur" de la lumière se mesure en <strong>Kelvin (K)</strong>. Une lumière "chaude" (orange, ~2200K) contient peu de lumière bleue et perturbe moins la faune. Une lumière "froide" (blanche-bleutée, > 4000K) est riche en lumière bleue et a un impact plus fort. Les villes privilégient donc des LED de <strong>moins de 3000K</strong> pour protéger la biodiversité.</p></div></details></div></div>
            
            <div class="question-card" data-question="8"><div class="review-banner">🧐 <strong>Mode Révision :</strong> Vous consultez vos réponses. <button class="btn-link-review">Retour aux résultats</button></div><div class="question-header"><div class="question-header-left"><div class="question-number">8</div><div class="question-category">Énergie alternative</div></div><div class="nav-buttons"></div></div><h2 class="question-title" id="q8-title" tabindex="-1">Quelle innovation surprenante permet d'alimenter l'éclairage de manière écologique ?</h2><div class="options" role="radiogroup" aria-labelledby="q8-title"><div class="option" data-answer="a" role="radio" aria-checked="false"><span class="option-number">1</span>Les batteries de sol utilisant les plantes</div><div class="option" data-answer="b" role="radio" aria-checked="false"><span class="option-number">2</span>L'énergie du vent uniquement</div><div class="option" data-answer="c" role="radio" aria-checked="false"><span class="option-number">3</span>Les hamsters dans des roues</div><div class="option" data-answer="d" role="radio" aria-checked="false"><span class="option-number">4</span>L'énergie des voitures qui passent</div></div><div class="feedback" id="feedback8" tabindex="-1"><p class="feedback-title">Réponse : Les batteries de sol utilisant les plantes</p><p class="feedback-explanation">Des startups développent des technologies qui exploitent les micro-organismes présents dans le sol autour des racines des plantes. Ces microbes dégradent la matière organique et libèrent des électrons, créant un courant électrique.</p><div class="context-box"><h4>🧬 Biotechnologies</h4><p>Bien qu'encore expérimentale et à faible rendement, cette approche bio-inspirée montre une voie fascinante pour une énergie décentralisée et intégrée à l'environnement urbain.</p></div></div></div>
            
            <div class="question-card" data-question="9"><div class="review-banner">🧐 <strong>Mode Révision :</strong> Vous consultez vos réponses. <button class="btn-link-review">Retour aux résultats</button></div><div class="question-header"><div class="question-header-left"><div class="question-number">9</div><div class="question-category">Smart Cities <span class="modern-topic-tag" title="Sujet moderne non couvert par la vidéo de référence.">*</span></div></div><div class="nav-buttons"></div></div><h2 class="question-title" id="q9-title" tabindex="-1">Dans une "ville intelligente", un lampadaire peut maintenant servir à :</h2><div class="options" role="radiogroup" aria-labelledby="q9-title"><div class="option" data-answer="a" role="radio" aria-checked="false"><span class="option-number">1</span>Seulement éclairer les rues</div><div class="option" data-answer="b" role="radio" aria-checked="false"><span class="option-number">2</span>Mesurer la qualité de l'air, fournir du Wi-Fi et diffuser des infos</div><div class="option" data-answer="c" role="radio" aria-checked="false"><span class="option-number">3</span>Uniquement décorer la ville</div><div class="option" data-answer="d" role="radio" aria-checked="false"><span class="option-number">4</span>Remplacer les feux de circulation</div></div><div class="feedback" id="feedback9" tabindex="-1"><p class="feedback-title">Réponse : Mesurer la qualité de l'air, fournir du Wi-Fi...</p><p class="feedback-explanation">Le lampadaire, déjà alimenté et présent partout en ville, est devenu le support idéal pour une multitude de capteurs et services connectés.</p><details><summary>En savoir + sur le Li-Fi</summary><div class="details-content"><p>Certains lampadaires peuvent même transmettre des données via la lumière elle-même ! C'est la technologie <strong>Li-Fi (Light Fidelity)</strong>. En modulant l'intensité de la lumière à une fréquence imperceptible pour l'œil humain, on peut créer une connexion internet très rapide et sécurisée, complémentaire au Wi-Fi.</p></div></details></div></div>
            
            <div class="question-card" data-question="10"><div class="review-banner">🧐 <strong>Mode Révision :</strong> Vous consultez vos réponses. <button class="btn-link-review">Retour aux résultats</button></div><div class="question-header"><div class="question-header-left"><div class="question-number">10</div><div class="question-category">Économies</div></div><div class="nav-buttons"></div></div><h2 class="question-title" id="q10-title" tabindex="-1">Quelle économie d'énergie peut réaliser une ville en passant à l'éclairage <span class="tooltip">LED<span class="tooltip-text">Diode Électroluminescente.</span></span> intelligent ?</h2><div class="options" role="radiogroup" aria-labelledby="q10-title"><div class="option" data-answer="a" role="radio" aria-checked="false"><span class="option-number">1</span>10 à 20%</div><div class="option" data-answer="b" role="radio" aria-checked="false"><span class="option-number">2</span>30 à 40%</div><div class="option" data-answer="c" role="radio" aria-checked="false"><span class="option-number">3</span>50 à 75%</div><div class="option" data-answer="d" role="radio" aria-checked="false"><span class="option-number">4</span>90 à 100%</div></div><div class="feedback" id="feedback10" tabindex="-1"><p class="feedback-title">Réponse : 50 à 75%</p><p class="feedback-explanation">La combinaison de la haute efficacité des LED (par rapport aux anciennes lampes) et des systèmes de gestion intelligents (qui modulent l'intensité lumineuse selon les besoins) permet de réaliser des économies d'énergie très significatives.</p><div class="context-box"><h4>📈 Retour sur investissement</h4><p>Malgré un coût d'installation élevé, le retour sur investissement est rapide (souvent entre 3 et 7 ans) grâce aux économies sur la facture d'électricité et la réduction des coûts de maintenance.</p></div></div></div>
            
            <div class="question-card" data-question="11"><div class="review-banner">🧐 <strong>Mode Révision :</strong> Vous consultez vos réponses. <button class="btn-link-review">Retour aux résultats</button></div><div class="question-header"><div class="question-header-left"><div class="question-number">11</div><div class="question-category">Innovations <span class="modern-topic-tag" title="Sujet moderne non couvert par la vidéo de référence.">*</span></div></div><div class="nav-buttons"></div></div><h2 class="question-title" id="q11-title" tabindex="-1">Quelle technologie de détection améliore la précision de l'éclairage adaptatif ?</h2><div class="options" role="radiogroup" aria-labelledby="q11-title"><div class="option" data-answer="a" role="radio" aria-checked="false"><span class="option-number">1</span>Les capteurs infrarouges classiques</div><div class="option" data-answer="b" role="radio" aria-checked="false"><span class="option-number">2</span>Les radars à ondes millimétriques</div><div class="option" data-answer="c" role="radio" aria-checked="false"><span class="option-number">3</span>Les caméras simples</div><div class="option" data-answer="d" role="radio" aria-checked="false"><span class="option-number">4</span>Les capteurs de température</div></div><div class="feedback" id="feedback11" tabindex="-1"><p class="feedback-title">Réponse : Les radars à ondes millimétriques</p><p class="feedback-explanation">Ces radars avancés sont beaucoup plus précis que les capteurs infrarouges. Ils peuvent détecter la présence, la vitesse et la direction des piétons ou des véhicules, même dans de mauvaises conditions météorologiques.</p><details><summary>En savoir + : Radar vs Infrarouge (PIR)</summary><div class="details-content"><p>Un capteur <strong>infrarouge passif (PIR)</strong> détecte les changements de chaleur. Il peut être trompé par temps chaud ou ne pas détecter une personne immobile. Un <strong>radar</strong> envoie des ondes et analyse leur écho. Il détecte donc le moindre mouvement et la position exacte, quelle que soit la température, ce qui le rend beaucoup plus fiable.</p></div></details></div></div>

            <div class="question-card" data-question="12"><div class="review-banner">🧐 <strong>Mode Révision :</strong> Vous consultez vos réponses. <button class="btn-link-review">Retour aux résultats</button></div><div class="question-header"><div class="question-header-left"><div class="question-number">12</div><div class="question-category">Synthèse <span class="modern-topic-tag" title="Sujet moderne non couvert par la vidéo de référence.">*</span></div></div><div class="nav-buttons"></div></div><h2 class="question-title" id="q12-title" tabindex="-1">Quel est le défi principal pour l'avenir de l'éclairage urbain ?</h2><div class="options" role="radiogroup" aria-labelledby="q12-title"><div class="option" data-answer="a" role="radio" aria-checked="false"><span class="option-number">1</span>Éclairer plus fort partout</div><div class="option" data-answer="b" role="radio" aria-checked="false"><span class="option-number">2</span>Concilier efficacité énergétique, biodiversité et services connectés</div><div class="option" data-answer="c" role="radio" aria-checked="false"><span class="option-number">3</span>Revenir à l'éclairage au gaz</div><div class="option" data-answer="d" role="radio" aria-checked="false"><span class="option-number">4</span>Supprimer tout éclairage public</div></div><div class="feedback" id="feedback12" tabindex="-1"><p class="feedback-title">Réponse : Concilier efficacité, biodiversité et services</p><p class="feedback-explanation">L'éclairage de demain doit être un compromis intelligent : il doit consommer le moins possible, tout en assurant la sécurité des citoyens, en offrant de nouveaux services et en minimisant son impact sur l'environnement nocturne.</p><div class="context-box"><h4>🔮 Perspective 2030</h4><p>L'avenir s'oriente vers des réseaux d'éclairage entièrement autonomes et auto-adaptatifs, qui ajustent en temps réel la couleur et l'intensité de la lumière en fonction de données multiples (météo, trafic, événements, cycles de la faune...).</p></div></div></div>
            
            <div class="question-card" data-question="13"><div class="review-banner">🧐 <strong>Mode Révision :</strong> Vous consultez vos réponses. <button class="btn-link-review">Retour aux résultats</button></div><div class="question-header"><div class="question-header-left"><div class="question-number">13</div><div class="question-category">Calcul</div></div><div class="nav-buttons"></div></div><h2 class="question-title" id="q13-title" tabindex="-1">Une lampe LED de 15W produit 1500 <span class="tooltip">lumens<span class="tooltip-text">Unité de mesure de la quantité totale de lumière visible émise par une source.</span></span>. Quelle est son efficacité lumineuse (en lm/W) ?</h2><div class="options" role="radiogroup" aria-labelledby="q13-title"><div class="option" data-answer="a" role="radio" aria-checked="false"><span class="option-number">1</span>75 lm/W</div><div class="option" data-answer="b" role="radio" aria-checked="false"><span class="option-number">2</span>90 lm/W</div><div class="option" data-answer="c" role="radio" aria-checked="false"><span class="option-number">3</span>100 lm/W</div><div class="option" data-answer="d" role="radio" aria-checked="false"><span class="option-number">4</span>120 lm/W</div></div><div class="feedback" id="feedback13" tabindex="-1"><p class="feedback-title">Réponse : 100 lm/W</p><p class="feedback-explanation">L'efficacité lumineuse se calcule en divisant le flux lumineux (lumens) par la puissance consommée (Watts).</p><div class="calculation-breakdown">Calcul : 1500 lumens / 15 Watts = <strong>100 lm/W</strong></div><div class="context-box"><h4>💡 Rappel</h4><p><strong>Efficacité (lm/W) = Flux lumineux (lm) ÷ Puissance (W)</strong>. Plus ce chiffre est élevé, plus la lampe convertit efficacement l'électricité en lumière.</p></div></div></div>
            <div class="question-card" data-question="14"><div class="review-banner">🧐 <strong>Mode Révision :</strong> Vous consultez vos réponses. <button class="btn-link-review">Retour aux résultats</button></div><div class="question-header"><div class="question-header-left"><div class="question-number">14</div><div class="question-category">Maintenance</div></div><div class="nav-buttons"></div></div><h2 class="question-title" id="q14-title" tabindex="-1">Combien de lampes classiques (2000h) faut-il pour la durée de vie d'une seule LED (50000h) ?</h2><div class="options" role="radiogroup" aria-labelledby="q14-title"><div class="option" data-answer="a" role="radio" aria-checked="false"><span class="option-number">1</span>15 fois</div><div class="option" data-answer="b" role="radio" aria-checked="false"><span class="option-number">2</span>25 fois</div><div class="option" data-answer="c" role="radio" aria-checked="false"><span class="option-number">3</span>30 fois</div><div class="option" data-answer="d" role="radio" aria-checked="false"><span class="option-number">4</span>35 fois</div></div><div class="feedback" id="feedback14" tabindex="-1"><p class="feedback-title">Réponse : 25 fois</p><p class="feedback-explanation">On divise la durée de vie de la LED par celle de la lampe classique.</p> <div class="calculation-breakdown">Calcul : 50 000 heures / 2 000 heures = <strong>25</strong></div><div class="context-box"><h4>🌱 Impact</h4><p>Cette longévité exceptionnelle réduit drastiquement les coûts de main-d'œuvre pour le remplacement des ampoules, ainsi que la quantité de déchets générés.</p></div></div></div>
            <div class="question-card" data-question="15"><div class="review-banner">🧐 <strong>Mode Révision :</strong> Vous consultez vos réponses. <button class="btn-link-review">Retour aux résultats</button></div><div class="question-header"><div class="question-header-left"><div class="question-number">15</div><div class="question-category">Calcul</div></div><div class="nav-buttons"></div></div><h2 class="question-title" id="q15-title" tabindex="-1">Une LED de 10W remplace une lampe à incandescence de 60W. Quel est le % d'économie ?</h2><div class="options" role="radiogroup" aria-labelledby="q15-title"><div class="option" data-answer="a" role="radio" aria-checked="false"><span class="option-number">1</span>Environ 83%</div><div class="option" data-answer="b" role="radio" aria-checked="false"><span class="option-number">2</span>Environ 75%</div><div class="option" data-answer="c" role="radio" aria-checked="false"><span class="option-number">3</span>Environ 50%</div><div class="option" data-answer="d" role="radio" aria-checked="false"><span class="option-number">4</span>Environ 90%</div></div><div class="feedback" id="feedback15" tabindex="-1"><p class="feedback-title">Réponse : Environ 83%</p><p class="feedback-explanation">L'économie est de 60W - 10W = 50W. Pour trouver le pourcentage, on divise l'économie par la consommation initiale.</p> <div class="calculation-breakdown">Calcul : ((60W - 10W) / 60W) × 100 ≈ <strong>83.3%</strong></div><div class="context-box"><h4>🔢 Méthode</h4><p><strong>% économie = ( (Consommation initiale - Nouvelle consommation) / Consommation initiale ) × 100</strong></p></div></div></div>
            <div class="question-card" data-question="16"><div class="review-banner">🧐 <strong>Mode Révision :</strong> Vous consultez vos réponses. <button class="btn-link-review">Retour aux résultats</button></div><div class="question-header"><div class="question-header-left"><div class="question-number">16</div><div class="question-category">Histoire Interactive</div></div><div class="nav-buttons"></div></div><h2 class="question-title" id="q16-title" tabindex="-1">Organisez l'histoire ! Glissez-déposez chaque innovation sur la bonne période.</h2><div class="interactive-question-container timeline-container" id="q16-container"><div class="timeline-events" id="q16-events"><div class="draggable-item" draggable="true" data-id="led">Invention de la LED</div><div class="draggable-item" draggable="true" data-id="gaz">Généralisation de l'éclairage au gaz</div><div class="draggable-item" draggable="true" data-id="edison">Invention de l'ampoule à incandescence</div><div class="draggable-item" draggable="true" data-id="smart">Ère des Smart-Cities et du <span class="tooltip">Li-Fi<span class="tooltip-text">Light Fidelity. Technologie de communication sans fil basée sur l'utilisation de la lumière (LED).</span></span></div></div><div class="timeline-slots"><div class="timeline-slot"><div class="timeline-year">Début 19e s.</div><div class="dropzone" data-target="gaz"></div></div><div class="timeline-slot"><div class="timeline-year">Fin 19e s.</div><div class="dropzone" data-target="edison"></div></div><div class="timeline-slot"><div class="timeline-year">Milieu 20e s.</div><div class="dropzone" data-target="led"></div></div><div class="timeline-slot"><div class="timeline-year">Années 2020</div><div class="dropzone" data-target="smart"></div></div></div></div><div class="feedback" id="feedback16" tabindex="-1"><p class="feedback-title">Chronologie de l'éclairage</p><p class="feedback-explanation">L'ordre correct est : Éclairage au gaz (début 19e), Ampoule d'Edison (fin 19e), Invention de la LED (milieu 20e, mais généralisation bien plus tardive), et enfin l'ère des Smart Cities (récente).</p></div></div>
            <div class="question-card" data-question="17"><div class="review-banner">🧐 <strong>Mode Révision :</strong> Vous consultez vos réponses. <button class="btn-link-review">Retour aux résultats</button></div><div class="question-header"><div class="question-header-left"><div class="question-number">17</div><div class="question-category">Smart City en pratique <span class="modern-topic-tag" title="Sujet moderne non couvert par la vidéo de référence.">*</span></div></div><div class="nav-buttons"></div></div><h2 class="question-title" id="q17-title" tabindex="-1">Construisez un lampadaire intelligent ! Sélectionnez au moins 4 fonctionnalités.</h2><div class="smart-lamppost-builder" id="q17-builder"><div class="feature-option" data-id="wifi" role="button" tabindex="0" title="Diffuse un signal Wi-Fi ou 5G pour connecter les passants."><div class="feature-icon">📡</div><div>Hotspot Wi-Fi / 5G</div></div><div class="feature-option" data-id="air" role="button" tabindex="0" title="Mesure les polluants (particules fines, NOx...) en temps réel."><div class="feature-icon">🌬️</div><div>Capteur de qualité de l'air</div></div><div class="feature-option" data-id="charge" role="button" tabindex="0" title="Permet de recharger les voitures, scooters ou vélos électriques."><div class="feature-icon">🔌</div><div>Borne de recharge véhicule</div></div><div class="feature-option" data-id="camera" role="button" tabindex="0" title="Assure la sécurité et peut analyser les flux de piétons/véhicules."><div class="feature-icon">📹</div><div>Caméra de sécurité IA</div></div><div class="feature-option" data-id="speaker" role="button" tabindex="0" title="Diffuse des annonces d'urgence (alerte météo, sécurité...)."><div class="feature-icon">📢</div><div>Haut-parleur d'alerte</div></div><div class="feature-option" data-id="parking" role="button" tabindex="0" title="Détecte si une place de stationnement à proximité est libre ou occupée."><div class="feature-icon">🅿️</div><div>Détection de place de parking</div></div></div><div class="feedback" id="feedback17" tabindex="-1"><div class="feedback-correct"><p class="feedback-title">Lampadaire Intelligent assemblé !</p><p class="feedback-explanation">Votre sélection montre que vous avez bien compris comment un simple point lumineux peut devenir un "couteau suisse" technologique au service de la ville.</p><div id="q17-description-box" class="context-box"><h4>Votre lampadaire intelligent inclut :</h4><ul id="q17-description-list"></ul></div></div><div class="feedback-incorrect"><p><strong>Sélectionnez au moins 4 fonctionnalités</strong> pour créer un lampadaire vraiment "intelligent" !</p></div></div></div>
            
            <div class="question-card" data-question="18">
                <div class="review-banner">🧐 <strong>Mode Révision :</strong> Vous consultez vos réponses. <button class="btn-link-review">Retour aux résultats</button></div>
                <div class="question-header"><div class="question-header-left"><div class="question-number">18</div><div class="question-category">Classement d'Efficacité <span class="modern-topic-tag" title="Sujet moderne non couvert par la vidéo de référence.">*</span></div></div><div class="nav-buttons"></div></div>
                <h2 class="question-title" id="q18-title" tabindex="-1">Classez ces technologies de la <strong>plus efficace</strong> à la <strong>moins efficace</strong>.</h2>
                <div class="interactive-question-container ranking-container" id="q18-container">
                    <div class="ranking-source dropzone" id="q18-source">
                        <div class="draggable-item" draggable="true" data-id="led">💡 LED</div>
                        <div class="draggable-item" draggable="true" data-id="incandescent">💡 Incandescence</div>
                        <div class="draggable-item" draggable="true" data-id="sodium">💡 Lampe à Sodium</div>
                    </div>
                    <div class="ranking-slots">
                        <div class="ranking-slot">
                            <span class="rank-label">Plus efficace :</span>
                            <div class="dropzone" data-rank="1"></div>
                        </div>
                        <div class="ranking-slot">
                            <span class="rank-label">Intermédiaire :</span>
                            <div class="dropzone" data-rank="2"></div>
                        </div>
                        <div class="ranking-slot">
                            <span class="rank-label">Moins efficace :</span>
                            <div class="dropzone" data-rank="3"></div>
                        </div>
                    </div>
                </div>
                <div class="feedback" id="feedback18" tabindex="-1">
                    <p class="feedback-title">Classement de l'efficacité</p>
                    <p class="feedback-explanation">L'ordre correct est basé sur le rendement lumineux (lumens par Watt) :</p>
                    <ol style="list-style-position: inside; padding-left: 10px;">
                        <li><strong>LED :</strong> Très efficace (100-170 lm/W).</li>
                        <li><strong>Lampe à Sodium :</strong> Assez efficace mais avec un mauvais rendu des couleurs (80-140 lm/W).</li>
                        <li><strong>Incandescence :</strong> Très inefficace, la majorité de l'énergie est perdue en chaleur (10-17 lm/W).</li>
                    </ol>
                </div>
            </div>

            <div class="question-card" data-question="19"><div class="review-banner">🧐 <strong>Mode Révision :</strong> Vous consultez vos réponses. <button class="btn-link-review">Retour aux résultats</button></div><div class="question-header"><div class="question-header-left"><div class="question-number">19</div><div class="question-category">Mythe ou Réalité <span class="modern-topic-tag" title="Sujet moderne non couvert par la vidéo de référence.">*</span></div></div><div class="nav-buttons"></div></div><h2 class="question-title" id="q19-title" tabindex="-1">Affirmation : "Grâce à leur faible consommation, les éclairages LED blancs modernes ont toujours un impact environnemental plus faible que les anciennes lampes oranges."</h2><div class="options" role="radiogroup" aria-labelledby="q19-title"><div class="option" data-answer="a" role="radio" aria-checked="false"><span class="option-number">1</span>Vrai</div><div class="option" data-answer="b" role="radio" aria-checked="false"><span class="option-number">2</span>Faux</div></div><div class="feedback" id="feedback19" tabindex="-1"><p class="feedback-title">Réponse : Faux</p><p class="feedback-explanation">Bien que plus efficaces énergétiquement, les LED blanches froides (riches en lumière bleue) peuvent perturber davantage la faune nocturne et le rythme circadien humain que la lumière orange des anciennes lampes.</p><div class="context-box"><h4>🔬 Énergie vs. Biodiversité</h4><p>C'est un compromis : l'impact environnemental n'est pas qu'énergétique. De plus en plus de villes optent pour des LED à teinte chaude (ambrées, < 3000K) pour un meilleur équilibre.</p></div></div></div>
            <div class="question-card" data-question="20"><div class="review-banner">🧐 <strong>Mode Révision :</strong> Vous consultez vos réponses. <button class="btn-link-review">Retour aux résultats</button></div><div class="question-header"><div class="question-header-left"><div class="question-number">20</div><div class="question-category">Tri Interactif <span class="modern-topic-tag" title="Sujet moderne non couvert par la vidéo de référence.">*</span></div></div><div class="nav-buttons"></div></div><h2 class="question-title" id="q20-title" tabindex="-1">Triez les caractéristiques : glissez chaque étiquette dans la bonne catégorie.</h2><div class="interactive-question-container sorting-container" id="q20-container"><div class="sorting-source-list dropzone" id="q20-source"><div class="draggable-item" draggable="true" data-category="led">Très longue durée de vie (> 50 000h)</div><div class="draggable-item" draggable="true" data-category="old">Contient du mercure (polluant)</div><div class="draggable-item" draggable="true" data-category="led">Allumage instantané</div><div class="draggable-item" draggable="true" data-category="old">Long temps de préchauffage</div><div class="draggable-item" draggable="true" data-category="led">Excellente efficacité énergétique</div><div class="draggable-item" draggable="true" data-category="old">Lumière monochromatique (orange)</div></div><div class="sorting-bins"><div class="sorting-bin"><h4>💡 LED Moderne</h4><div class="dropzone" data-target="led"></div></div><div class="sorting-bin"><h4>🏮 Ancienne Lampe à Décharge (Sodium)</h4><div class="dropzone" data-target="old"></div></div></div></div><div class="feedback" id="feedback20" tabindex="-1"><p class="feedback-title">Distinction des technologies</p><p class="feedback-explanation">Vous avez trié les caractéristiques des deux générations d'éclairage. Les LED se distinguent par leur efficacité, leur longévité et leur flexibilité, tandis que les lampes à décharge avaient des contraintes comme le temps de chauffe et la présence de matériaux polluants.</p></div></div>
            </div>
        </div>

        <div class="results" id="results">
            <div id="confetti-container"></div>
            <h2>🎉 Félicitations ! Questionnaire terminé</h2>
            <div class="score-circle" id="scoreCircle"><span id="scoreDisplay">0/20</span></div>
            <h3 class="score-title" id="scoreMessage">Votre titre</h3>
            <p id="scoreDescription">Description de votre performance</p>
            <div class="badges-earned-container" id="badgesEarnedContainer"><h4>🏆 Tableau des Badges</h4><div id="badges-earned"></div></div>
            <div class="key-takeaways">
                <h4>✨ Ce qu'il faut retenir</h4>
                <ul>
                    <li>L'éclairage a connu une évolution majeure : du gaz aux <strong>LED</strong>, qui dominent aujourd'hui par leur efficacité, leur durée de vie et leur flexibilité (couleur, intensité).</li>
                    <li>Le lampadaire moderne est devenu une <strong>plateforme de services</strong> pour la "Smart City" (Wi-Fi, capteurs, sécurité...).</li>
                    <li>L'enjeu actuel est de trouver un équilibre entre <strong>efficacité énergétique</strong>, <strong>sécurité des citoyens</strong> et <strong>protection de la biodiversité</strong> contre la pollution lumineuse.</li>
                </ul>
            </div>
            <div class="results-summary"><h4>Récapitulatif de vos réponses</h4><div id="summaryContent"></div></div>
            <div class="results-actions">
                <button class="btn btn-primary" id="resultsReviewBtn">🧐 Revoir mes réponses</button>
                <button class="btn btn-secondary" id="reviewErrorsBtn">🧐 Revoir mes erreurs</button>
                <button class="btn btn-secondary" id="resultsRestartBtn">🔄 Recommencer</button>
            </div>
            <footer id="resultsFooter">Réalisé par David Trafial</footer>
        </div>
    </div>
    
    <div class="video-container floating-widget minimized" id="videoWidget">
        <div class="video-header" id="videoHeader">
            <span class="dynamic-icon" id="videoStatusIcon">🎬</span>
            <span class="video-title">Vidéo C'est Pas Sorcier</span>
            <div class="video-controls">
                <button id="minimizeBtn" aria-label="Minimiser la vidéo"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/></svg></button>
            </div>
        </div>
        <div class="video-content">
             <div class="video-player-container" id="videoPlayerContainer">
                <svg class="play-icon-svg" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"></path></svg>
            </div>
        </div>
    </div>
    
    <div class="modal-overlay" id="statsModalOverlay">
        <div class="stats-modal">
            <button class="modal-close-btn" id="modalCloseBtn" aria-label="Fermer les statistiques">✖</button>
            <h3>📊 Vos Statistiques</h3>
            <div class="stats-grid">
                <div class="stat-item"><h4>Précision</h4><p id="statsAccuracy">--%</p></div>
                <div class="stat-item"><h4>Répondues</h4><p id="statsAnswered">0 / 20</p></div>
                <div class="stat-item"><h4>Temps</h4><p id="statsTime">00:00</p></div>
            </div>
            <h3>🏆 Vos Badges</h3>
            <div class="badges-grid">
                <div class="badge"><div class="badge-icon" id="badge-history">🕰️</div><p>Historien Précis</p></div>
                <div class="badge"><div class="badge-icon" id="badge-smartcity">🏙️</div><p>Ingénieur Smart City</p></div>
                <div class="badge"><div class="badge-icon" id="badge-calculator">🧮</div><p>Calculateur Rapide</p></div>
                <div class="badge"><div class="badge-icon" id="badge-expert">🛠️</div><p>Expert Technique</p></div>
                <div class="badge"><div class="badge-icon" id="badge-streak">🔥</div><p>Série Parfaite</p></div>
                <div class="badge"><div class="badge-icon" id="badge-curious">🕵️</div><p>Curieux de Nature</p></div>
                <div class="badge"><div class="badge-icon" id="badge-perfect">🌟</div><p>Grand Chelem</p></div>
                <div class="badge"><div class="badge-icon" id="badge-sprinter">⚡</div><p>Éclair Rapide</p></div>
            </div>
            <div class="reset-button-container">
                <p>Recommencer le quiz depuis le début ?</p>
                <button class="btn btn-secondary" id="resetQuizBtn">Réinitialiser ma progression</button>
            </div>
        </div>
    </div>
    
    <div id="toast-container"></div>

    <script src="https://www.youtube.com/iframe_api"></script>
    <script>
    (function() {
    let currentQuestion = 1; let score = 0; let totalQuestions; let answers = []; let isAnswered = []; let q17_selections = [];
    let videoPlayer; let timerInterval; let secondsElapsed = 0; let currentStreak = 0; let isReviewing = false;
    let badges = { history: false, smartcity: false, calculator: false, expert: false, streak: false, perfect: false, curious: false, sprinter: false };
    let curiosityTracker = { videoClicked: false, statsOpened: false, hintHovered: false };
    let draggedItem = null;
    const quizSaveKey = 'urbanLightingQuiz_vFinal_41';
    const themeStorageKey = 'urbanLightingTheme_v1';
    const correctAnswers = { 1: 'b', 2: 'a', 3: 'c', 4: 'b', 5: 'b', 6: 'b', 7: 'b', 8: 'a', 9: 'b', 10: 'c', 11: 'b', 12: 'b', 13: 'c', 14: 'b', 15: 'a', 16: true, 17: true, 18: true, 19: 'b', 20: true };
    const questionTitles = [ "Éclairage dominant au XIXe s.", "Date de l'ampoule d'Edison", "Points lumineux à Paris", "Fonctionnement lampe à incandescence", "Différence lampe classique/halogène", "Principe lampes à décharge", "Défi environnemental majeur", "Innovation d'alimentation écologique", "Rôle de l'éclairage en Smart City", "Économie d'énergie avec les LED", "Technologie de détection avancée", "Défi futur de l'éclairage", "Calcul d'efficacité lumineuse", "Calcul d'économies de maintenance", "Calcul de % d'économie d'énergie", "Timeline interactive de l'histoire", "Constructeur de lampadaire intelligent", "Classement d'Efficacité", "Mythe ou Réalité", "Tri des Caractéristiques" ];
    const featureDetails = { wifi: { name: "Hotspot Wi-Fi / 5G", desc: "Diffuse un signal Wi-Fi ou 5G pour connecter les passants." }, air: { name: "Capteur qualité de l'air", desc: "Mesure les polluants (particules fines, NOx...) en temps réel." }, charge: { name: "Borne de recharge", desc: "Permet de recharger les voitures, scooters ou vélos électriques." }, camera: { name: "Caméra de sécurité IA", desc: "Assure la sécurité et peut analyser les flux de piétons/véhicules." }, speaker: { name: "Haut-parleur d'alerte", desc: "Diffuse des annonces d'urgence (alerte météo, sécurité...)." }, parking: { name: "Détection de parking", desc: "Détecte si une place de stationnement à proximité est libre ou occupée." } };
    const badgeDetails = {
        history: { name: "Historien Précis", icon: "🕰️", description: "Terminer l'exercice de la timeline avec succès" },
        smartcity: { name: "Ingénieur Smart City", icon: "🏙️", description: "Construire un lampadaire intelligent avec succès" },
        calculator: { name: "Calculateur Rapide", icon: "🧮", description: "Réussir les 3 questions de calcul" },
        expert: { name: "Expert Technique", icon: "🛠️", description: "Réussir les exercices interactifs (timeline, classement, tri...)" },
        streak: { name: "Série Parfaite", icon: "🔥", description: "Obtenir 5 bonnes réponses d'affilée" },
        curious: { name: "Curieux de Nature", icon: "🕵️", description: "Explorer l'interface (ouvrir stats, voir vidéo, utiliser l'astuce)" },
        perfect: { name: "Grand Chelem", icon: "🌟", description: "Obtenir un score parfait de 20/20" },
        sprinter: { name: "Éclair Rapide", icon: "⚡", description: "Terminer le quiz en moins de 10 minutes" }
    };
    
    const dom = {
        mainHeader: document.getElementById('mainHeader'), quizContent: document.querySelector('.quiz-content'),
        startScreen: document.getElementById('startScreen'), startQuizBtn: document.getElementById('startQuizBtn'), resumeBtn: document.getElementById('resumeBtn'),
        questionsWrapper: document.getElementById('questions-wrapper'),
        progressFill: document.getElementById('progressFill'), progressText: document.getElementById('progressText'), progressDotsContainer: document.getElementById('progressDots'),
        currentScore: document.getElementById('currentScore'), totalQuestionsDisplay: document.getElementById('totalQuestionsDisplay'),
        accuracyText: document.getElementById('accuracyText'),
        resultsScreen: document.getElementById('results'), liveScore: document.getElementById('liveScore'), accuracyBarFill: document.getElementById('accuracyBarFill'),
        statsModalOverlay: document.getElementById('statsModalOverlay'), modalCloseBtn: document.getElementById('modalCloseBtn'),
        videoWidget: document.getElementById('videoWidget'), videoPlayerContainer: document.getElementById('videoPlayerContainer'), videoStatusIcon: document.getElementById('videoStatusIcon'),
        toolWidget: document.getElementById('toolWidget'), homeBtn: document.getElementById('homeBtn'), toolResetBtn: document.getElementById('toolResetBtn'),
        keyboardHint: document.getElementById('keyboardHint'),
        themeToggle: document.getElementById('theme-toggle-switch'), resetQuizBtn: document.getElementById('resetQuizBtn'), timerDisplay: document.getElementById('timerDisplay'),
        resultsReviewBtn: document.getElementById('resultsReviewBtn'),
        reviewErrorsBtn: document.getElementById('reviewErrorsBtn'),
        resultsRestartBtn: document.getElementById('resultsRestartBtn')
    };

    function applyTheme(theme) { document.documentElement.setAttribute('data-theme', theme); dom.themeToggle.checked = (theme === 'light'); }
    function saveThemePreference(theme) { localStorage.setItem(themeStorageKey, theme); }
    function setupTheme() { const sT = localStorage.getItem(themeStorageKey); const pT = window.matchMedia('(prefers-color-scheme: light)').matches ? 'light' : 'dark'; applyTheme(sT || pT); dom.themeToggle.addEventListener('change', () => { const nT = dom.themeToggle.checked ? 'light' : 'dark'; applyTheme(nT); saveThemePreference(nT); }); }
    function showToast(title, message, icon) { const tc = document.getElementById('toast-container'); const t = document.createElement('div'); t.className = 'toast'; t.innerHTML = `<span class="toast-icon">${icon}</span><div class="toast-content"><strong>${title}</strong><p>${message}</p></div>`; tc.appendChild(t); setTimeout(() => t.remove(), 4000); }
    function updateLiveScore() {
        dom.currentScore.textContent = score;
        dom.currentScore.classList.add('updated');
        setTimeout(() => dom.currentScore.classList.remove('updated'), 500);
        const answeredCount = isAnswered.slice(1).filter(Boolean).length;
        const accuracy = answeredCount > 0 ? (score / answeredCount) * 100 : 0;
        dom.accuracyBarFill.style.width = `${accuracy}%`;
        dom.accuracyText.textContent = `${Math.round(accuracy)}%`;
    }
    function updateProgress() { const progress = totalQuestions > 1 ? ((currentQuestion - 1) / (totalQuestions - 1)) * 100 : 0; dom.progressFill.style.width = progress + '%'; dom.progressText.innerHTML = `Question <strong>${currentQuestion}</strong> / ${totalQuestions}`; Array.from(dom.progressDotsContainer.children).forEach((dot, i) => { dot.classList.remove('active'); if (i + 1 === currentQuestion) dot.classList.add('active'); }); }
    
    function startQuiz(isNewGame = true) {
        if (isNewGame) {
            currentQuestion = 1; score = 0; secondsElapsed = 0; currentStreak = 0; isReviewing = false;
            answers = new Array(totalQuestions + 1).fill(null);
            isAnswered = new Array(totalQuestions + 1).fill(false);
            q17_selections = [];
            badges = { history: false, smartcity: false, calculator: false, expert: false, streak: false, perfect: false, curious: false, sprinter: false };
            curiosityTracker = { videoClicked: false, statsOpened: false, hintHovered: false };
            localStorage.removeItem(quizSaveKey);
        }
        document.body.classList.add('quiz-active'); dom.startScreen.classList.add('hidden');
        dom.quizContent.classList.remove('hidden'); dom.mainHeader.classList.add('header-compact');
        startTimer(); showQuestion(currentQuestion);
    }

    function resumeQuiz() {
        const savedProgress = localStorage.getItem(quizSaveKey); if (!savedProgress) { startQuiz(true); return; }
        try {
            const p = JSON.parse(savedProgress);
            currentQuestion = p.currentQuestion;
            score = p.score;
            answers = p.answers;
            isAnswered = p.isAnswered;
            secondsElapsed = p.secondsElapsed;
            badges = p.badges;
            currentStreak = p.currentStreak;
            isReviewing = false;
            q17_selections = p.interactiveStates?.q17 || [];
            curiosityTracker = p.curiosityTracker || { videoClicked: false, statsOpened: false, hintHovered: false };
            
            for (let i = 1; i <= totalQuestions; i++) {
                if (p.isAnswered[i]) {
                    const dot = dom.progressDotsContainer.children[i - 1];
                    if (dot) {
                        dot.classList.add('clickable', p.answers[i] === correctAnswers[i] ? 'completed-correct' : 'completed-incorrect');
                    }
                }
            }
            updateLiveScore();
            startQuiz(false);
        } catch (e) { console.error("Erreur de chargement de la progression.", e); localStorage.removeItem(quizSaveKey); startQuiz(true); }
    }

    function showQuestion(questionNumber) { const c = document.querySelector('.question-card.active'); if (c) { c.classList.add('slide-out'); setTimeout(() => { c.classList.remove('active', 'slide-out'); displayNewQuestion(questionNumber); }, 400); } else { displayNewQuestion(questionNumber); } }
    
    function displayNewQuestion(questionNumber) {
        dom.resultsScreen.classList.remove('show'); dom.quizContent.style.display = 'block';
        const card = document.querySelector(`[data-question="${questionNumber}"]`);
        if (card) {
            currentQuestion = parseInt(questionNumber, 10);
            card.classList.remove('slide-out'); card.classList.add('active'); card.classList.toggle('review-mode-active', isReviewing);
            
            if(isAnswered[currentQuestion]) {
                renderAnsweredState(currentQuestion, answers[currentQuestion]);
            }

            const navContainer = card.querySelector('.nav-buttons');
            const prevBtn = navContainer.querySelector('.btn-nav:first-child');
            const nextBtn = navContainer.querySelector('.btn-nav:last-child');
            prevBtn.disabled = currentQuestion === 1;
            nextBtn.disabled = isReviewing ? (currentQuestion === totalQuestions) : !isAnswered[currentQuestion];
            if (currentQuestion === totalQuestions && isAnswered[totalQuestions] && !isReviewing) {
                nextBtn.innerHTML = '🏆'; nextBtn.title = 'Voir les résultats';
            } else {
                nextBtn.innerHTML = '→'; nextBtn.title = 'Suivant (→)';
            }
            updateProgress();
            const title = card.querySelector('.question-title'); if(title) title.focus({ preventScroll: true });
        }
    }
    
    function nextQuestion(e) { const btn = e.currentTarget; if (!btn.disabled) { currentQuestion < totalQuestions ? showQuestion(currentQuestion + 1) : showResults(); } }
    function previousQuestion(e) { const btn = e.currentTarget; if (!btn.disabled && currentQuestion > 1) showQuestion(currentQuestion - 1); }
    
    function handleAnswer(questionNumber, selectedAnswer, element) { if (isAnswered[questionNumber]) return; isReviewing = false; isAnswered[questionNumber] = true; answers[questionNumber] = selectedAnswer; const isCorrect = correctAnswers[questionNumber] === selectedAnswer; if (isCorrect) { score++; currentStreak++; } else { currentStreak = 0; } updateLiveScore(); checkBadges(); const card = element.closest('.question-card'); card.querySelectorAll('.option').forEach(opt => opt.classList.add('disabled')); element.classList.add('selected'); if (element.getAttribute('role') === 'radio') element.setAttribute('aria-checked', 'true'); renderAnsweredState(questionNumber, selectedAnswer); const feedback = card.querySelector('.feedback'); feedback.focus(); feedback.scrollIntoView({ behavior: 'smooth', block: 'center' }); card.querySelector('.nav-buttons .btn-nav:last-child').disabled = false; saveProgress(); }
    
    function showResults(isFirstTime = true) {
        isReviewing = false;
        if (isFirstTime) {
            clearInterval(timerInterval);
            checkBadges(true);
            saveProgress();
        }
        generateSummary(); 
        document.body.classList.remove('quiz-active'); dom.quizContent.style.display = 'none';
        dom.resultsScreen.classList.add('show');
        
        let message, description; const accuracy = score / totalQuestions;
        if (accuracy >= 0.85) { message = '🏆 Visionnaire de la Smart City !'; description = 'Excellent ! Vous maîtrisez parfaitement l\'évolution de l\'éclairage urbain.'; if (isFirstTime) triggerConfetti(); } 
        else if (accuracy >= 0.5) { message = '💡 Technicien Éclairé'; description = 'Bien joué ! Vous avez de solides connaissances. Continuez à explorer !'; } 
        else { message = 'Novice de la Nuit'; description = 'C\'est un bon début ! N\'hésitez pas à revoir la vidéo pour consolider vos acquis.'; }
        document.getElementById('scoreMessage').textContent = message; document.getElementById('scoreDescription').textContent = description; document.getElementById('scoreCircle').style.background = `linear-gradient(135deg, var(--primary-color), var(--secondary-color))`;
        
        const firstErrorIndex = answers.slice(1).findIndex((ans, i) => ans !== null && ans !== correctAnswers[i + 1]);
        dom.reviewErrorsBtn.disabled = (firstErrorIndex === -1);
        if(firstErrorIndex === -1) {
            dom.reviewErrorsBtn.title = "Félicitations, aucune erreur !";
        } else {
            dom.reviewErrorsBtn.title = "Aller à votre première erreur";
        }

        displayEarnedBadges(); dom.resultsScreen.scrollIntoView({ behavior: 'smooth' });
        document.getElementById('scoreDisplay').textContent = `${score}/${totalQuestions}`;
    }
    function generateSummary() {
        const sc = document.getElementById('summaryContent');
        sc.innerHTML = questionTitles.map((t, i) => {
            const n = i + 1;
            const isCorrect = answers[n] === correctAnswers[n];
            let resultHtml = `<span class="summary-result ${isCorrect ? 'correct' : 'incorrect'}">${isCorrect ? '✅' : '❌'}</span>`;

            if (!isCorrect && isAnswered[n]) {
                let correctAnswerText = '';
                const correctAnswerValue = correctAnswers[n];
                if (typeof correctAnswerValue === 'boolean') {
                    correctAnswerText = 'Correction en un clic';
                } else {
                    const optionElement = document.querySelector(`.question-card[data-question="${n}"] .option[data-answer="${correctAnswerValue}"]`);
                    if (optionElement) {
                        correctAnswerText = `R: ${optionElement.innerText.trim().substring(2)}`;
                    }
                }
                if (correctAnswerText) {
                    resultHtml += `<small style="margin-left: 10px; color: var(--secondary-text-color);">${correctAnswerText}</small>`;
                }
            }

            return `<div class="summary-item" data-question-index="${n}" role="button" tabindex="0">
                        <span>Q${n}. ${t}</span>
                        <div>${resultHtml}</div>
                    </div>`;
        }).join('');
        const h = e => { const i = e.target.closest('.summary-item'); if(i && (e.type === 'click' || e.key === 'Enter')) reviewQuestion(i.dataset.questionIndex); };
        sc.addEventListener('click', h);
        sc.addEventListener('keydown', h);
    }
    function reviewQuestions() { document.body.classList.add('quiz-active'); isReviewing = true; showQuestion(1); }
    function reviewErrors() { const firstErrorIndex = answers.findIndex((ans, i) => i > 0 && ans !== null && ans !== correctAnswers[i]); if(firstErrorIndex !== -1) { reviewQuestion(firstErrorIndex); } }
    function reviewQuestion(questionIndex) { document.body.classList.add('quiz-active'); isReviewing = true; showQuestion(parseInt(questionIndex, 10)); }
    function restartQuiz() { if (confirm("Êtes-vous sûr de vouloir recommencer ? Votre progression sera perdue.")) { localStorage.removeItem(quizSaveKey); location.reload(); } }
    function goHome() { location.reload(); }
    function triggerConfetti() { const c = document.getElementById('confetti-container'); if (!c) return; c.innerHTML = ''; const cl = ['#f39c12', '#e74c3c', '#4abdac', '#2ecc71', '#9b59b6']; for (let i = 0; i < 150; i++) { const e = document.createElement('div'); e.classList.add('confetti'); e.style.left = `${Math.random() * 100}%`; e.style.backgroundColor = cl[Math.floor(Math.random() * cl.length)]; e.style.animationDelay = `${Math.random() * 2}s`; e.style.animationDuration = `${3 + Math.random() * 2}s`; e.style.transform = `rotate(${Math.random() * 360}deg)`; c.appendChild(e); } }
    function saveProgress() { const p = { currentQuestion, score, answers: answers.slice(), isAnswered: isAnswered.slice(), interactiveStates: { q17: q17_selections.slice() }, secondsElapsed, badges, currentStreak, curiosityTracker }; try { localStorage.setItem(quizSaveKey, JSON.stringify(p)); } catch (e) { console.error("Sauvegarde impossible:", e); } }
    function renderAnsweredState(qN, uA) { const card = document.querySelector(`.question-card[data-question="${qN}"]`); if (!card) return; const isC = correctAnswers[qN] === uA; const f = card.querySelector('.feedback'); const d = dom.progressDotsContainer.children[qN - 1]; d.classList.add('clickable', isC ? 'completed-correct' : 'completed-incorrect'); f.classList.add(isC ? 'correct' : 'incorrect', 'show'); if (card.querySelector('.option')) { card.querySelectorAll('.option').forEach(o => { o.classList.add('disabled'); const oA = o.dataset.answer; if(oA === uA) o.classList.add('selected', isC ? 'correct' : 'incorrect'); if(!isC && oA === correctAnswers[qN]) o.classList.add('correct'); }); } else { const container = card.querySelector('.interactive-question-container'); if (container) container.classList.add('disabled'); if (qN === 17) { q17_selections.forEach(id => { const el = card.querySelector(`.feature-option[data-id="${id}"]`); if(el) el.classList.add('selected'); }); const dL = document.getElementById('q17-description-list'); const dB = document.getElementById('q17-description-box'); dL.innerHTML = q17_selections.map(id => `<li>✅ <b>${featureDetails[id].name}:</b> ${featureDetails[id].desc}</li>`).join(''); dB.style.display = 'block'; card.querySelectorAll('.feature-option').forEach(el => el.classList.add('disabled')); } } }
    function checkCuriosityBadge() { if (badges.curious || [curiosityTracker.videoClicked, curiosityTracker.statsOpened, curiosityTracker.hintHovered].filter(Boolean).length < 2) return; badges.curious = true; showToast("Badge débloqué !", badgeDetails.curious.name, badgeDetails.curious.icon); saveProgress(); }
    function checkBadges(isFinalCheck = false) { const c = { history: () => answers[16] === true, smartcity: () => answers[17] === true, calculator: () => [13, 14, 15].every(q => answers[q] === correctAnswers[q]), expert: () => [16, 17, 18, 20].every(q => answers[q] === true), streak: () => currentStreak >= 5, perfect: () => isFinalCheck && score === totalQuestions, sprinter: () => isFinalCheck && secondsElapsed < 600 }; for (const b in c) { if (!badges[b] && c[b]()) { badges[b] = true; const d = badgeDetails[b]; if (d) showToast("Badge débloqué !", d.name, d.icon); } } }
    function displayEarnedBadges() {
        const container = document.getElementById('badges-earned');
        const allBadgeIds = Object.keys(badgeDetails);
        let html = '';
        allBadgeIds.forEach(id => {
            const badge = badgeDetails[id];
            const isEarned = badges[id];
            html += `<div class="badge-earned-item ${!isEarned ? 'unearned' : ''}" title="${badge.description}">
                        <span class="badge-icon">${badge.icon}</span>
                        <p>${badge.name}</p>
                    </div>`;
        });
        container.innerHTML = html;
        document.getElementById('badgesEarnedContainer').style.display = 'block';
    }
    function openStatsModal() {
        curiosityTracker.statsOpened = true; checkCuriosityBadge();
        const aC = isAnswered.slice(1).filter(Boolean).length;
        document.getElementById('statsAnswered').textContent = `${aC} / ${totalQuestions}`;
        document.getElementById('statsAccuracy').textContent = `${aC > 0 ? Math.round((score / aC) * 100) : 0}%`;
        for (const badgeId in badges) {
            const badgeElement = document.getElementById(`badge-${badgeId}`);
            if (badgeElement) {
                badgeElement.classList.toggle('unlocked', badges[badgeId]);
                badgeElement.closest('.badge').title = badgeDetails[badgeId].description;
            }
        }
        dom.statsModalOverlay.classList.add('show');
    }
    function closeStatsModal() { dom.statsModalOverlay.classList.add('hiding'); dom.statsModalOverlay.addEventListener('animationend', () => { dom.statsModalOverlay.classList.remove('show', 'hiding'); }, { once: true }); }
    function setupInteractiveQuestions() { const dS = e => { draggedItem = e.target; setTimeout(() => e.target.style.opacity = '0.5', 0); }; const dE = () => { if(draggedItem) draggedItem.style.opacity = '1'; draggedItem = null; }; const dO = e => { e.preventDefault(); e.currentTarget.classList.add('over'); }; const dL = e => e.currentTarget.classList.remove('over'); const dH = (e, cF, cFn) => { e.preventDefault(); e.currentTarget.classList.remove('over'); if (draggedItem && cFn(e.currentTarget)) { e.currentTarget.appendChild(draggedItem); cF(); } }; document.querySelectorAll('.draggable-item').forEach(i => { i.addEventListener('dragstart', dS); i.addEventListener('dragend', dE); }); document.querySelectorAll('.dropzone').forEach(z => { z.addEventListener('dragover', dO); z.addEventListener('dragleave', dL); }); document.querySelectorAll('#q16-container .dropzone, #q16-events').forEach(z => z.addEventListener('drop', e => dH(e, checkQ16Completion, t => t.classList.contains('dropzone') ? t.children.length === 0 : true))); document.querySelectorAll('#q18-container .dropzone, #q18-source').forEach(z => z.addEventListener('drop', e => dH(e, checkQ18Completion, t => t.classList.contains('dropzone') ? t.children.length === 0 : true))); document.querySelectorAll('#q20-container .dropzone').forEach(z => z.addEventListener('drop', e => dH(e, checkQ20Completion, () => true))); const q17H = e => { const f = e.target.closest('.feature-option:not(.disabled)'); if (f && (e.type === 'click' || e.key === 'Enter' || e.key === ' ')) { if(e.type !== 'click') e.preventDefault(); toggleFeatureSelection(f); } }; dom.questionsWrapper.querySelector('#q17-builder').addEventListener('click', q17H); dom.questionsWrapper.querySelector('#q17-builder').addEventListener('keydown', q17H); }
    function checkInteractiveQuestion(qN, c, fI, cI, iCF) { if (!c || isAnswered[qN]) return; isReviewing = false; const container = document.getElementById(cI); const iAC = iCF(container); isAnswered[qN] = true; answers[qN] = iAC; if (iAC) { score++; currentStreak++; } else { currentStreak = 0; } updateLiveScore(); checkBadges(); renderAnsweredState(qN, iAC); const f = document.getElementById(fI); f.focus(); f.scrollIntoView({ behavior: 'smooth', block: 'center' }); const nextBtn = document.querySelector(`.question-card[data-question="${qN}"] .nav-buttons .btn-nav:last-child`); if(nextBtn) nextBtn.disabled = false; saveProgress(); }
    function checkQ16Completion() { checkInteractiveQuestion(16, document.getElementById('q16-events').children.length === 0, 'feedback16', 'q16-container', () => { let cC = 0; document.querySelectorAll('#q16-container .dropzone').forEach(z => { const i = z.children[0]; const isC = i && z.dataset.target === i.dataset.id; if(i) i.classList.add(isC ? 'correct' : 'incorrect'); if(isC) cC++; }); return cC === 4; }); }
    function toggleFeatureSelection(feature) { if (isAnswered[17]) return; feature.classList.toggle('selected'); q17_selections = Array.from(document.querySelectorAll('#q17-builder .feature-option.selected')).map(el => el.dataset.id); if (q17_selections.length >= 4) { checkQ17Completion(); } }
    function checkQ17Completion() { if (isAnswered[17]) return; const isC = q17_selections.length >= 4; if (isC) { checkInteractiveQuestion(17, true, 'feedback17', 'q17-builder', () => true); } }
    function checkQ18Completion() { checkInteractiveQuestion(18, document.getElementById('q18-source').children.length === 0, 'feedback18', 'q18-container', () => { const cO = ['led', 'sodium', 'incandescent']; const uO = []; document.querySelectorAll('#q18-container .ranking-slot .dropzone').forEach(z => { const i = z.children[0]; if(i) { const isC = i.dataset.id === cO[parseInt(z.dataset.rank) - 1]; i.classList.add(isC ? 'correct' : 'incorrect'); uO.push(i.dataset.id); } }); return JSON.stringify(cO) === JSON.stringify(uO); }); }
    function checkQ20Completion() { checkInteractiveQuestion(20, document.getElementById('q20-source').children.length === 0, 'feedback20', 'q20-container', () => { const aI = Array.from(document.querySelectorAll('#q20-container .dropzone[data-target] .draggable-item')); aI.forEach(i => { const isC = i.dataset.category === i.parentElement.dataset.target; i.classList.add(isC ? 'correct' : 'incorrect'); }); return aI.every(i => i.dataset.category === i.parentElement.dataset.target); }); }
    function startTimer() { if (timerInterval) clearInterval(timerInterval); timerInterval = setInterval(() => { secondsElapsed++; const m = Math.floor(secondsElapsed / 60).toString().padStart(2, '0'); const s = (secondsElapsed % 60).toString().padStart(2, '0'); const t = `${m}:${s}`; if(dom.timerDisplay) dom.timerDisplay.textContent = t; if(document.getElementById('statsTime')) document.getElementById('statsTime').textContent = t; }, 1000); }
    function onYouTubeIframeAPIReady() {}
    function createPlayer() {
        if (videoPlayer) {
            videoPlayer.playVideo();
            return;
        }
        curiosityTracker.videoClicked = true;
        checkCuriosityBadge();
        dom.videoPlayerContainer.classList.add('player-active');
        dom.videoPlayerContainer.innerHTML = '<div id="player-iframe"></div>';
        videoPlayer = new YT.Player('player-iframe', {
            height: '100%',
            width: '100%',
            videoId: 'GRwOsXCW2jM',
            playerVars: { 'autoplay': 1, 'rel': 0, 'controls': 1 },
            events: {
                'onReady': () => {},
                'onStateChange': e => {
                    const p = e.data === YT.PlayerState.PLAYING;
                    dom.videoStatusIcon.textContent = p ? '🎶' : '🎬';
                }
            }
        });
    }
    function setupEventListeners() {
        dom.startQuizBtn.addEventListener('click', () => startQuiz(true)); dom.resumeBtn.addEventListener('click', resumeQuiz);
        dom.homeBtn.addEventListener('click', goHome); dom.toolResetBtn.addEventListener('click', restartQuiz);
        dom.resultsReviewBtn.addEventListener('click', reviewQuestions);
        dom.reviewErrorsBtn.addEventListener('click', reviewErrors);
        dom.resultsRestartBtn.addEventListener('click', restartQuiz);

        document.querySelectorAll('.question-card .nav-buttons').forEach(container => {
            const prevBtn = container.querySelector('.btn-nav:first-child'); const nextBtn = container.querySelector('.btn-nav:last-child');
            prevBtn.addEventListener('click', previousQuestion); nextBtn.addEventListener('click', nextQuestion);
        });
        document.addEventListener('click', e => { 
            const o = e.target.closest('.option:not(.disabled)'); if (o) { isReviewing = false; const qN = parseInt(o.closest('.question-card').dataset.question); handleAnswer(qN, o.dataset.answer, o); } 
            const d = e.target.closest('.progress-dot.clickable'); if (d) { reviewQuestion(parseInt(d.dataset.questionIndex)); }
            if (e.target.matches('.review-banner .btn-link-review')) { showResults(false); }
        });
        document.addEventListener('keydown', e => { if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return; const k = e.key; if (k === 'ArrowRight') { e.preventDefault(); document.querySelector('.question-card.active .nav-buttons .btn-nav:last-child').click(); } else if (k === 'ArrowLeft') { e.preventDefault(); document.querySelector('.question-card.active .nav-buttons .btn-nav:first-child').click(); } else if (['1', '2', '3', '4'].includes(k)) { const aC = document.querySelector('.question-card.active'); if (aC && aC.querySelector('.option:not(.disabled)')) { const o = aC.querySelector(`.option:nth-child(${k})`); if(o && !o.classList.contains('disabled')) { e.preventDefault(); o.click(); } } } else if (k === 'Escape' && dom.statsModalOverlay.classList.contains('show')) { closeStatsModal(); } });
        dom.liveScore.addEventListener('click', openStatsModal); dom.keyboardHint.addEventListener('mouseover', () => { curiosityTracker.hintHovered = true; checkCuriosityBadge(); }, { once: true });
        dom.videoPlayerContainer.addEventListener('click', createPlayer);
        dom.modalCloseBtn.addEventListener('click', closeStatsModal);
        dom.statsModalOverlay.addEventListener('click', e => { if (e.target === dom.statsModalOverlay) closeStatsModal(); });
        document.getElementById('minimizeBtn').addEventListener('click', (e) => { e.stopPropagation(); dom.videoWidget.classList.toggle('minimized'); });
        dom.videoWidget.addEventListener('click', () => { if (dom.videoWidget.classList.contains('minimized')) dom.videoWidget.classList.remove('minimized'); });
        dom.resetQuizBtn.addEventListener('click', restartQuiz);
    }
    function init() {
        totalQuestions = document.querySelectorAll('.question-card').length; answers = new Array(totalQuestions + 1).fill(null); isAnswered = new Array(totalQuestions + 1).fill(false);
        dom.totalQuestionsDisplay.textContent = totalQuestions;
        dom.progressDotsContainer.innerHTML = questionTitles.map((title, i) => `<div class="progress-dot" data-question-index="${i + 1}" data-tooltip="Q${i + 1}: ${title}"></div>`).join('');
        document.querySelectorAll('.question-card .nav-buttons').forEach(container => { container.innerHTML = `<button class="btn-nav" title="Précédent (←)" aria-label="Question précédente" disabled>←</button> <button class="btn-nav" title="Suivant (→)" aria-label="Question suivante" disabled>→</button>`; });
        setupTheme(); setupEventListeners(); setupInteractiveQuestions();
        const savedProgress = localStorage.getItem(quizSaveKey);
        if(savedProgress) { 
            dom.resumeBtn.style.display = 'inline-flex'; 
            dom.startQuizBtn.textContent = 'Recommencer';
            dom.startQuizBtn.classList.remove('btn-primary');
            dom.startQuizBtn.classList.add('btn-secondary');
            dom.resumeBtn.classList.remove('btn-secondary');
            dom.resumeBtn.classList.add('btn-primary');
        }
        updateLiveScore();
    }
    document.addEventListener('DOMContentLoaded', init);
    })();
    </script>
</body>
</html>
