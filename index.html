<!DOCTYPE html>
<html lang="fr" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>L'√âclairage Urbain : Des Lumi√®res de la Ville aux Smart Cities</title>
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cstyle%3Epath %7B fill: %233498db; %7D @media (prefers-color-scheme: dark) %7B path %7B fill: %23f7b733; %7D %7D%3C/style%3E%3Cpath d='M44,87.5 C44,90.261 46.239,92.5 49,92.5 L51,92.5 C53.761,92.5 56,90.261 56,87.5 L56,83.5 L44,83.5 L44,87.5 Z M66.3,74.7 C66.3,74.7 75,66.9 75,54.5 C75,41.512 64.988,31.5 52,31.5 L48,31.5 C35.012,31.5 25,41.512 25,54.5 C25,66.9 33.7,74.7 33.7,74.7 L33.7,79.5 L66.3,79.5 L66.3,74.7 Z'/%3E%3C/svg%3E" type="image/svg+xml">

    <style>
        @property --p { syntax: '<number>'; inherits: true; initial-value: 0; }
        :root {
            --primary-color: #f7b733; --primary-color-rgb: 247, 183, 51;
            --secondary-color: #fc4a1a; --accent-color: #4abdac;
            --success-color: #27ae60; --error-color: #e74c3c;
            --bg-color: #1B263B; --card-bg: #233142; --main-text-color: #E0E1DD;
            --secondary-text-color: #A0A0A0; --footer-text-color: rgba(224, 225, 221, 0.5);
            --glass-bg: rgba(35, 49, 66, 0.8); --glass-border: rgba(224, 225, 221, 0.2);
            --card-shadow: rgba(0, 0, 0, 0.4); --card-shadow-hover: rgba(0, 0, 0, 0.5);
            --option-bg: rgba(224, 225, 221, 0.05); --option-hover-bg: rgba(224, 225, 221, 0.1);
            --progress-track-bg: #1B263B;
            --tooltip-bg: var(--card-bg); --tooltip-border: rgba(var(--primary-color-rgb), 0.5); --tooltip-text-color: var(--main-text-color);
        }
        html[data-theme='light'] {
            --primary-color: #3498db; --primary-color-rgb: 52, 152, 219;
            --secondary-color: #2980b9; --bg-color: #f4f6f8;
            --card-bg: #ffffff; --main-text-color: #2c3e50; --secondary-text-color: #6c757d;
            --footer-text-color: rgba(0, 0, 0, 0.5); --glass-bg: rgba(255, 255, 255, 0.85);
            --glass-border: rgba(0, 0, 0, 0.1); --card-shadow: rgba(44, 62, 80, 0.15);
            --card-shadow-hover: rgba(44, 62, 80, 0.25);
            --option-bg: rgba(52, 152, 219, 0.05); --option-hover-bg: rgba(52, 152, 219, 0.1);
            --progress-track-bg: #e9ecef;
            --tooltip-bg: var(--card-bg); --tooltip-border: rgba(var(--primary-color-rgb), 0.4); --tooltip-text-color: var(--main-text-color);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            line-height: 1.6; color: var(--main-text-color); background-color: var(--bg-color);
            min-height: 100vh; transition: background-color 0.3s ease, color 0.3s ease;
        }
        .container { max-width: 1000px; margin: 0 auto; padding: 20px; }
        .hidden { display: none !important; }
        html[data-theme='dark'] strong, html[data-theme='dark'] b { color: var(--primary-color); }
        .header { 
            text-align: center; background: var(--card-bg); 
            padding: 30px; border-radius: 20px; margin-bottom: 30px; 
            box-shadow: 0 15px 35px var(--card-shadow); border: 1px solid var(--glass-border); 
            transition: all 0.4s ease-in-out; 
            display: flex; justify-content: space-between; align-items: center;
            position: relative; overflow: hidden;
        }
        .header-bg-image {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-image: linear-gradient(to right, rgba(27, 38, 59, 0.95), rgba(27, 38, 59, 0.7)), url('https://img.freepik.com/vecteurs-premium/beau-coucher-soleil-mer-horizon-coucher-soleil-ocean_104785-1072.jpg?w=826');
            background-size: cover; background-position: center;
            opacity: 1; transition: opacity 0.5s ease-in-out;
            z-index: 0;
        }
        html[data-theme='light'] .header-bg-image {
             background-image: linear-gradient(to right, rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.7)), url('https://img.freepik.com/vecteurs-premium/beau-coucher-soleil-mer-horizon-coucher-soleil-ocean_104785-1072.jpg?w=826');
        }
        .header.header-compact .header-bg-image { opacity: 0; }
        .header-content {
            display: flex; justify-content: space-between; align-items: center;
            width: 100%; z-index: 1;
        }
        .header-title-container { text-align: left; }
        .header h1 { color: var(--primary-color); font-size: 2.2em; margin-bottom: 0px; text-shadow: 0 2px 10px rgba(var(--primary-color-rgb), 0.3); transition: font-size 0.4s ease-in-out; }
        .header .subtitle { font-size: 1.1em; color: var(--secondary-text-color); font-weight: 500; transition: opacity 0.3s, max-height 0.4s ease-in-out, margin 0.4s; max-height: 100px; opacity: 1; }
        html[data-theme='light'] .header h1 { color: var(--primary-color); text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.1); }
        html[data-theme='light'] .header .subtitle { color: #5a6875; }
        .header.header-compact { padding-top: 20px; padding-bottom: 20px; }
        .header.header-compact h1 { font-size: 1.6em; }
        .header.header-compact .subtitle { max-height: 0; opacity: 0; margin: 0; }
        .theme-switch { display: flex; align-items: center; gap: 10px; cursor: pointer; padding: 5px; border-radius: 20px; background: var(--option-bg); }
        .theme-switch-label { font-size: 1.2rem; color: var(--secondary-text-color); transition: color 0.3s ease; }
        .theme-switch input { display: none; }
        .switch-track { position: relative; width: 50px; height: 26px; background-color: var(--bg-color); border: 1px solid var(--glass-border); border-radius: 13px; transition: background-color 0.3s ease; }
        .switch-thumb { position: absolute; top: 2px; left: 2px; width: 20px; height: 20px; background-color: var(--secondary-text-color); border-radius: 50%; transition: transform 0.3s ease, background-color 0.3s ease; }
        .theme-switch input:checked + .switch-track .switch-thumb { transform: translateX(24px); background-color: var(--primary-color); }
        #sun-icon { display: none; } html[data-theme='light'] #moon-icon { display: none; } html[data-theme='light'] #sun-icon { display: block; }
        #startScreen { background: var(--card-bg); padding: 30px; border-radius: 20px; box-shadow: 0 10px 30px var(--card-shadow); text-align: left; animation: slideInUp 0.6s ease-out; margin-bottom: 20px; }
        .start-title { font-size: 1.5em; color: var(--primary-color); margin-bottom: 10px; }
        .start-section { margin: 25px 0; }
        .start-section h4 { color: var(--accent-color); margin-bottom: 15px; border-bottom: 2px solid var(--glass-border); padding-bottom: 5px; display: inline-flex; align-items: center; gap: 8px; }
        .start-section ul { list-style-type: '‚úì '; padding-left: 20px; }
        .start-section li { margin-bottom: 8px; }
        .start-video-box, .start-update-box { background: var(--option-bg); padding: 15px; border-radius: 10px; border-left: 3px solid var(--primary-color); }
        .start-video-box { display: flex; align-items: center; gap: 20px; flex-wrap: wrap; }
        .video-link-start { display: inline-flex; align-items: center; gap: 8px; padding: 10px 20px; background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); color: white; text-decoration: none; border-radius: 25px; font-weight: bold; transition: transform 0.3s ease, box-shadow 0.3s ease; font-size: 0.9em; }
        .video-link-start:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(var(--primary-color-rgb), 0.5); }
        .start-actions { text-align: center; margin-top: 30px; display: flex; justify-content: center; gap: 15px; flex-wrap: wrap; }
        #startQuizBtn { font-size: 1.2em; padding: 15px 40px; }
        #resumeBtn { display: none; font-size: 1.15em; }
        .quiz-content.hidden { display: none; }
        .btn { display: inline-flex; align-items: center; justify-content: center; gap: 8px; padding: 12px 30px; border: none; border-radius: 25px; cursor: pointer; font-weight: bold; transition: all 0.3s ease; }
        .btn:active { transform: translateY(-1px) scale(0.98); }
        .btn-primary { background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); color: white; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(var(--primary-color-rgb), 0.4); }
        .btn-secondary { background: var(--option-bg); color: var(--main-text-color); border: 1px solid var(--glass-border); }
        .btn-secondary:hover { background: var(--option-hover-bg); }

        .floating-widget { display: none; }
        body.quiz-active .floating-widget { display: flex; }

        .live-score-widget, .tool-widget, .keyboard-hint, .video-container { position: fixed; background: var(--glass-bg); backdrop-filter: blur(5px); border: 1px solid var(--glass-border); color: var(--main-text-color); border-radius: 20px; box-shadow: 0 4px 15px var(--card-shadow); font-size: 0.9em; z-index: 1001; transition: all 0.3s ease; }
        
        .live-score-widget { top: 20px; right: 20px; width: 84px; height: 92px; cursor: pointer; text-align: center; overflow: hidden; padding:0; }
        .live-score-widget:hover { transform: translateY(-3px) scale(1.05); box-shadow: 0 8px 25px var(--card-shadow-hover); }
        .widget-inner-flipper { position: relative; width: 100%; height: 200%; top: 0; transition: transform 0.4s ease-in-out; }
        .live-score-widget:hover .widget-inner-flipper { transform: translateY(-50%); }
        .score-display-area, .badge-count-display { width: 100%; height: 50%; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .score-display-area { padding-top: 5px; }
        .badge-count-display { gap: 4px; }
        .badge-count-display .badge-icon { font-size: 2em; line-height: 1; }
        #badgeCount { font-weight: bold; font-size: 1.1em; }
        
        .score-progress-circle { width: 60px; height: 60px; border-radius: 50%; display: grid; place-items: center; background: radial-gradient(closest-side, var(--card-bg) 84%, transparent 85% 100%), conic-gradient(var(--accent-color) calc(var(--p) * 1%), var(--progress-track-bg) 0); transition: --p 0.5s ease-out, transform 0.4s ease; }
        .score-text-content { font-size: 1.05em; display: flex; align-items: baseline; }
        #currentScore, #totalQuestionsDisplay { font-weight: bold; }
        .score-divider { font-weight: normal; font-size: 0.9em; color: var(--secondary-text-color); margin: 0 2px; }
        .score-label { font-size: 0.8em; color: var(--secondary-text-color); margin-top: 2px; font-weight: 500; }
        .score-progress-circle.updated-score { transform: scale(1.1); }
        
        .tool-widget { top: 20px; left: 20px; align-items: center; border-radius: 25px; cursor: pointer; height: 45px; padding: 0 15px; width: 105px; transition: width 0.4s ease-in-out, background-color 0.3s; }
        body.quiz-active .tool-widget:hover { width: 215px; }
        .tool-content { display: flex; align-items: center; width: 100%; justify-content: flex-start; gap: 12px; }
        .tool-timer { display: flex; align-items: center; gap: 8px; font-weight: bold; flex-shrink: 0; }
        .timer-icon { display: flex; align-items: center; }
        .timer-icon svg { width: 20px; height: 20px; }
        #timerDisplay { font-family: 'Courier New', Courier, monospace; letter-spacing: 1px; }
        .tool-separator, .tool-actions { flex-shrink: 0; transition: opacity 0.3s 0.1s, width 0.4s ease-in-out; }
        .tool-separator { width: 0; opacity: 0; height: 20px; background-color: var(--glass-border); }
        .tool-actions { width: 0; opacity: 0; overflow: hidden; display: flex; align-items: center; gap: 5px; white-space: nowrap; }
        body.quiz-active .tool-widget:hover .tool-separator { width: 1px; opacity: 1; }
        body.quiz-active .tool-widget:hover .tool-actions { width: 64px; opacity: 1; }
        .tool-action-btn { background: none; border: none; color: var(--main-text-color); cursor: pointer; font-size: 1.4em; padding: 5px; border-radius: 50%; display: flex; align-items: center; justify-content: center; transition: background-color 0.2s; position: relative; }
        .tool-action-btn:hover { background-color: var(--option-hover-bg); }
        .tool-action-btn svg { width: 20px; height: 20px; }
        
        .tooltip-text {
            visibility: hidden;
            width: max-content;
            max-width: 240px;
            background-color: var(--tooltip-bg);
            color: var(--tooltip-text-color);
            text-align: center;
            border-radius: 8px;
            padding: 8px 12px;
            position: absolute;
            z-index: 100;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.2s ease, visibility 0.2s ease;
            font-size: 0.9em;
            font-weight: normal;
            border: 1px solid var(--tooltip-border);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            pointer-events: none;
            bottom: 130%;
        }
        .tool-action-btn:hover .tooltip-text, .tool-action-btn:focus-visible .tooltip-text,
        .badge-earned-item:hover .tooltip-text, .badge-earned-item:focus-visible .tooltip-text,
        .progress-dot:hover .tooltip-text, .progress-dot:focus-visible .tooltip-text,
        .tooltip:hover .tooltip-text, .tooltip:focus-visible .tooltip-text {
            visibility: visible;
            opacity: 1;
            transition-delay: 0.4s;
        }
        
        .tooltip-text::after { content: ""; position: absolute; left: 50%; transform: translateX(-50%); border-width: 6px; border-style: solid; top: 100%; border-color: var(--tooltip-border) transparent transparent transparent; }
        .tooltip-text.bottom { bottom: auto; top: 130%; }
        .tooltip-text.bottom::after { top: auto; bottom: 100%; transform: translateX(-50%) rotate(180deg); }
        .tooltip { border-bottom: 1px dotted var(--accent-color); color: var(--accent-color); cursor: help; position: relative; }
        .tooltip.no-underline { border-bottom: none; }
        
        .keyboard-hint { bottom: 20px; left: 20px; position: fixed; align-items: center; border-radius: 25px; cursor: pointer; overflow: hidden; width: 45px; height: 45px; padding: 0; transition: width 0.4s ease-in-out; }
        .keyboard-hint:hover { width: 400px; }
        .hint-icon { position: absolute; top: 0; left: 0; width: 45px; height: 45px; display: flex; align-items: center; justify-content: center; z-index: 2; }
        .hint-icon svg { width: 24px; height: 24px; }
        .hint-text { padding-left: 55px; white-space: nowrap; padding-right: 15px; opacity: 0; transition: opacity 0.3s 0.1s; font-size: 0.9em; }
        .keyboard-hint:hover .hint-text { opacity: 1; }
        .review-banner { display: none; background: rgba(74, 189, 172, 0.15); border-left: 4px solid var(--accent-color); padding: 10px 15px; margin-bottom: 20px; border-radius: 8px; font-size: 0.9em; }
        .question-card.review-mode-active .review-banner { display: flex; align-items: center; gap: 15px; }
        .review-banner .btn-link-review { background: none; border: none; color: var(--accent-color); text-decoration: underline; cursor: pointer; font-size: 0.9em; margin-left: auto; font-weight: bold; padding: 5px; }
        .review-banner .btn-link-review:hover { text-decoration: none; }
        .progress-container { background: var(--card-bg); padding: 20px; border-radius: 15px; margin-bottom: 20px; border: 1px solid var(--glass-border); transition: background-color 0.3s ease, border-color 0.3s ease; }
        .progress-header { display: flex; justify-content: space-between; align-items: baseline; margin-bottom: 10px; }
        .progress-track { position: relative; width: 100%; height: 20px; margin: 15px 0; }
        .progress-bar { width: 100%; height: 6px; background: var(--progress-track-bg); border-radius: 3px; position: absolute; top: 50%; transform: translateY(-50%); overflow: hidden; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, var(--primary-color), var(--secondary-color)); border-radius: 3px; transition: width 0.4s ease-out; width: 0%; }
        .progress-dots { display: flex; justify-content: space-between; align-items: center; width: 100%; position: absolute; top: 50%; transform: translateY(-50%); z-index: 2; }
        .progress-dot { width: 14px; height: 14px; background-color: var(--secondary-text-color); border-radius: 50%; transition: all 0.3s; border: 3px solid var(--card-bg); cursor: not-allowed; position: relative; }
        .progress-dot.clickable { cursor: pointer; }
        .progress-dot.completed-correct { background-color: var(--success-color); }
        .progress-dot.completed-incorrect { background-color: var(--error-color); }
        .progress-dot.active { background-color: var(--primary-color); border-color: var(--primary-color); transform: scale(1.2); box-shadow: 0 0 12px var(--primary-color); }
        .question-card { background: var(--card-bg); padding: 30px; border-radius: 20px; margin-bottom: 0; box-shadow: 0 10px 30px var(--card-shadow); display: none; transition: background-color 0.3s ease, border-color 0.3s ease; }
        .question-card.active { display: block; animation: slideInRight 0.5s ease-out forwards; }
        .question-card.slide-from-left { animation: slideInLeft 0.5s ease-out forwards; }
        .question-card.slide-out-left { animation: slideOutLeft 0.4s ease-in forwards; }
        .question-card.slide-out-right { animation: slideOutRight 0.4s ease-in forwards; }
        @keyframes slideInRight { from { opacity: 0; transform: translateX(50px); } to { opacity: 1; transform: translateX(0); } }
        @keyframes slideInLeft { from { opacity: 0; transform: translateX(-50px); } to { opacity: 1; transform: translateX(0); } }
        @keyframes slideOutLeft { from { opacity: 1; transform: translateX(0); } to { opacity: 0; transform: translateX(-50px); } }
        @keyframes slideOutRight { from { opacity: 1; transform: translateX(0); } to { opacity: 0; transform: translateX(50px); } }
        .question-header { display: flex; align-items: center; margin-bottom: 20px; justify-content: space-between; }
        .question-header-left { display: flex; align-items: center; }
        .question-number { background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); color: white; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; margin-right: 15px; flex-shrink: 0;}
        .question-category { display: inline-flex; align-items: center; gap: 8px; background: var(--option-bg); color: var(--main-text-color); padding: 5px 15px; border-radius: 20px; font-size: 0.9em; font-weight: bold; }
        .modern-topic-tag { color: var(--accent-color); font-weight: bold; margin-left: 5px; display: inline-block; vertical-align: middle; }
        .question-title { font-size: 1.4em; color: var(--main-text-color); margin: 15px 0; border-radius: 5px; transition: box-shadow 0.2s ease-out; }
        .question-title:focus-visible { outline: none; }
        .options { margin: 20px 0; }
        .option { display: flex; align-items: center; background: var(--option-bg); padding: 15px; margin: 10px 0; border-radius: 10px; cursor: pointer; transition: background-color 0.3s, transform 0.3s, border-color 0.3s; border: 2px solid transparent; }
        .option:focus-visible { outline: 2px solid var(--primary-color); outline-offset: 2px; }
        .option-number { font-weight: bold; color: var(--primary-color); border: 2px solid var(--primary-color); border-radius: 50%; width: 24px; height: 24px; display: inline-flex; justify-content: center; align-items: center; margin-right: 15px; flex-shrink: 0; transition: transform 0.2s; }
        .option:hover .option-number { transform: scale(1.2); }
        .option:hover { background: var(--option-hover-bg); transform: translateX(5px); }
        .option.selected { background-color: rgba(var(--primary-color-rgb), 0.2); border-color: var(--primary-color); }
        .option.correct { background: rgba(39, 174, 96, 0.2); border-color: var(--success-color); }
        .option.correct .option-number { background-color: var(--success-color); color: white; border-color: var(--success-color); }
        .option.correct.glow { animation: glow-correct 1.5s ease-out; }
        @keyframes glow-correct { 0% { box-shadow: 0 0 0px var(--success-color); } 50% { box-shadow: 0 0 15px var(--success-color); } 100% { box-shadow: 0 0 0px var(--success-color); } }
        .option.incorrect { background: rgba(231, 76, 60, 0.2); border-color: var(--error-color); }
        .option.incorrect .option-number { background-color: var(--error-color); color: white; border-color: var(--error-color); }
        .option.disabled { cursor: not-allowed; opacity: 0.7; }
        .option.disabled:hover { transform: none; background: var(--option-bg); }
        .option.disabled:hover .option-number { transform: none; }
        .feedback { margin: 20px 0; padding: 20px; border-radius: 10px; display: none; border-left-width: 5px; border-left-style: solid;}
        .feedback:focus-visible, .feedback:focus { outline: none; }
        .feedback.show { display: block; animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .feedback.correct { background: rgba(39, 174, 96, 0.15); border-left-color: var(--success-color); }
        .feedback.incorrect { background: rgba(231, 76, 60, 0.15); border-left-color: var(--error-color); }
        .feedback-title { font-weight: bold; font-size: 1.1em; margin-bottom: 8px; }
        .feedback-explanation { margin-bottom: 15px; }
        .calculation-breakdown { background: var(--option-bg); padding: 10px 15px; border-radius: 8px; margin-top: 10px; font-family: 'Courier New', Courier, monospace; font-size: 0.95em; border-left: 3px solid var(--primary-color); }
        .video-timestamp-hint { display: flex; align-items: center; gap: 8px; font-size: 0.85em; padding: 8px 12px; margin-top: 15px; border-radius: 8px; background: rgba(var(--primary-color-rgb), 0.1); border-left: 3px solid var(--primary-color); color: var(--secondary-text-color); }
        .video-timestamp-hint button { background: none; border: none; cursor: pointer; color: var(--main-text-color); font-weight: bold; text-decoration: underline; padding: 0; font-size: 1em; }
        .video-timestamp-hint button:hover { color: var(--primary-color); }
        html[data-theme='light'] .video-timestamp-hint strong { color: var(--secondary-color); }
        html[data-theme='light'] .video-timestamp-hint button { color: var(--secondary-color); }
        .context-box { background: rgba(var(--primary-color-rgb), 0.1); border-left: 5px solid var(--primary-color); padding: 15px; margin: 15px 0; border-radius: 5px; }
        .nav-buttons { display: flex; gap: 10px; margin-top: 20px; }
        .btn-nav { background: var(--glass-bg); backdrop-filter: blur(5px); border: 1px solid var(--glass-border); width: 45px; height: 45px; border-radius: 50%; transition: all 0.2s ease-out; display: flex; align-items: center; justify-content: center; color: var(--main-text-color); font-size: 1.5em; }
        .btn-nav:not(:disabled) { cursor: pointer; }
        .btn-nav:not(:disabled):hover { background: var(--option-hover-bg); transform: scale(1.1); }
        .btn-nav:not(:disabled):active { transform: scale(0.95); transition-duration: 0.1s; }
        .btn-nav:disabled { opacity: 0.4; cursor: not-allowed; backdrop-filter: none; }
        .nav-buttons .btn-nav:last-child:not(:disabled) { background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); color: white; border: none; box-shadow: 0 0 10px rgba(var(--primary-color-rgb), 0.4); }
        .nav-buttons.review-mode-active .btn-nav:last-child { background: var(--glass-bg); color: var(--main-text-color); border: 1px solid var(--glass-border); box-shadow: none; }
        .nav-buttons.review-mode-active .btn-nav:not(:disabled):hover { background: var(--option-hover-bg); transform: scale(1.1); }
        .ranking-container { display: flex; flex-wrap: wrap; gap: 20px; justify-content: center; align-items: flex-start; }
        .ranking-source, .ranking-slots { padding: 10px; border-radius: 10px; border: 2px dashed var(--secondary-text-color); }
        .ranking-source { display: flex; flex-direction: column; gap: 10px; min-height: 150px; flex-basis: 200px; }
        .ranking-slots { flex-basis: 300px; }
        .ranking-slot { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; }
        .ranking-slot .rank-label { font-weight: bold; width: 130px; text-align: right; }
        .ranking-slot .dropzone { flex: 1; min-height: 45px; border-radius: 8px; }
        details { margin-top: 15px; background: var(--option-bg); border-radius: 8px; padding: 5px 15px; border-left: 3px solid var(--accent-color); }
        summary { cursor: pointer; font-weight: bold; padding: 10px 0; outline: none; display: flex; align-items: center; justify-content: space-between; }
        summary::-webkit-details-marker { display: none; }
        summary::after { content: '‚ñº'; font-size: 0.8em; transition: transform 0.3s ease; }
        details[open] summary::after { transform: rotate(180deg); }
        .details-content { padding: 10px 0 10px 0; font-size: 0.95em; }
        .details-content ul { list-style-type: '‚Ä¢ '; padding-left: 20px; }
        .details-content li { margin-bottom: 5px; }
        .results { text-align: center; padding: 30px; background: var(--card-bg); border-radius: 20px; display: none; position: relative; transition: background-color 0.3s ease; }
        .results h2 { outline: none; }
        .results.show { display: block; animation: zoomIn 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes zoomIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
        .score-circle { width: 150px; height: 150px; border-radius: 50%; margin: 20px auto; display: flex; align-items: center; justify-content: center; font-size: 2em; font-weight: bold; transition: background 0.5s ease, color 0.5s ease; background: var(--primary-color); color: white; }
        .results-stat-widget { position: absolute; top: 30px; display: flex; align-items: center; gap: 8px; font-size: 1em; color: var(--secondary-text-color); cursor: default; }
        #finalTimeWidget { left: 30px; }
        #attemptCounterWidget { right: 30px; }
        .results-stat-widget strong { color: var(--main-text-color); font-family: 'Courier New', Courier, monospace; font-weight: bold; font-size: 1.1em; }
        .results-stat-widget .timer-icon svg { width: 20px; height: 20px; fill: currentColor; }
        .results-summary { margin-top: 30px; text-align: left; }
        .summary-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .summary-filters { display: flex; gap: 8px; }
        .summary-filters button { font-size: 0.85em; padding: 5px 12px; border: 1px solid var(--glass-border); background: var(--option-bg); color: var(--main-text-color); border-radius: 15px; cursor: pointer; transition: background-color 0.2s; }
        .summary-filters button.active { background: var(--primary-color); color: white; border-color: var(--primary-color); }
        .summary-item { display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid var(--glass-border); font-size: 0.9em; cursor: pointer; transition: background-color 0.2s, max-height 0.3s, opacity 0.3s; }
        .summary-item.hidden { max-height: 0; opacity: 0; padding-top: 0; padding-bottom: 0; border: none; pointer-events: none; overflow: hidden; }
        .summary-item:hover { background-color: var(--option-hover-bg); }
        .summary-item:last-child { border-bottom: none; }
        .summary-item > div { display: flex; align-items: center; }
        .summary-result { font-weight: bold; padding: 3px 8px; border-radius: 12px; color: white; }
        .summary-result.correct { background-color: var(--success-color); }
        .summary-result.incorrect { background-color: var(--error-color); }
        .score-title { font-size: 1.5em; margin-top: 15px; color: var(--main-text-color); }
        #scoreDescription { margin-bottom: 15px; }
        #personalizedFeedback {
            font-style: normal;
            color: var(--main-text-color);
            font-weight: 500;
            font-size: 0.95em;
            margin: 30px 0;
            padding: 15px;
            background: var(--option-bg);
            border-radius: 8px;
            border-left: 3px solid var(--accent-color);
            text-align: left;
        }
        .key-takeaways, .category-performance { margin: 30px 0; padding: 20px; border-left-width: 4px; border-left-style: solid; border-radius: 8px; text-align: left; }
        .key-takeaways { background: rgba(74, 189, 172, 0.1); border-left-color: var(--accent-color); }
        .key-takeaways ul { list-style-type: '‚úì '; padding-left: 20px; }
        .key-takeaways li { margin-bottom: 10px; }
        .category-performance { background: rgba(var(--primary-color-rgb), 0.1); border-left-color: var(--primary-color); }
        .category-performance-title { color: var(--primary-color); }
        #category-performance-list { list-style: none; padding: 0; }
        .category-perf-item { display: flex; align-items: center; justify-content: space-between; gap: 15px; padding: 8px 0; border-bottom: 1px solid var(--glass-border); }
        .category-perf-item:last-child { border-bottom: none; }
        .category-perf-name { font-weight: bold; }
        .category-perf-score { font-weight: bold; font-size: 1.1em; }
        .badges-earned-container { margin: 30px 0; padding: 20px; background: rgba(var(--primary-color-rgb), 0.1); border-left: 4px solid var(--primary-color); border-radius: 8px; text-align: left; }
        #badges-earned { display: flex; flex-wrap: wrap; gap: 20px; justify-content: center; }
        .badge-earned-item { display: flex; flex-direction: column; align-items: center; position: relative; }
        #badges-earned .badge-earned-item { width: 130px; }
        .badges-grid .badge-earned-item { width: 120px; }
        .badge-earned-item .badge-icon { display: flex; align-items: center; justify-content: center; border-radius: 50%; transition: all 0.3s ease; }
        #badges-earned .badge-icon { font-size: 4em; width: 90px; height: 90px; }
        .badges-grid .badge-icon { font-size: 3.2em; width: 75px; height: 75px; }
        .badge-earned-item p { font-size: 0.85em; text-align: center; margin-top: 8px; color: var(--main-text-color); font-weight: bold; }
        .badge-earned-item.unearned { filter: grayscale(90%); opacity: 0.6; cursor: default; }
        .badge-earned-item.unearned .badge-icon {
            color: var(--secondary-text-color);
            border: 2px solid var(--glass-border);
        }
        .badge-earned-item.unearned p { color: var(--secondary-text-color); }
        .badge-earned-item:not(.unearned) .badge-icon {
            color: var(--primary-color);
            cursor: help;
            border: 2px solid rgba(var(--primary-color-rgb), 0.3);
            background-color: rgba(var(--primary-color-rgb), 0.1);
        }
        .badge-earned-item:not(.unearned):hover .badge-icon, .badge-earned-item:not(.unearned):focus-visible .badge-icon { transform: scale(1.1); background-color: rgba(var(--primary-color-rgb), 0.25); box-shadow: 0 0 20px rgba(var(--primary-color-rgb), 0.7); border-color: rgba(var(--primary-color-rgb), 0.6); }
        .results-actions { display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; margin-top: 30px; }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; box-shadow: none; }
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); backdrop-filter: blur(5px); z-index: 2000; display: none; align-items: center; justify-content: center; opacity: 0; transition: opacity 0.3s ease-out; padding: 20px; }
        html[data-theme='light'] .modal-overlay { background: rgba(244, 246, 248, 0.7); }
        .modal-overlay.show { display: flex; opacity: 1; }
        .stats-modal { background: var(--card-bg); color: var(--main-text-color); padding: 30px; border-radius: 20px; width: 100%; max-width: 600px; box-shadow: 0 10px 30px var(--card-shadow); position: relative; transition: background-color 0.3s ease, color 0.3s ease; transform: scale(0.95); opacity: 0; max-height: 90vh; overflow-y: auto; }
        .modal-overlay.show .stats-modal { animation: modal-fade-in 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }
        .modal-overlay.hiding .stats-modal { animation: modal-fade-out 0.3s ease-out forwards; }
        @keyframes modal-fade-in { to { transform: scale(1); opacity: 1; } }
        @keyframes modal-fade-out { from { transform: scale(1); opacity: 1; } to { transform: scale(0.95); opacity: 0; } }
        .modal-close-btn { position: absolute; top: 15px; right: 15px; background: var(--option-hover-bg); color: var(--main-text-color); border: none; border-radius: 50%; width: 30px; height: 30px; font-size: 1.2em; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: background-color 0.3s, transform 0.3s; }
        .modal-close-btn:hover { transform: rotate(90deg); }
        .stats-modal h3 { margin-top: 30px; }
        .stats-modal h3:first-of-type { margin-top: 0; }
        .stats-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px 20px; text-align: center; margin-top: 20px; }
        .stats-grid.performance-grid { grid-template-columns: repeat(3, 1fr); }
        .stat-item h4 { color: var(--primary-color); }
        .badges-grid { display: flex; flex-wrap: wrap; justify-content: center; gap: 20px; margin-top: 20px; }
        .badges-grid .badge-earned-item { position: relative; }
        .badge p { font-size: 0.8em; margin-top: 5px; font-weight: bold; }
        #confetti-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; overflow: hidden; pointer-events: none; z-index: 10; }
        .confetti { position: absolute; width: 10px; height: 10px; background-color: #f00; opacity: 1; animation: fall 5s linear forwards; }
        @keyframes fall { to { transform: translateY(110vh) rotate(720deg); opacity: 0; } }
        .interactive-question-container { display: flex; flex-wrap: wrap; gap: 20px; margin-top: 20px; user-select: none; }
        .draggable-item { background: var(--card-bg); padding: 10px; border-radius: 8px; cursor: grab; text-align: center; border: 2px solid var(--primary-color); transition: background-color 0.3s, border-color 0.3s, opacity 0.2s; color: var(--main-text-color); }
        .draggable-item.dragging { opacity: 0.4; }
        html[data-theme='light'] .draggable-item { background: #e9ecef; }
        .draggable-item:active { cursor: grabbing; opacity: 0.8; }
        .dropzone .draggable-item.correct { border-color: var(--success-color); background-color: rgba(39, 174, 96, 0.2); }
        .dropzone .draggable-item.incorrect { border-color: var(--error-color); background-color: rgba(231, 76, 60, 0.2); }
        .dropzone { flex: 1; min-height: 50px; background: var(--progress-track-bg); border: 2px dashed var(--secondary-text-color); border-radius: 10px; display: flex; align-items: center; justify-content: center; transition: background-color 0.3s; }
        html[data-theme='light'] .dropzone.over { background-color: #dee2e6; }
        html[data-theme='dark'] .dropzone.over { background-color: #2c3e50; }
        .interactive-question-container.disabled .draggable-item { cursor: not-allowed; }
        .interactive-question-container.disabled .dropzone, .interactive-question-container.disabled .timeline-events { pointer-events: none; opacity: 0.8; }
        .btn-autocomplete { margin: 20px auto 0; display: none; }
        @media (hover: none) and (pointer: coarse) { .btn-autocomplete { display: inline-flex; } }
        .timeline-container .timeline-events { flex: 1; min-width: 200px; border: 2px dashed var(--secondary-text-color); border-radius: 10px; padding: 10px; display: flex; flex-direction: column; gap: 10px; transition: background-color 0.3s;}
        .timeline-slots { flex: 2; min-width: 300px; }
        .timeline-slot { display: flex; align-items: center; margin-bottom: 10px; }
        .timeline-year { font-weight: bold; width: 100px; color: var(--main-text-color); }
        .question-image { max-width: 100%; border-radius: 10px; margin: 15px auto; display: block; box-shadow: 0 4px 10px var(--card-shadow); }
        .sorting-container { display: flex; flex-direction: column; gap: 20px; }
        .sorting-bins { display: flex; gap: 20px; flex-wrap: wrap; }
        .sorting-bin { flex: 1; min-width: 250px; padding: 10px; border: 2px solid var(--secondary-text-color); border-radius: 10px; }
        .sorting-bin h4 { text-align: center; margin-bottom: 10px; color: var(--main-text-color); }
        .sorting-bin .dropzone { flex-direction: column; gap: 8px; min-height: 100px; align-items: stretch; padding: 8px;}
        .sorting-source-list { display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; padding: 10px; border: 2px dashed var(--secondary-text-color); border-radius: 10px; margin-top: 10px; }
        .smart-lamppost-builder { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; margin-top: 20px; }
        .feature-option { background: var(--option-bg); padding: 15px; border-radius: 10px; border: 2px solid var(--secondary-text-color); cursor: pointer; text-align: center; transition: transform 0.3s, box-shadow 0.3s, border-color 0.3s, background-color 0.3s; }
        .feature-option:hover { transform: translateY(-3px); box-shadow: 0 4px 8px var(--card-shadow); }
        .feature-option:focus-visible { transform: translateY(-3px); box-shadow: 0 4px 8px var(--card-shadow); outline: 2px solid var(--primary-color); }
        .feature-option.selected { border-color: var(--primary-color); background-color: rgba(var(--primary-color-rgb), 0.2); box-shadow: 0 4px 8px rgba(0,0,0,0.15); }
        .feature-option.disabled { cursor: not-allowed; opacity: 0.7; }
        .feature-option.disabled:hover, .feature-option.disabled:focus-visible { transform: none; box-shadow: none; outline: none; }
        .feature-icon { font-size: 2.5em; margin-bottom: 10px; color: var(--primary-color); }
        #q17-description-box { margin-top: 20px; display: none; }
        #q17-description-box ul { list-style-type: none; padding-left: 0; }
        #q17-description-box li { margin-bottom: 8px; }
        
        /* --- STYLES VID√âO --- */
        .video-container { position: fixed; bottom: 80px; right: 20px; width: 280px; background: var(--glass-bg); backdrop-filter: blur(5px); border: 1px solid var(--glass-border); border-radius: 12px; box-shadow: 0 8px 32px var(--card-shadow); z-index: 1000; transition: all 0.4s ease-in-out; overflow: hidden; flex-direction: column; padding: 8px; gap: 8px; }
        .video-container:not(.minimized):hover { transform: scale(1.03); box-shadow: 0 12px 40px var(--card-shadow-hover); }
        .video-container.minimized { width: 60px; height: 60px; border-radius: 50%; background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); box-shadow: 0 5px 15px rgba(0,0,0,0.3); border: 2px solid rgba(255, 255, 255, 0.5); padding: 0; cursor: pointer; align-items: center; justify-content: center; }
        .video-container.minimized:hover { transform: scale(1.1); box-shadow: 0 8px 25px var(--card-shadow-hover); }
        .video-header { background: linear-gradient(135deg, rgba(var(--primary-color-rgb), 0.8), rgba(252, 74, 26, 0.8)); color: white; padding: 8px 15px; font-weight: bold; display: flex; justify-content: space-between; align-items: center; cursor: grab; user-select: none; border-radius: 8px; }
        html[data-theme='light'] .video-header { background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); }
        .video-container.minimized .video-header { background: transparent; justify-content: center; align-items: center; height: 100%; padding: 0; box-shadow: none; }
        .video-controls button { background: rgba(255,255,255,0.2); border: none; color: white; width: 24px; height: 24px; border-radius: 50%; cursor: pointer; transition: background 0.3s ease; display: flex; align-items: center; justify-content: center; }
        .video-controls button:hover { background: rgba(255,255,255,0.4); }
        .video-content { padding: 0; background: #000; border-radius: 8px; overflow: hidden; }
        .video-player-container { width: 100%; height: 145px; background-image: url('https://i.ytimg.com/vi/GRwOsXCW2jM/hqdefault.jpg'); background-size: cover; background-position: center; cursor: pointer; display: flex; align-items: center; justify-content: center; position: relative; }
        .video-player-container.player-loading::after { content: ''; position: absolute; width: 30px; height: 30px; border: 4px solid rgba(255, 255, 255, 0.3); border-top-color: #fff; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .video-player-container.player-loading .video-play-button, .video-player-container.player-loading .video-thumbnail-overlay { display: none; }
        .video-player-container iframe { width: 100%; height: 100%; border: none; }
        .video-container.minimized .video-title, .video-container.minimized .video-controls, .video-container.minimized .video-content { display: none; }
        .dynamic-icon { transition: transform 0.3s ease; display: inline-block; font-size: 1.8em; }
        .video-thumbnail-overlay { position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: linear-gradient(135deg, rgba(var(--primary-color-rgb), 0.5), rgba(var(--secondary-color-rgb), 0.7)); display: flex; align-items: flex-end; padding: 12px; pointer-events: none; transition: background 0.4s ease; }
        html[data-theme='light'] .video-thumbnail-overlay { background: linear-gradient(135deg, rgba(var(--primary-color-rgb), 0.6), rgba(var(--secondary-color-rgb), 0.8)); }
        .video-player-container:hover .video-thumbnail-overlay { background: linear-gradient(135deg, rgba(var(--primary-color-rgb), 0.3), rgba(var(--secondary-color-rgb), 0.5)); }
        .video-thumbnail-text { color: white; text-shadow: 0 1px 4px rgba(0,0,0,0.5); }
        .video-thumbnail-subtitle { font-size: 0.8em; opacity: 0.8; margin: 0; }
        .video-thumbnail-title { font-size: 1em; font-weight: bold; margin: 0; }
        .video-play-button { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 50px; height: 50px; background: rgba(255, 255, 255, 0.2); backdrop-filter: blur(5px); border-radius: 50%; display: flex; align-items: center; justify-content: center; border: 1px solid rgba(255, 255, 255, 0.3); color: white; transition: transform 0.3s ease, background-color 0.3s ease; pointer-events: none; }
        .video-play-button svg { width: 24px; height: 24px; margin-left: 3px; }
        .video-player-container:hover .video-play-button { transform: translate(-50%, -50%) scale(1.1); background: rgba(255, 255, 255, 0.3); }
        .video-player-container.player-active .video-thumbnail-overlay, .video-player-container.player-active .video-play-button { display: none; }
        
        #toast-container { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); z-index: 9999; display: flex; flex-direction: column-reverse; gap: 10px; align-items: center; pointer-events: none;}
        .toast { display: flex; align-items: center; gap: 15px; background: var(--tooltip-bg); color: var(--tooltip-text-color); padding: 12px 20px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.3); animation: toast-in-out 4s ease-in-out forwards; border: 1px solid var(--tooltip-border); }
        @keyframes toast-in-out { 0% { transform: translateY(100px) scale(0.9); opacity: 0; } 15% { transform: translateY(0) scale(1); opacity: 1; } 85% { transform: translateY(0) scale(1); opacity: 1; } 100% { transform: translateY(100px) scale(0.9); opacity: 0; } }
        
        #startFooter, #resultsFooter {
            text-align: center;
            padding-top: 20px;
            margin-top: 30px;
            color: var(--secondary-text-color);
            font-size: 0.9em;
            border-top: 1px solid var(--glass-border);
        }

        @media (max-width: 768px) { .video-container { width: 250px; } .floating-widget { font-size: 0.8em; padding: 8px 12px; } .keyboard-hint:hover { width: 300px; } body.quiz-active .tool-widget:hover { width: 180px; } .results-stat-widget { top: 15px; font-size: 0.9em;} #finalTimeWidget { left: 15px; } #attemptCounterWidget { right: 15px; } }
        @media (max-width: 480px) { .header:not(.header-compact) h1 { font-size: 1.8em; } .start-actions { flex-direction: column; } .results-stat-widget { display: none; }}

        /* --- MODIFICATIONS PAGE BILAN --- */
        #results #badges-earned {
            justify-content: space-around;
            flex-wrap: nowrap;
            gap: 10px;
        }
        #results #badges-earned .badge-earned-item {
            flex: 1;
            max-width: 120px;
            width: auto;
        }
        #results #badges-earned .badge-icon {
            font-size: 3.2em;
            width: 75px;
            height: 75px;
        }
        #results #badges-earned .badge-earned-item p {
            font-size: 0.8em;
        }
        #category-performance-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 15px;
            list-style: none;
            padding: 0;
        }
        .category-perf-item {
            display: flex;
            flex-direction: column;
            text-align: center;
            gap: 8px;
            background: var(--option-bg);
            padding: 15px;
            border-radius: 12px;
            border-bottom: none;
            border: 1px solid var(--glass-border);
            transition: all 0.3s ease;
        }
        .category-perf-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px var(--card-shadow);
        }
        .category-perf-name {
            color: var(--secondary-text-color);
            font-size: 0.9em;
            font-weight: bold;
        }
        .category-perf-bar-container {
            width: 100%;
        }
        .category-perf-score {
            font-size: 1.1em;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .category-perf-bar {
            width: 100%;
            height: 8px;
            background-color: var(--progress-track-bg);
            border-radius: 4px;
            overflow: hidden;
        }
        .category-perf-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            border-radius: 4px;
            transition: width 0.5s ease-out;
        }
        .results-accordion {
            background: var(--option-bg);
            border-radius: 12px;
            margin-top: 30px;
            border: 1px solid var(--glass-border);
            padding: 0;
        }
        .results-accordion summary {
            padding: 15px 20px;
            font-size: 1.1em;
            color: var(--main-text-color);
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .results-accordion summary:hover,
        .results-accordion summary:focus-visible {
            background-color: var(--option-hover-bg);
        }
        .results-accordion .results-summary {
            margin-top: 0;
            padding: 0 20px 20px 20px;
        }
    </style>
</head>
<body>
    <div class="live-score-widget floating-widget" id="liveScoreWidget" aria-live="polite" onclick="openStatsModal()" title="Voir les statistiques">
        <div class="widget-inner-flipper">
            <div class="score-display-area">
                <div class="score-progress-circle" id="scoreProgressCircle">
                    <div class="score-text-content">
                        <span id="currentScore">0</span><span class="score-divider">/</span><span id="totalQuestionsDisplay">0</span>
                    </div>
                </div>
                <div class="score-label">Score</div>
            </div>
            <div class="badge-count-display">
                <span class="badge-icon">üèÜ</span>
                <span id="badgeCount">0 / 8</span>
            </div>
        </div>
    </div>
    
    <div class="tool-widget floating-widget" id="toolWidget">
        <div class="tool-content">
            <div class="tool-timer">
                <span class="timer-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M15 1H9v2h6V1zm-4 13h2V8h-2v6zm8.03-6.61l1.42-1.42c-.43-.51-.9-.99-1.41-1.41l-1.42 1.42C16.07 4.74 14.12 4 12 4c-4.97 0-9 4.03-9 9s4.03 9 9 9 9-4.03 9-9c0-2.12-.74-4.07-1.97-5.61zM12 20c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"/></svg>
                </span>
                <span id="timerDisplay">00:00</span>
            </div>
            <div class="tool-separator"></div>
            <div class="tool-actions">
                <button class="tool-action-btn" aria-label="Accueil" id="homeBtn">
                    <span class="tooltip-text bottom">Accueil</span>
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8h5z"/></svg>
                </button>
                <button class="tool-action-btn" aria-label="R√©initialiser le quiz" id="toolResetBtn">
                    <span class="tooltip-text bottom">R√©initialiser</span>
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M17.65 6.35A7.958 7.958 0 0 0 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08A5.99 5.99 0 0 1 12 18c-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/></svg>
                </button>
            </div>
        </div>
    </div>

    <div class="keyboard-hint floating-widget" id="keyboardHint">
        <span class="hint-icon">
            <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24" fill="currentColor"><path d="M0 0h24v24H0z" fill="none"/><path d="M20 5H4c-1.1 0-1.99.9-1.99 2L2 17c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm-9 3h2v2h-2V8zm0 3h2v2h-2v-2zM8 8h2v2H8V8zm0 3h2v2H8v-2zm-1 2H5v-2h2v2zm0-3H5V8h2v2zm9 7H8v-2h8v2zm0-4h-2v-2h2v2zm0-3h-2V8h2v2zm3 3h-2v-2h2v2zm0-3h-2V8h2v2z"/></svg>
        </span>
        <span class="hint-text">Astuce : [1-4] pour r√©pondre, [‚Üí] pour continuer.</span>
    </div>
    
    <div class="container">
        <header class="header" id="mainHeader">
            <div class="header-bg-image"></div>
            <div class="header-content">
                <div class="header-title-container">
                    <h1>L'√âclairage Urbain</h1>
                    <p class="subtitle">Des Lumi√®res de la Ville aux Smart Cities</p>
                </div>
                <label for="theme-toggle-switch" class="theme-switch" title="Changer de th√®me">
                    <span class="theme-switch-label" id="moon-icon">üåô</span>
                    <span class="theme-switch-label" id="sun-icon">‚òÄÔ∏è</span>
                    <input type="checkbox" id="theme-toggle-switch">
                    <div class="switch-track"><div class="switch-thumb"></div></div>
                </label>
            </div>
        </header>

        <div id="startScreen">
            <h2 class="start-title">Bienvenue ! Pr√™t √† illuminer vos connaissances ?</h2>
            <p>Ce quiz interactif vous fera voyager √† travers l'histoire et les technologies de l'√©clairage public, un sujet au croisement de la <strong>technologie</strong>, de l'<strong>histoire</strong> et des <strong>sciences</strong>.</p>
            
            <div class="start-section">
                <h4>üß† Comp√©tences cl√©s √©valu√©es</h4>
                <ul>
                    <li>Compr√©hension de l'√©volution historique de l'√©clairage.</li>
                    <li>Connaissance des diff√©rentes technologies (incandescence, d√©charge, LED).</li>
                    <li>Analyse des enjeux √©nerg√©tiques et environnementaux.</li>
                    <li>Vision des innovations et du r√¥le de l'√©clairage dans les Smart Cities.</li>
                </ul>
            </div>
            
             <div class="start-section">
                <h4>üé¨ Conseil de pr√©paration</h4>
                <div class="start-video-box">
                    <p>Pour mettre toutes les chances de votre c√¥t√©, visionnez la vid√©o "C'est Pas Sorcier". Vous pouvez la garder visible pendant le quiz gr√¢ce au widget üé¨ en bas √† droite.</p>
                    <a href="https://youtu.be/GRwOsXCW2jM" target="_blank" class="video-link-start" title="C'est Pas Sorcier - Lumi√®res de la ville (26 minutes)">üé¨ Voir la vid√©o</a>
                </div>
            </div>

            <div class="start-section">
                <h4>üí° Bon √† savoir avant de commencer</h4>
                 <div class="start-update-box" style="border-left-color: var(--accent-color);">
                    <p>La vid√©o de r√©f√©rence pr√©sente tr√®s bien les anciennes technologies, notamment les lampes √† sodium qui donnent cette fameuse lumi√®re <strong class="tooltip" aria-describedby="tooltip-start-orange">orang√©e<span class="tooltip-text" id="tooltip-start-orange">Cette couleur est typique des lampes √† vapeur de sodium, tr√®s r√©pandues pour leur efficacit√© √©nerg√©tique malgr√© leur mauvais rendu des couleurs.</span></strong> aux villes. C'√©tait la norme, mais aujourd'hui, le paysage a radicalement chang√©.</p>
                    <p style="margin-top:10px;">Ce quiz va donc plus loin et vous met √† jour sur les technologies actuelles que vous devrez ma√Ætriser pour r√©ussir. Attendez-vous √† des questions sur les <strong>LEDs</strong>, les <strong>Smart Cities</strong> et les nouveaux <strong>enjeux environnementaux</strong> !</p>
                </div>
            </div>

            <div class="start-actions">
                <button class="btn btn-primary" id="startQuizBtn">üöÄ Commencer le Quiz !</button>
                <button class="btn btn-secondary" id="resumeBtn">üîÑ Reprendre la session</button>
            </div>
            <footer id="startFooter">R√©alis√© par David Trafial</footer>
        </div>

        <div class="quiz-content hidden">
            <div class="progress-container">
                <div class="progress-header"><h3>Progression</h3><p id="progressText">Question 1 / 20</p></div>
                <div class="progress-track">
                    <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
                    <div class="progress-dots" id="progressDots"></div>
                </div>
            </div>
            
            <div id="questions-wrapper">
                 <div class="question-card" data-question="1" data-category="Histoire"><div class="review-banner">üßê <strong>Mode R√©vision :</strong> Vous consultez vos r√©ponses. <button class="btn-link-review">Retour aux r√©sultats</button></div><div class="question-header"><div class="question-header-left"><div class="question-number">1</div><div class="question-category">üï∞Ô∏è Histoire</div></div><div class="nav-buttons"></div></div><h2 class="question-title" id="q1-title" tabindex="-1">Quel type d'√©clairage dominait les villes jusqu'au XIX√®me si√®cle ?</h2><div class="options" role="radiogroup" aria-labelledby="q1-title"><div class="option" data-answer="a" role="radio" aria-checked="false" tabindex="0"><span class="option-number">1</span>L'√©clairage √©lectrique</div><div class="option" data-answer="b" role="radio" aria-checked="false" tabindex="0"><span class="option-number">2</span>L'√©clairage au gaz</div><div class="option" data-answer="c" role="radio" aria-checked="false" tabindex="0"><span class="option-number">3</span>L'√©clairage solaire</div><div class="option" data-answer="d" role="radio" aria-checked="false" tabindex="0"><span class="option-number">4</span>L'√©clairage LED</div></div><div class="feedback" id="feedback1" tabindex="-1" aria-live="polite"><p class="feedback-title">R√©ponse : L'√©clairage au gaz</p><p class="feedback-explanation">Avant l'av√®nement de l'√©lectricit√©, le gaz de ville, produit par la distillation de la houille, √©tait la principale source d'√©clairage public.</p><div class="video-timestamp-hint">üé¨ <strong>Indice Vid√©o :</strong> le contexte d√©marre d√®s <button data-timestamp="170"><strong>02:50</strong></button>.</div><div class="context-box"><h4>üìö Contexte</h4><p>Paris fut l'une des premi√®res villes au monde √† adopter l'√©clairage public au gaz √† grande √©chelle vers 1820, lui valant son surnom de "Ville Lumi√®re".</p></div></div></div>
            
            <div class="question-card" data-question="2" data-category="Histoire"><div class="review-banner">üßê <strong>Mode R√©vision :</strong> Vous consultez vos r√©ponses. <button class="btn-link-review">Retour aux r√©sultats</button></div><div class="question-header"><div class="question-header-left"><div class="question-number">2</div><div class="question-category">üï∞Ô∏è Histoire</div></div><div class="nav-buttons"></div></div><h2 class="question-title" id="q2-title" tabindex="-1">Selon la vid√©o, √† partir de quelle ann√©e l'invention d'Edison commence-t-elle √† r√©volutionner l'√©clairage ?</h2><div class="options" role="radiogroup" aria-labelledby="q2-title"><div class="option" data-answer="a" role="radio" aria-checked="false" tabindex="0"><span class="option-number">1</span>1879</div><div class="option" data-answer="b" role="radio" aria-checked="false" tabindex="0"><span class="option-number">2</span>1881</div><div class="option" data-answer="c" role="radio" aria-checked="false" tabindex="0"><span class="option-number">3</span>1882</div><div class="option" data-answer="d" role="radio" aria-checked="false" tabindex="0"><span class="option-number">4</span>1890</div></div><div class="feedback" id="feedback2" tabindex="-1" aria-live="polite"><p class="feedback-title">R√©ponse : 1881</p><p class="feedback-explanation">Bonne r√©ponse ! La vid√©o mentionne bien "√† partir de 1881, tout va changer" gr√¢ce √† l'invention d'Edison.</p><div class="video-timestamp-hint">üé¨ <strong>Indice Vid√©o :</strong> le contexte d√©marre √† <button data-timestamp="188"><strong>03:08</strong></button> (date cit√©e √† 03:28).</div><details><summary>Pour aller plus loin (les dates cl√©s d'Edison)</summary><div class="details-content"><ul><li><strong>1879 :</strong> Invention et premi√®re d√©monstration publique de son ampoule √† incandescence durable √† Menlo Park (USA). C'est la date de l'invention.</li><li><strong>1881 :</strong> Pr√©sentation de son syst√®me √† l'Exposition Internationale d'√âlectricit√© de Paris, ce qui a popularis√© son invention en Europe.</li><li><strong>1882 :</strong> Mise en service du premier r√©seau de distribution √©lectrique commercial √† New York.</li></ul></div></details></div></div>
            
            <div class="question-card" data-question="3" data-category="Infrastructure"><div class="review-banner">üßê <strong>Mode R√©vision :</strong> Vous consultez vos r√©ponses. <button class="btn-link-review">Retour aux r√©sultats</button></div><div class="question-header"><div class="question-header-left"><div class="question-number">3</div><div class="question-category">üèóÔ∏è Infrastructure</div></div><div class="nav-buttons"></div></div><h2 class="question-title" id="q3-title" tabindex="-1">Combien de points lumineux pars√®ment Paris (chiffre de l'√©pisode) ?</h2><div class="options" role="radiogroup" aria-labelledby="q3-title"><div class="option" data-answer="a" role="radio" aria-checked="false" tabindex="0"><span class="option-number">1</span>50 000</div><div class="option" data-answer="b" role="radio" aria-checked="false" tabindex="0"><span class="option-number">2</span>100 000</div><div class="option" data-answer="c" role="radio" aria-checked="false" tabindex="0"><span class="option-number">3</span>150 000</div><div class="option" data-answer="d" role="radio" aria-checked="false" tabindex="0"><span class="option-number">4</span>200 000</div></div><div class="feedback" id="feedback3" tabindex="-1" aria-live="polite"><p class="feedback-title">R√©ponse : 150 000 points lumineux</p><p class="feedback-explanation">√Ä l'√©poque du tournage, Paris comptait ce nombre impressionnant de sources lumineuses pour assurer l'√©clairage de ses rues et monuments.</p><div class="video-timestamp-hint">üé¨ <strong>Indice Vid√©o :</strong> le contexte du d√©compte d√©marre √† <button data-timestamp="295"><strong>04:55</strong></button>.</div><div class="context-box"><h4>üîß Maintenance</h4><p><span class="tooltip" aria-describedby="tooltip-q3-paris">Paris<span class="tooltip-text" id="tooltip-q3-paris">Aujourd'hui, Paris g√®re environ 330 000 sources lumineuses, en grande partie des LED.</span></span> compte maintenant un parc bien plus vaste, converti en <span class="tooltip" aria-describedby="tooltip-q3-led">LED<span class="tooltip-text" id="tooltip-q3-led">Diode √âlectroluminescente.</span></span> et g√©r√© par des syst√®mes de t√©l√©gestion pour optimiser la consommation et la maintenance.</p></div></div></div>
            
            <div class="question-card" data-question="4" data-category="Technique"><div class="review-banner">üßê <strong>Mode R√©vision :</strong> Vous consultez vos r√©ponses. <button class="btn-link-review">Retour aux r√©sultats</button></div><div class="question-header"><div class="question-header-left"><div class="question-number">4</div><div class="question-category">üî¨ Technique</div></div><div class="nav-buttons"></div></div><h2 class="question-title" id="q4-title" tabindex="-1">Selon Jamy, comment une lampe √† incandescence produit-elle de la lumi√®re ?</h2><div class="options" role="radiogroup" aria-labelledby="q4-title"><div class="option" data-answer="a" role="radio" aria-checked="false" tabindex="0"><span class="option-number">1</span>Par combustion d'un gaz</div><div class="option" data-answer="b" role="radio" aria-checked="false" tabindex="0"><span class="option-number">2</span>En chauffant un filament jusqu'√† l'incandescence</div><div class="option" data-answer="c" role="radio" aria-checked="false" tabindex="0"><span class="option-number">3</span>Par d√©charge √©lectrique dans un tube</div><div class="option" data-answer="d" role="radio" aria-checked="false" tabindex="0"><span class="option-number">4</span>Par r√©action chimique</div></div><div class="feedback" id="feedback4" tabindex="-1" aria-live="polite"><p class="feedback-title">R√©ponse : En chauffant un filament jusqu'√† l'incandescence</p><p class="feedback-explanation">Le passage du courant √©lectrique dans un filament (souvent en tungst√®ne) le chauffe √† une temp√©rature si √©lev√©e qu'il √©met de la lumi√®re visible.</p><div class="video-timestamp-hint">üé¨ <strong>Indice Vid√©o :</strong> l'explication d√©bute √† <button data-timestamp="365"><strong>06:05</strong></button>.</div><details><summary>En savoir + sur l'inefficacit√©</summary><div class="details-content"><p>Ce proc√©d√© est tr√®s inefficace : <strong>plus de 90% de l'√©nergie est perdue sous forme de chaleur !</strong> C'est pourquoi ces ampoules sont tr√®s chaudes au toucher. En comparaison, une LED moderne convertit jusqu'√† 95% de son √©nergie en lumi√®re, ce qui explique sa faible consommation et pourquoi elle reste froide.</p></div></details></div></div>
            
            <div class="question-card" data-question="5" data-category="Technique"><div class="review-banner">üßê <strong>Mode R√©vision :</strong> Vous consultez vos r√©ponses. <button class="btn-link-review">Retour aux r√©sultats</button></div><div class="question-header"><div class="question-header-left"><div class="question-number">5</div><div class="question-category">üí° Ampoules</div></div><div class="nav-buttons"></div></div><h2 class="question-title" id="q5-title" tabindex="-1">Quelle est la diff√©rence principale entre une lampe classique et une lampe halog√®ne ?</h2><div class="options" role="radiogroup" aria-labelledby="q5-title"><div class="option" data-answer="a" role="radio" aria-checked="false" tabindex="0"><span class="option-number">1</span>La lampe halog√®ne a un filament diff√©rent</div><div class="option" data-answer="b" role="radio" aria-checked="false" tabindex="0"><span class="option-number">2</span>La lampe halog√®ne contient un gaz qui permet un filament plus chaud</div><div class="option" data-answer="c" role="radio" aria-checked="false" tabindex="0"><span class="option-number">3</span>La lampe halog√®ne fonctionne sans √©lectricit√©</div><div class="option" data-answer="d" role="radio" aria-checked="false" tabindex="0"><span class="option-number">4</span>La lampe halog√®ne est plus grosse</div></div><div class="feedback" id="feedback5" tabindex="-1" aria-live="polite"><p class="feedback-title">R√©ponse : La lampe halog√®ne contient un gaz</p><p class="feedback-explanation">L'ampoule contient un gaz halog√©n√© (iode ou brome) qui, par un cycle chimique, red√©pose le tungst√®ne √©vapor√© sur le filament. Cela permet au filament de chauffer plus, produisant une lumi√®re plus blanche et vive.</p><div class="video-timestamp-hint">üé¨ <strong>Indice Vid√©o :</strong> l'explication sur les halog√®nes commence √† <button data-timestamp="440"><strong>07:20</strong></button>.</div><details><summary>En savoir + sur le cycle halog√®ne</summary><div class="details-content"><p>Ce cycle a permis d'augmenter la dur√©e de vie (de 1000h √† 2000h) et l'efficacit√© des lampes √† incandescence. C'√©tait une am√©lioration importante, mais elles restent bien moins performantes que les lampes fluocompactes ou les LED qui les ont remplac√©es.</p></div></details></div></div>
            
            <div class="question-card" data-question="6" data-category="Technique"><div class="review-banner">üßê <strong>Mode R√©vision :</strong> Vous consultez vos r√©ponses. <button class="btn-link-review">Retour aux r√©sultats</button></div><div class="question-header"><div class="question-header-left"><div class="question-number">6</div><div class="question-category">‚ö° Lampes √† d√©charge</div></div><div class="nav-buttons"></div></div><h2 class="question-title" id="q6-title" tabindex="-1">Qu'est-ce qu'une lampe √† d√©charge selon les explications de Jamy ?</h2><div class="options" role="radiogroup" aria-labelledby="q6-title"><div class="option" data-answer="a" role="radio" aria-checked="false" tabindex="0"><span class="option-number">1</span>Une lampe qui se d√©charge comme une pile</div><div class="option" data-answer="b" role="radio" aria-checked="false" tabindex="0"><span class="option-number">2</span>Une lampe qui produit de la lumi√®re par d√©charge √©lectrique dans un gaz</div><div class="option" data-answer="c" role="radio" aria-checked="false" tabindex="0"><span class="option-number">3</span>Une lampe qui ne fonctionne que le jour</div><div class="option" data-answer="d" role="radio" aria-checked="false" tabindex="0"><span class="option-number">4</span>Une lampe sans filament</div></div><div class="feedback" id="feedback6" tabindex="-1" aria-live="polite"><p class="feedback-title">R√©ponse : Production de lumi√®re par d√©charge √©lectrique dans un gaz</p><p class="feedback-explanation">Contrairement √† l'incandescence, cette technologie n'utilise pas de filament chauff√©. Un arc √©lectrique est cr√©√© entre deux √©lectrodes, ce qui excite un gaz (sodium, mercure...) qui √©met alors de la lumi√®re.</p><div class="video-timestamp-hint">üé¨ <strong>Indice Vid√©o :</strong> le sujet des lampes √† d√©charge d√©bute √† <button data-timestamp="505"><strong>08:25</strong></button>.</div><div class="context-box"><h4>üöÄ Remplacement massif</h4><p>Les lampadaires √† la lumi√®re orange caract√©ristique (lampes √† sodium) sont un exemple typique de lampes √† d√©charge. Ils sont massivement remplac√©s par des LED plus efficaces et polyvalentes.</p></div></div></div>
            
            <div class="question-card" data-question="7" data-category="Environnement"><div class="review-banner">üßê <strong>Mode R√©vision :</strong> Vous consultez vos r√©ponses. <button class="btn-link-review">Retour aux r√©sultats</button></div><div class="question-header"><div class="question-header-left"><div class="question-number">7</div><div class="question-category">üåø Environnement</div></div><div class="nav-buttons"></div></div><h2 class="question-title" id="q7-title" tabindex="-1">Quel est l'un des d√©fis environnementaux majeurs de l'√©clairage urbain ?</h2><div class="options" role="radiogroup" aria-labelledby="q7-title"><div class="option" data-answer="a" role="radio" aria-checked="false" tabindex="0"><span class="option-number">1</span>Le manque de lumi√®re</div><div class="option" data-answer="b" role="radio" aria-checked="false" tabindex="0"><span class="option-number">2</span>La pollution lumineuse et son impact sur la faune nocturne</div><div class="option" data-answer="c" role="radio" aria-checked="false" tabindex="0"><span class="option-number">3</span>Le co√ªt trop faible</div><div class="option" data-answer="d" role="radio" aria-checked="false" tabindex="0"><span class="option-number">4</span>L'√©clairage trop color√©</div></div><div class="feedback" id="feedback7" tabindex="-1" aria-live="polite"><p class="feedback-title">R√©ponse : La pollution lumineuse</p><p class="feedback-explanation">L'√©clairage artificiel excessif ou mal dirig√© cr√©e un "halo lumineux" au-dessus des villes qui perturbe les √©cosyst√®mes, notamment les cycles de vie et de migration des animaux nocturnes (insectes, oiseaux, chauves-souris).</p><div class="video-timestamp-hint">üé¨ <strong>Indice Vid√©o :</strong> le sujet est abord√© d√®s <button data-timestamp="1010"><strong>16:50</strong></button>.</div><details><summary>En savoir + sur les couleurs (Kelvin)</summary><div class="details-content"><p>La "couleur" de la lumi√®re se mesure en <strong>Kelvin (K)</strong>. Une lumi√®re "chaude" (orange, ~2200K) contient peu de lumi√®re bleue et perturbe moins la faune. Une lumi√®re "froide" (blanche-bleut√©e, > 4000K) est riche en lumi√®re bleue et a un impact plus fort. Les villes privil√©gient donc des LED de <strong>moins de 3000K</strong> pour prot√©ger la biodiversit√©.</p></div></details></div></div>
            
            <div class="question-card" data-question="8" data-category="Environnement"><div class="review-banner">üßê <strong>Mode R√©vision :</strong> Vous consultez vos r√©ponses. <button class="btn-link-review">Retour aux r√©sultats</button></div><div class="question-header"><div class="question-header-left"><div class="question-number">8</div><div class="question-category">üí° √ânergie alternative</div></div><div class="nav-buttons"></div></div><h2 class="question-title" id="q8-title" tabindex="-1">Quelle innovation surprenante permet d'alimenter l'√©clairage de mani√®re √©cologique ?</h2><div class="options" role="radiogroup" aria-labelledby="q8-title"><div class="option" data-answer="a" role="radio" aria-checked="false" tabindex="0"><span class="option-number">1</span>Les batteries de sol utilisant les plantes</div><div class="option" data-answer="b" role="radio" aria-checked="false" tabindex="0"><span class="option-number">2</span>L'√©nergie du vent uniquement</div><div class="option" data-answer="c" role="radio" aria-checked="false" tabindex="0"><span class="option-number">3</span>Les hamsters dans des roues</div><div class="option" data-answer="d" role="radio" aria-checked="false" tabindex="0"><span class="option-number">4</span>L'√©nergie des voitures qui passent</div></div><div class="feedback" id="feedback8" tabindex="-1" aria-live="polite"><p class="feedback-title">R√©ponse : Les batteries de sol utilisant les plantes</p><p class="feedback-explanation">Des startups d√©veloppent des technologies qui exploitent les micro-organismes pr√©sents dans le sol autour des racines des plantes. Ces microbes d√©gradent la mati√®re organique et lib√®rent des √©lectrons, cr√©ant un courant √©lectrique.</p><div class="context-box"><h4>üß¨ Biotechnologies</h4><p>Bien qu'encore exp√©rimentale et √† faible rendement, cette approche bio-inspir√©e montre une voie fascinante pour une √©nergie d√©centralis√©e et int√©gr√©e √† l'environnement urbain.</p></div></div></div>
            
            <div class="question-card" data-question="9" data-category="Smart City"><div class="review-banner">üßê <strong>Mode R√©vision :</strong> Vous consultez vos r√©ponses. <button class="btn-link-review">Retour aux r√©sultats</button></div><div class="question-header"><div class="question-header-left"><div class="question-number">9</div><div class="question-category">üèôÔ∏è Smart Cities <span class="modern-topic-tag tooltip no-underline" aria-describedby="tooltip-q9">*<span id="tooltip-q9" role="tooltip" class="tooltip-text">Cette question aborde un sujet moderne non couvert en d√©tail par la vid√©o de r√©f√©rence.</span></span></div></div><div class="nav-buttons"></div></div><h2 class="question-title" id="q9-title" tabindex="-1">Dans une "ville intelligente", un lampadaire peut maintenant servir √† :</h2><div class="options" role="radiogroup" aria-labelledby="q9-title"><div class="option" data-answer="a" role="radio" aria-checked="false" tabindex="0"><span class="option-number">1</span>Seulement √©clairer les rues</div><div class="option" data-answer="b" role="radio" aria-checked="false" tabindex="0"><span class="option-number">2</span>Mesurer la qualit√© de l'air, fournir du Wi-Fi et diffuser des infos</div><div class="option" data-answer="c" role="radio" aria-checked="false" tabindex="0"><span class="option-number">3</span>Uniquement d√©corer la ville</div><div class="option" data-answer="d" role="radio" aria-checked="false" tabindex="0"><span class="option-number">4</span>Remplacer les feux de circulation</div></div><div class="feedback" id="feedback9" tabindex="-1" aria-live="polite"><p class="feedback-title">R√©ponse : Mesurer la qualit√© de l'air, fournir du Wi-Fi...</p><p class="feedback-explanation">Le lampadaire, d√©j√† aliment√© et pr√©sent partout en ville, est devenu le support id√©al pour une multitude de capteurs et services connect√©s.</p><details><summary>En savoir + sur le Li-Fi</summary><div class="details-content"><p>Certains lampadaires peuvent m√™me transmettre des donn√©es via la lumi√®re elle-m√™me ! C'est la technologie <strong>Li-Fi (Light Fidelity)</strong>. En modulant l'intensit√© de la lumi√®re √† une fr√©quence imperceptible pour l'≈ìil humain, on peut cr√©er une connexion internet tr√®s rapide et s√©curis√©e, compl√©mentaire au Wi-Fi.</p></div></details></div></div>
            
            <div class="question-card" data-question="10" data-category="√âconomie"><div class="review-banner">üßê <strong>Mode R√©vision :</strong> Vous consultez vos r√©ponses. <button class="btn-link-review">Retour aux r√©sultats</button></div><div class="question-header"><div class="question-header-left"><div class="question-number">10</div><div class="question-category">üí∞ √âconomies</div></div><div class="nav-buttons"></div></div><h2 class="question-title" id="q10-title" tabindex="-1">Quelle √©conomie d'√©nergie peut r√©aliser une ville en passant √† l'√©clairage <span class="tooltip" aria-describedby="tooltip-q10">LED<span class="tooltip-text" id="tooltip-q10">Diode √âlectroluminescente.</span></span> intelligent ?</h2><div class="options" role="radiogroup" aria-labelledby="q10-title"><div class="option" data-answer="a" role="radio" aria-checked="false" tabindex="0"><span class="option-number">1</span>10 √† 20%</div><div class="option" data-answer="b" role="radio" aria-checked="false" tabindex="0"><span class="option-number">2</span>30 √† 40%</div><div class="option" data-answer="c" role="radio" aria-checked="false" tabindex="0"><span class="option-number">3</span>50 √† 75%</div><div class="option" data-answer="d" role="radio" aria-checked="false" tabindex="0"><span class="option-number">4</span>90 √† 100%</div></div><div class="feedback" id="feedback10" tabindex="-1" aria-live="polite"><p class="feedback-title">R√©ponse : 50 √† 75%</p><p class="feedback-explanation">La combinaison de la haute efficacit√© des LED (par rapport aux anciennes lampes) et des syst√®mes de gestion intelligents (qui modulent l'intensit√© lumineuse selon les besoins) permet de r√©aliser des √©conomies d'√©nergie tr√®s significatives.</p><div class="context-box"><h4>üìà Retour sur investissement</h4><p>Malgr√© un co√ªt d'installation √©lev√©, le retour sur investissement est rapide (souvent entre 3 et 7 ans) gr√¢ce aux √©conomies sur la facture d'√©lectricit√© et la r√©duction des co√ªts de maintenance.</p></div></div></div>
            
            <div class="question-card" data-question="11" data-category="Technique"><div class="review-banner">üßê <strong>Mode R√©vision :</strong> Vous consultez vos r√©ponses. <button class="btn-link-review">Retour aux r√©sultats</button></div><div class="question-header"><div class="question-header-left"><div class="question-number">11</div><div class="question-category">üõ∞Ô∏è Innovations <span class="modern-topic-tag tooltip no-underline" aria-describedby="tooltip-q11">*<span id="tooltip-q11" role="tooltip" class="tooltip-text">Cette question aborde un sujet moderne non couvert en d√©tail par la vid√©o de r√©f√©rence.</span></span></div></div><div class="nav-buttons"></div></div><h2 class="question-title" id="q11-title" tabindex="-1">Quelle technologie de d√©tection am√©liore la pr√©cision de l'√©clairage adaptatif ?</h2><div class="options" role="radiogroup" aria-labelledby="q11-title"><div class="option" data-answer="a" role="radio" aria-checked="false" tabindex="0"><span class="option-number">1</span>Les capteurs infrarouges classiques</div><div class="option" data-answer="b" role="radio" aria-checked="false" tabindex="0"><span class="option-number">2</span>Les radars √† ondes millim√©triques</div><div class="option" data-answer="c" role="radio" aria-checked="false" tabindex="0"><span class="option-number">3</span>Les cam√©ras simples</div><div class="option" data-answer="d" role="radio" aria-checked="false" tabindex="0"><span class="option-number">4</span>Les capteurs de temp√©rature</div></div><div class="feedback" id="feedback11" tabindex="-1" aria-live="polite"><p class="feedback-title">R√©ponse : Les radars √† ondes millim√©triques</p><p class="feedback-explanation">Ces radars avanc√©s sont beaucoup plus pr√©cis que les capteurs infrarouges. Ils peuvent d√©tecter la pr√©sence, la vitesse et la direction des pi√©tons ou des v√©hicules, m√™me dans de mauvaines conditions m√©t√©orologiques.</p><details><summary>En savoir + : Radar vs Infrarouge (PIR)</summary><div class="details-content"><p>Un capteur <strong>infrarouge passif (PIR)</strong> d√©tecte les changements de chaleur. Il peut √™tre tromp√© par temps chaud ou ne pas d√©tecter une personne immobile. Un <strong>radar</strong> envoie des ondes et analyse leur √©cho. Il d√©tecte donc le moindre mouvement et la position exacte, quelle que soit la temp√©rature, ce qui le rend beaucoup plus fiable.</p></div></details></div></div>

            <div class="question-card" data-question="12" data-category="Synth√®se"><div class="review-banner">üßê <strong>Mode R√©vision :</strong> Vous consultez vos r√©ponses. <button class="btn-link-review">Retour aux r√©sultats</button></div><div class="question-header"><div class="question-header-left"><div class="question-number">12</div><div class="question-category">üéØ Synth√®se <span class="modern-topic-tag tooltip no-underline" aria-describedby="tooltip-q12">*<span id="tooltip-q12" role="tooltip" class="tooltip-text">Cette question aborde un sujet moderne non couvert en d√©tail par la vid√©o de r√©f√©rence.</span></span></div></div><div class="nav-buttons"></div></div><h2 class="question-title" id="q12-title" tabindex="-1">Quel est le d√©fi principal pour l'avenir de l'√©clairage urbain ?</h2><div class="options" role="radiogroup" aria-labelledby="q12-title"><div class="option" data-answer="a" role="radio" aria-checked="false" tabindex="0"><span class="option-number">1</span>√âclairer plus fort partout</div><div class="option" data-answer="b" role="radio" aria-checked="false" tabindex="0"><span class="option-number">2</span>Concilier efficacit√© √©nerg√©tique, biodiversit√© et services connect√©s</div><div class="option" data-answer="c" role="radio" aria-checked="false" tabindex="0"><span class="option-number">3</span>Revenir √† l'√©clairage au gaz</div><div class="option" data-answer="d" role="radio" aria-checked="false" tabindex="0"><span class="option-number">4</span>Supprimer tout √©clairage public</div></div><div class="feedback" id="feedback12" tabindex="-1" aria-live="polite"><p class="feedback-title">R√©ponse : Concilier efficacit√©, biodiversit√© et services</p><p class="feedback-explanation">L'√©clairage de demain doit √™tre un compromis intelligent : il doit consommer le moins possible, tout en assurant la s√©curit√© des citoyens, en offrant de nouveaux services et en minimisant son impact sur l'environnement nocturne.</p><div class="context-box"><h4>üîÆ Perspective 2030</h4><p>L'avenir s'oriente vers des r√©seaux d'√©clairage enti√®rement autonomes et auto-adaptatifs, qui ajustent en temps r√©el la couleur et l'intensit√© de la lumi√®re en fonction de donn√©es multiples (m√©t√©o, trafic, √©v√©nements, cycles de la faune...).</p></div></div></div>
            
            <div class="question-card" data-question="13" data-category="Calcul"><div class="review-banner">üßê <strong>Mode R√©vision :</strong> Vous consultez vos r√©ponses. <button class="btn-link-review">Retour aux r√©sultats</button></div><div class="question-header"><div class="question-header-left"><div class="question-number">13</div><div class="question-category">üßÆ Calcul</div></div><div class="nav-buttons"></div></div><h2 class="question-title" id="q13-title" tabindex="-1">Une lampe LED de 15W produit 1500 <span class="tooltip" aria-describedby="tooltip-q13">lumens<span class="tooltip-text" id="tooltip-q13">Unit√© de mesure de la quantit√© totale de lumi√®re visible √©mise par une source.</span></span>. Quelle est son efficacit√© lumineuse (en lm/W) ?</h2><div class="options" role="radiogroup" aria-labelledby="q13-title"><div class="option" data-answer="a" role="radio" aria-checked="false" tabindex="0"><span class="option-number">1</span>75 lm/W</div><div class="option" data-answer="b" role="radio" aria-checked="false" tabindex="0"><span class="option-number">2</span>90 lm/W</div><div class="option" data-answer="c" role="radio" aria-checked="false" tabindex="0"><span class="option-number">3</span>100 lm/W</div><div class="option" data-answer="d" role="radio" aria-checked="false" tabindex="0"><span class="option-number">4</span>120 lm/W</div></div><div class="feedback" id="feedback13" tabindex="-1" aria-live="polite"><p class="feedback-title">R√©ponse : 100 lm/W</p><p class="feedback-explanation">L'efficacit√© lumineuse se calcule en divisant le flux lumineux (lumens) par la puissance consomm√©e (Watts).</p><div class="calculation-breakdown">Calcul : 1500 lumens / 15 Watts = <strong>100 lm/W</strong></div><div class="context-box"><h4>üí° Rappel</h4><p><strong>Efficacit√© (lm/W) = Flux lumineux (lm) √∑ Puissance (W)</strong>. Plus ce chiffre est √©lev√©, plus la lampe convertit efficacement l'√©lectricit√© en lumi√®re.</p></div></div></div>
            <div class="question-card" data-question="14" data-category="Calcul"><div class="review-banner">üßê <strong>Mode R√©vision :</strong> Vous consultez vos r√©ponses. <button class="btn-link-review">Retour aux r√©sultats</button></div><div class="question-header"><div class="question-header-left"><div class="question-number">14</div><div class="question-category">üîß Maintenance</div></div><div class="nav-buttons"></div></div><h2 class="question-title" id="q14-title" tabindex="-1">Combien de lampes classiques (2000h) faut-il pour la dur√©e de vie d'une seule LED (50000h) ?</h2><div class="options" role="radiogroup" aria-labelledby="q14-title"><div class="option" data-answer="a" role="radio" aria-checked="false" tabindex="0"><span class="option-number">1</span>15 fois</div><div class="option" data-answer="b" role="radio" aria-checked="false" tabindex="0"><span class="option-number">2</span>25 fois</div><div class="option" data-answer="c" role="radio" aria-checked="false" tabindex="0"><span class="option-number">3</span>30 fois</div><div class="option" data-answer="d" role="radio" aria-checked="false" tabindex="0"><span class="option-number">4</span>35 fois</div></div><div class="feedback" id="feedback14" tabindex="-1" aria-live="polite"><p class="feedback-title">R√©ponse : 25 fois</p><p class="feedback-explanation">On divise la dur√©e de vie de la LED par celle de la lampe classique.</p> <div class="calculation-breakdown">Calcul : 50 000 heures / 2 000 heures = <strong>25</strong></div><div class="context-box"><h4>üå± Impact</h4><p>Cette long√©vit√© exceptionnelle r√©duit drastiquement les co√ªts de main-d'≈ìuvre pour le remplacement des ampoules, ainsi que la quantit√© de d√©chets g√©n√©r√©s.</p></div></div></div>
            <div class="question-card" data-question="15" data-category="Calcul"><div class="review-banner">üßê <strong>Mode R√©vision :</strong> Vous consultez vos r√©ponses. <button class="btn-link-review">Retour aux r√©sultats</button></div><div class="question-header"><div class="question-header-left"><div class="question-number">15</div><div class="question-category">üßÆ Calcul</div></div><div class="nav-buttons"></div></div><h2 class="question-title" id="q15-title" tabindex="-1">Une LED de 10W remplace une lampe √† incandescence de 60W. Quel est le % d'√©conomie ?</h2><div class="options" role="radiogroup" aria-labelledby="q15-title"><div class="option" data-answer="a" role="radio" aria-checked="false" tabindex="0"><span class="option-number">1</span>Environ 83%</div><div class="option" data-answer="b" role="radio" aria-checked="false" tabindex="0"><span class="option-number">2</span>Environ 75%</div><div class="option" data-answer="c" role="radio" aria-checked="false" tabindex="0"><span class="option-number">3</span>Environ 50%</div><div class="option" data-answer="d" role="radio" aria-checked="false" tabindex="0"><span class="option-number">4</span>Environ 90%</div></div><div class="feedback" id="feedback15" tabindex="-1" aria-live="polite"><p class="feedback-title">R√©ponse : Environ 83%</p><p class="feedback-explanation">L'√©conomie est de 60W - 10W = 50W. Pour trouver le pourcentage, on divise l'√©conomie par la consommation initiale.</p> <div class="calculation-breakdown">Calcul : ((60W - 10W) / 60W) √ó 100 ‚âà <strong>83.3%</strong></div><div class="context-box"><h4>üî¢ M√©thode</h4><p><strong>% √©conomie = ( (Consommation initiale - Nouvelle consommation) / Consommation initiale ) √ó 100</strong></p></div></div></div>
            <div class="question-card" data-question="16" data-category="Histoire"><div class="review-banner">üßê <strong>Mode R√©vision :</strong> Vous consultez vos r√©ponses. <button class="btn-link-review">Retour aux r√©sultats</button></div><div class="question-header"><div class="question-header-left"><div class="question-number">16</div><div class="question-category">üï∞Ô∏è Histoire Interactive</div></div><div class="nav-buttons"></div></div><h2 class="question-title" id="q16-title" tabindex="-1">Organisez l'histoire ! Glissez-d√©posez chaque innovation sur la bonne p√©riode.</h2><div class="interactive-question-container timeline-container" id="q16-container"><div class="timeline-events" id="q16-events"><div class="draggable-item" draggable="true" data-id="led">Invention de la LED</div><div class="draggable-item" draggable="true" data-id="gaz">G√©n√©ralisation de l'√©clairage au gaz</div><div class="draggable-item" draggable="true" data-id="edison">Invention de l'ampoule √† incandescence</div><div class="draggable-item" draggable="true" data-id="smart">√àre des Smart-Cities et du <span class="tooltip" aria-describedby="tooltip-q16">Li-Fi<span class="tooltip-text" id="tooltip-q16">Light Fidelity. Technologie de communication sans fil bas√©e sur l'utilisation de la lumi√®re (LED).</span></span></div></div><div class="timeline-slots"><div class="timeline-slot"><div class="timeline-year">D√©but 19e s.</div><div class="dropzone" data-target="gaz"></div></div><div class="timeline-slot"><div class="timeline-year">Fin 19e s.</div><div class="dropzone" data-target="edison"></div></div><div class="timeline-slot"><div class="timeline-year">Milieu 20e s.</div><div class="dropzone" data-target="led"></div></div><div class="timeline-slot"><div class="timeline-year">Ann√©es 2020</div><div class="dropzone" data-target="smart"></div></div></div></div><button class="btn btn-secondary btn-autocomplete">üí° Compl√©ter pour moi</button><div class="feedback" id="feedback16" tabindex="-1" aria-live="polite"><p class="feedback-title">Chronologie de l'√©clairage</p><p class="feedback-explanation">L'ordre correct est : √âclairage au gaz (d√©but 19e), Ampoule d'Edison (fin 19e), Invention de la LED (milieu 20e, mais g√©n√©ralisation bien plus tardive), et enfin l'√®re des Smart Cities (r√©cente).</p></div></div>
            <div class="question-card" data-question="17" data-category="Smart City"><div class="review-banner">üßê <strong>Mode R√©vision :</strong> Vous consultez vos r√©ponses. <button class="btn-link-review">Retour aux r√©sultats</button></div><div class="question-header"><div class="question-header-left"><div class="question-number">17</div><div class="question-category">üèôÔ∏è Smart City en pratique <span class="modern-topic-tag tooltip no-underline" aria-describedby="tooltip-q17">*<span id="tooltip-q17" role="tooltip" class="tooltip-text">Cette question aborde un sujet moderne non couvert en d√©tail par la vid√©o de r√©f√©rence.</span></span></div></div><div class="nav-buttons"></div></div><h2 class="question-title" id="q17-title" tabindex="-1">Construisez un lampadaire intelligent ! S√©lectionnez au moins 4 fonctionnalit√©s.</h2><div class="smart-lamppost-builder" id="q17-builder"><div class="feature-option" data-id="wifi" role="button" tabindex="0" title="Diffuse un signal Wi-Fi ou 5G pour connecter les passants."><div class="feature-icon">üì°</div><div>Hotspot Wi-Fi / 5G</div></div><div class="feature-option" data-id="air" role="button" tabindex="0" title="Mesure les polluants (particules fines, NOx...) en temps r√©el."><div class="feature-icon">üå¨Ô∏è</div><div>Capteur de qualit√© de l'air</div></div><div class="feature-option" data-id="charge" role="button" tabindex="0" title="Permet de recharger les voitures, scooters ou v√©los √©lectriques."><div class="feature-icon">üîå</div><div>Borne de recharge v√©hicule</div></div><div class="feature-option" data-id="camera" role="button" tabindex="0" title="Assure la s√©curit√© et peut analyser les flux de pi√©tons/v√©hicules."><div class="feature-icon">üìπ</div><div>Cam√©ra de s√©curit√© IA</div></div><div class="feature-option" data-id="speaker" role="button" tabindex="0" title="Diffuse des annonces d'urgence (alerte m√©t√©o, s√©curit√©...)."><div class="feature-icon">üì¢</div><div>Haut-parleur d'alerte</div></div><div class="feature-option" data-id="parking" role="button" tabindex="0" title="D√©tecte si une place de stationnement √† proximit√© est libre ou occup√©e."><div class="feature-icon">üÖøÔ∏è</div><div>D√©tection de place de parking</div></div></div><div class="feedback" id="feedback17" tabindex="-1" aria-live="polite"><div class="feedback-correct"><p class="feedback-title">Lampadaire Intelligent assembl√© !</p><p class="feedback-explanation">Votre s√©lection montre que vous avez bien compris comment un simple point lumineux peut devenir un "couteau suisse" technologique au service de la ville.</p><div id="q17-description-box" class="context-box"><h4>Votre lampadaire intelligent inclut :</h4><ul id="q17-description-list"></ul></div></div><div class="feedback-incorrect"><p><strong>S√©lectionnez au moins 4 fonctionnalit√©s</strong> pour cr√©er un lampadaire vraiment "intelligent" !</p></div></div></div>
            
            <div class="question-card" data-question="18" data-category="Technique">
                <div class="review-banner">üßê <strong>Mode R√©vision :</strong> Vous consultez vos r√©ponses. <button class="btn-link-review">Retour aux r√©sultats</button></div>
                <div class="question-header"><div class="question-header-left"><div class="question-number">18</div><div class="question-category">üìä Classement <span class="modern-topic-tag tooltip no-underline" aria-describedby="tooltip-q18">*<span id="tooltip-q18" role="tooltip" class="tooltip-text">Cette question aborde un sujet moderne non couvert en d√©tail par la vid√©o de r√©f√©rence.</span></span></div></div><div class="nav-buttons"></div></div>
                <h2 class="question-title" id="q18-title" tabindex="-1">Classez ces technologies de la <strong>plus efficace</strong> √† la <strong>moins efficace</strong>.</h2>
                <div class="interactive-question-container ranking-container" id="q18-container">
                    <div class="ranking-source dropzone" id="q18-source">
                        <div class="draggable-item" draggable="true" data-id="led">üí° LED</div>
                        <div class="draggable-item" draggable="true" data-id="incandescent">üí° Incandescence</div>
                        <div class="draggable-item" draggable="true" data-id="sodium">üí° Lampe √† Sodium</div>
                    </div>
                    <div class="ranking-slots">
                        <div class="ranking-slot">
                            <span class="rank-label">Plus efficace :</span>
                            <div class="dropzone" data-rank="1"></div>
                        </div>
                        <div class="ranking-slot">
                            <span class="rank-label">Interm√©diaire :</span>
                            <div class="dropzone" data-rank="2"></div>
                        </div>
                        <div class="ranking-slot">
                            <span class="rank-label">Moins efficace :</span>
                            <div class="dropzone" data-rank="3"></div>
                        </div>
                    </div>
                </div>
                <button class="btn btn-secondary btn-autocomplete">üí° Compl√©ter pour moi</button>
                <div class="feedback" id="feedback18" tabindex="-1" aria-live="polite">
                    <p class="feedback-title">Classement de l'efficacit√©</p>
                    <p class="feedback-explanation">L'ordre correct est bas√© sur le rendement lumineux (lumens par Watt) :</p>
                    <ol style="list-style-position: inside; padding-left: 10px;">
                        <li><strong>LED :</strong> Tr√®s efficace (100-170 lm/W).</li>
                        <li><strong>Lampe √† Sodium :</strong> Assez efficace mais avec un mauvais rendu des couleurs (80-140 lm/W).</li>
                        <li><strong>Incandescence :</strong> Tr√®s inefficace, la majorit√© de l'√©nergie est perdue en chaleur (10-17 lm/W).</li>
                    </ol>
                </div>
            </div>

            <div class="question-card" data-question="19" data-category="Environnement"><div class="review-banner">üßê <strong>Mode R√©vision :</strong> Vous consultez vos r√©ponses. <button class="btn-link-review">Retour aux r√©sultats</button></div><div class="question-header"><div class="question-header-left"><div class="question-number">19</div><div class="question-category">ü§î Mythe ou R√©alit√© <span class="modern-topic-tag tooltip no-underline" aria-describedby="tooltip-q19">*<span id="tooltip-q19" role="tooltip" class="tooltip-text">Cette question aborde un sujet moderne non couvert en d√©tail par la vid√©o de r√©f√©rence.</span></span></div></div><div class="nav-buttons"></div></div><h2 class="question-title" id="q19-title" tabindex="-1">Affirmation : "Gr√¢ce √† leur faible consommation, les √©clairages LED blancs modernes ont toujours un impact environnemental plus faible que les anciennes lampes oranges."</h2><div class="options" role="radiogroup" aria-labelledby="q19-title"><div class="option" data-answer="a" role="radio" aria-checked="false" tabindex="0"><span class="option-number">1</span>Vrai</div><div class="option" data-answer="b" role="radio" aria-checked="false" tabindex="0"><span class="option-number">2</span>Faux</div></div><div class="feedback" id="feedback19" tabindex="-1" aria-live="polite"><p class="feedback-title">R√©ponse : Faux</p><p class="feedback-explanation">Bien que plus efficaces √©nerg√©tiquement, les LED blanches froides (riches en lumi√®re bleue) peuvent perturber davantage la faune nocturne et le rythme circadien humain que la lumi√®re orange des anciennes lampes.</p><div class="context-box"><h4>üî¨ √ânergie vs. Biodiversit√©</h4><p>C'est un compromis : l'impact environnemental n'est pas qu'√©nerg√©tique. De plus en plus de villes optent pour des LED √† teinte chaude (ambr√©es, < 3000K) pour un meilleur √©quilibre.</p></div></div></div>
            <div class="question-card" data-question="20" data-category="Technique"><div class="review-banner">üßê <strong>Mode R√©vision :</strong> Vous consultez vos r√©ponses. <button class="btn-link-review">Retour aux r√©sultats</button></div><div class="question-header"><div class="question-header-left"><div class="question-number">20</div><div class="question-category">üîÄ Tri Interactif <span class="modern-topic-tag tooltip no-underline" aria-describedby="tooltip-q20">*<span id="tooltip-q20" role="tooltip" class="tooltip-text">Cette question aborde un sujet moderne non couvert en d√©tail par la vid√©o de r√©f√©rence.</span></span></div></div><div class="nav-buttons"></div></div><h2 class="question-title" id="q20-title" tabindex="-1">Triez les caract√©ristiques : glissez chaque √©tiquette dans la bonne cat√©gorie.</h2><div class="interactive-question-container sorting-container" id="q20-container"><div class="sorting-source-list dropzone" id="q20-source"><div class="draggable-item" draggable="true" data-category="led">Tr√®s longue dur√©e de vie (> 50 000h)</div><div class="draggable-item" draggable="true" data-category="old">Contient du mercure (polluant)</div><div class="draggable-item" draggable="true" data-category="led">Allumage instantan√©</div><div class="draggable-item" draggable="true" data-category="old">Long temps de pr√©chauffage</div><div class="draggable-item" draggable="true" data-category="led">Excellente efficacit√© √©nerg√©tique</div><div class="draggable-item" draggable="true" data-category="old">Lumi√®re monochromatique (orange)</div></div><div class="sorting-bins"><div class="sorting-bin"><h4>üí° LED Moderne</h4><div class="dropzone" data-target="led"></div></div><div class="sorting-bin"><h4>üèÆ Ancienne Lampe √† D√©charge (Sodium)</h4><div class="dropzone" data-target="old"></div></div></div></div><button class="btn btn-secondary btn-autocomplete">üí° Compl√©ter pour moi</button><div class="feedback" id="feedback20" tabindex="-1" aria-live="polite"><p class="feedback-title">Distinction des technologies</p><p class="feedback-explanation">Vous avez tri√© les caract√©ristiques des deux g√©n√©rations d'√©clairage. Les LED se distinguent par leur efficacit√©, leur long√©vit√© et leur flexibilit√©, tandis que les lampes √† d√©charge avaient des contraintes comme le temps de chauffe et la pr√©sence de mat√©riaux polluants.</p></div></div>
            </div>
        </div>

        <div class="results" id="results">
            <div id="confetti-container"></div>
            <div id="finalTimeWidget" class="results-stat-widget">
                 <span class="timer-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M15 1H9v2h6V1zm-4 13h2V8h-2v6zm8.03-6.61l1.42-1.42c-.43-.51-.9-.99-1.41-1.41l-1.42 1.42C16.07 4.74 14.12 4 12 4c-4.97 0-9 4.03-9 9s4.03 9 9 9 9-4.03 9-9c0-2.12-.74-4.07-1.97-5.61zM12 20c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"/></svg>
                </span>
                <strong></strong>
            </div>
            <div id="attemptCounterWidget" class="results-stat-widget">
                <span>Essai n¬∞</span>
                <strong></strong>
            </div>
            <h2 id="results-title" tabindex="-1">üéâ F√©licitations ! Questionnaire termin√©</h2>
            <div class="score-circle" id="scoreCircle"><span id="scoreDisplay">0/20</span></div>
            <h3 class="score-title" id="scoreMessage">Votre titre</h3>
            <p id="scoreDescription">Description de votre performance</p>

            <div class="badges-earned-container" id="badgesEarnedContainer"><h4>üèÜ Tableau des Badges</h4><div id="badges-earned"></div></div>
            
            <div class="category-performance" id="categoryPerformanceContainer" style="display: none;">
                <h4 class="category-performance-title">Bilan par Cat√©gorie</h4>
                <div id="category-performance-list"></div>
            </div>
            
            <p id="personalizedFeedback"></p>

            <div class="key-takeaways">
                <h4>‚ú® Ce qu'il faut retenir</h4>
                <ul>
                    <li>L'√©clairage a connu une √©volution majeure : du gaz aux <strong>LED</strong>, qui dominent aujourd'hui par leur efficacit√©, leur dur√©e de vie et leur flexibilit√© (couleur, intensit√©).</li>
                    <li>Le lampadaire moderne est devenu une <strong>plateforme de services</strong> pour la "Smart City" (Wi-Fi, capteurs, s√©curit√©...).</li>
                    <li>L'enjeu actuel est de trouver un √©quilibre entre <strong>efficacit√© √©nerg√©tique</strong>, <strong>s√©curit√© des citoyens</strong> et <strong>protection de la biodiversit√©</strong> contre la pollution lumineuse.</li>
                </ul>
            </div>
            
            <details class="results-accordion">
                <summary>R√©capitulatif de vos r√©ponses</summary>
                <div class="results-summary">
                    <div class="summary-header">
                        <h4>D√©tail de vos r√©ponses</h4>
                        <div class="summary-filters">
                            <button class="active" data-filter="all">Toutes</button>
                            <button data-filter="correct">Succ√®s</button>
                            <button data-filter="incorrect">Erreurs</button>
                        </div>
                    </div>
                    <div id="summaryContent"></div>
                </div>
            </details>

            <div class="results-actions">
                <button class="btn btn-secondary" id="homeResultsBtn">üè† Accueil</button>
                <button class="btn btn-secondary" id="resultsReviewBtn">üßê Revoir toutes mes r√©ponses</button>
                <button class="btn btn-primary" id="reviewErrorsBtn">üßê Revoir mes erreurs</button>
                <button class="btn btn-secondary" id="resultsRestartBtn">üîÑ Recommencer</button>
            </div>
            <footer id="resultsFooter">R√©alis√© par David Trafial</footer>
        </div>
    </div>
    
    <div class="video-container floating-widget minimized" id="videoWidget">
        <div class="video-header" id="videoHeader">
            <span class="dynamic-icon" id="videoStatusIcon">üé¨</span>
            <span class="video-title">Vid√©o C'est Pas Sorcier</span>
            <div class="video-controls">
                <button id="minimizeBtn" aria-label="Minimiser la vid√©o"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/></svg></button>
            </div>
        </div>
        <div class="video-content">
             <div class="video-player-container" id="videoPlayerContainer">
                <div class="video-thumbnail-overlay">
                    <div class="video-thumbnail-text">
                        <p class="video-thumbnail-subtitle">Ressource Vid√©o</p>
                        <h4 class="video-thumbnail-title">Lumi√®res de la ville</h4>
                    </div>
                </div>
                <div class="video-play-button">
                    <svg viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z"></path></svg>
                </div>
            </div>
        </div>
    </div>
    
    <div class="modal-overlay" id="statsModalOverlay">
        <div class="stats-modal">
            <button class="modal-close-btn" id="modalCloseBtn" aria-label="Fermer les statistiques">‚úñ</button>
            <h3>üìä Vos Statistiques de Performance</h3>
            <div class="stats-grid performance-grid">
                <div class="stat-item"><h4>Pr√©cision</h4><p id="statsAccuracy">--%</p></div>
                <div class="stat-item"><h4>R√©pondues</h4><p id="statsAnswered">0 / 20</p></div>
                <div class="stat-item"><h4>S√©rie en Cours</h4><p id="statsCurrentStreak">0</p></div>
                <div class="stat-item"><h4>Meilleure S√©rie</h4><p id="statsBestStreak">0</p></div>
                <div class="stat-item"><h4>Temps Total</h4><p id="statsTime">00:00</p></div>
                <div class="stat-item"><h4>Moy. / Q.</h4><p id="statsAvgTime">-- s</p></div>
            </div>
            <div class="stats-grid" style="grid-template-columns: 1fr; margin-top: 0;">
                 <div class="stat-item"><h4>R√©ponse la plus Rapide</h4><p id="statsFastestQ">--</p></div>
            </div>
            <h3>üèÜ Vos Badges</h3>
            <div class="badges-grid" id="modalBadgesGrid">
                <!-- Badges will be dynamically inserted here by JS -->
            </div>
        </div>
    </div>
    
    <div id="toast-container"></div>

    <script src="https://www.youtube.com/iframe_api"></script>
    <script>
    // Self-executing anonymous function to encapsulate the script
    (function() {
    'use strict';
    
    // --- State & Constants ---
    let currentQuestion = 1; let score = 0; let totalQuestions; let answers = []; let isAnswered = []; let q17_selections = [];
    let videoPlayer; let isYouTubeApiReady = false; let youtubeApiQueue = []; let timerInterval; let secondsElapsed = 0; 
    let currentStreak = 0; let bestStreak = 0;
    let questionTimestamps = []; let fastestAnswer = { time: Infinity, qNum: null };
    let isReviewing = false; let reviewingErrorsOnly = false; let errorIndices = [];
    let attemptCount = 0;
    let badges = { history: false, smartcity: false, calculator: false, expert: false, streak: false, perfect: false, curious: false, sprinter: false };
    let curiosityTracker = { videoClicked: false, statsOpened: false, hintHovered: false };
    let draggedItem = null;
    
    const quizSaveKey = 'urbanLightingQuiz_vFinal_65'; // Incremented version key
    const themeStorageKey = 'urbanLightingTheme_v1';
    const attemptCountKey = 'urbanLightingQuiz_attempts_v1';
    const badgeStorageKey = 'urbanLightingQuiz_badges_v1';
    
    const Q_TIMELINE = 16;
    const Q_LAMP_BUILDER = 17;
    const Q_RANKING = 18;
    const Q_SORTING = 20;
    const INTERACTIVE_QUESTIONS = [Q_TIMELINE, Q_LAMP_BUILDER, Q_RANKING, Q_SORTING];

    const correctAnswers = { 1: 'b', 2: 'b', 3: 'c', 4: 'b', 5: 'b', 6: 'b', 7: 'b', 8: 'a', 9: 'b', 10: 'c', 11: 'b', 12: 'b', 13: 'c', 14: 'b', 15: 'a', [Q_TIMELINE]: true, [Q_LAMP_BUILDER]: true, [Q_RANKING]: true, 19: 'b', [Q_SORTING]: true };
    const questionTitles = [ "√âclairage dominant au XIXe s.", "R√©volution d'Edison (vid√©o)", "Points lumineux √† Paris (vid√©o)", "Fonctionnement lampe √† incandescence", "Diff√©rence lampe classique/halog√®ne", "Principe lampes √† d√©charge", "D√©fi environnemental majeur", "Innovation d'alimentation √©cologique", "R√¥le de l'√©clairage en Smart City", "√âconomie d'√©nergie avec les LED", "Technologie de d√©tection avanc√©e", "D√©fi futur de l'√©clairage", "Calcul d'efficacit√© lumineuse", "Calcul d'√©conomies de maintenance", "Calcul de % d'√©conomie d'√©nergie", "Timeline interactive de l'histoire", "Constructeur de lampadaire intelligent", "Classement d'Efficacit√©", "Mythe ou R√©alit√©", "Tri des Caract√©ristiques" ];
    const featureDetails = { wifi: { name: "Hotspot Wi-Fi / 5G", desc: "Diffuse un signal Wi-Fi ou 5G pour connecter les passants." }, air: { name: "Capteur qualit√© de l'air", desc: "Mesure les polluants (particules fines, NOx...) en temps r√©el." }, charge: { name: "Borne de recharge", desc: "Permet de recharger les voitures, scooters ou v√©los √©lectriques." }, camera: { name: "Cam√©ra de s√©curit√© IA", desc: "Assure la s√©curit√© et peut analyser les flux de pi√©tons/v√©hicules." }, speaker: { name: "Haut-parleur d'alerte", desc: "Diffuse des annonces d'urgence (alerte m√©t√©o, s√©curit√©...)." }, parking: { name: "D√©tection de parking", desc: "D√©tecte si une place de stationnement √† proximit√© est libre ou occup√©e." } };
    const badgeDetails = {
        history: { name: "Historien Pr√©cis", icon: "üï∞Ô∏è", description: "Terminer l'exercice de la timeline avec succ√®s" },
        smartcity: { name: "Ing√©nieur Smart City", icon: "üèôÔ∏è", description: "Construire un lampadaire intelligent avec succ√®s" },
        calculator: { name: "Calculateur Rapide", icon: "üßÆ", description: "R√©ussir les 3 questions de calcul" },
        expert: { name: "Expert Technique", icon: "üõ†Ô∏è", description: "R√©ussir les exercices interactifs (timeline, classement, tri...)" },
        streak: { name: "S√©rie Parfaite", icon: "üî•", description: "Obtenir 5 bonnes r√©ponses d'affil√©e" },
        curious: { name: "Curieux de Nature", icon: "üïµÔ∏è", description: "Explorer l'interface pendant le quiz (ouvrir stats, voir vid√©o...)" },
        perfect: { name: "Grand Chelem", icon: "üåü", description: "Obtenir un score parfait de 20/20" },
        sprinter: { name: "√âclair Rapide", icon: "‚ö°", description: "Terminer le quiz en moins de 10 minutes" }
    };
    
    // --- DOM Elements Cache ---
    const dom = {
        mainHeader: document.getElementById('mainHeader'), quizContent: document.querySelector('.quiz-content'),
        startScreen: document.getElementById('startScreen'), startQuizBtn: document.getElementById('startQuizBtn'), resumeBtn: document.getElementById('resumeBtn'),
        questionsWrapper: document.getElementById('questions-wrapper'),
        progressFill: document.getElementById('progressFill'), progressText: document.getElementById('progressText'), progressDotsContainer: document.getElementById('progressDots'),
        currentScore: document.getElementById('currentScore'), totalQuestionsDisplay: document.getElementById('totalQuestionsDisplay'),
        scoreProgressCircle: document.getElementById('scoreProgressCircle'),
        resultsScreen: document.getElementById('results'), liveScoreWidget: document.getElementById('liveScoreWidget'),
        statsModalOverlay: document.getElementById('statsModalOverlay'), modalCloseBtn: document.getElementById('modalCloseBtn'),
        videoWidget: document.getElementById('videoWidget'), videoPlayerContainer: document.getElementById('videoPlayerContainer'), videoStatusIcon: document.getElementById('videoStatusIcon'),
        toolWidget: document.getElementById('toolWidget'), homeBtn: document.getElementById('homeBtn'), toolResetBtn: document.getElementById('toolResetBtn'),
        timerDisplay: document.getElementById('timerDisplay'),
        keyboardHint: document.getElementById('keyboardHint'),
        themeToggle: document.getElementById('theme-toggle-switch'),
        homeResultsBtn: document.getElementById('homeResultsBtn'),
        resultsReviewBtn: document.getElementById('resultsReviewBtn'),
        reviewErrorsBtn: document.getElementById('reviewErrorsBtn'),
        resultsRestartBtn: document.getElementById('resultsRestartBtn'),
        modalBadgesGrid: document.getElementById('modalBadgesGrid')
    };

    // --- Core UI & Logic Functions ---
    function applyTheme(theme) { document.documentElement.setAttribute('data-theme', theme); dom.themeToggle.checked = (theme === 'light'); }
    function saveThemePreference(theme) { localStorage.setItem(themeStorageKey, theme); }
    function setupTheme() { const sT = localStorage.getItem(themeStorageKey); const pT = window.matchMedia('(prefers-color-scheme: light)').matches ? 'light' : 'dark'; applyTheme(sT || pT); dom.themeToggle.addEventListener('change', () => { const nT = dom.themeToggle.checked ? 'light' : 'dark'; applyTheme(nT); saveThemePreference(nT); }); }
    function showToast(title, message, icon) { const tc = document.getElementById('toast-container'); const t = document.createElement('div'); t.className = 'toast'; t.innerHTML = `<span style="font-size: 1.5em;">${icon}</span><div><strong>${title}</strong><div style="font-size:0.9em;">${message}</div></div>`; tc.appendChild(t); setTimeout(() => t.remove(), 4000); }
    
    function updateLiveScore() {
        dom.currentScore.textContent = score;
        const answeredCount = isAnswered.slice(1).filter(Boolean).length;
        const accuracy = answeredCount > 0 ? (score / answeredCount) * 100 : 0;
        dom.scoreProgressCircle.style.setProperty('--p', accuracy);
        dom.scoreProgressCircle.classList.add('updated-score');
        setTimeout(() => dom.scoreProgressCircle.classList.remove('updated-score'), 500);
    }
    
    function updateProgressDot(qNum, isCorrect) {
        const dot = dom.progressDotsContainer.children[qNum - 1];
        if (dot) { dot.classList.add('clickable', isCorrect ? 'completed-correct' : 'completed-incorrect'); }
    }

    function updateProgress() { const progress = totalQuestions > 1 ? ((currentQuestion - 1) / (totalQuestions - 1)) * 100 : 0; dom.progressFill.style.width = progress + '%'; dom.progressText.innerHTML = `Question <strong>${currentQuestion}</strong> / ${totalQuestions}`; Array.from(dom.progressDotsContainer.children).forEach((dot, i) => { dot.classList.remove('active'); if (i + 1 === currentQuestion) dot.classList.add('active'); }); }
    
    function startQuiz(isNewGame = true) {
        if (isNewGame) {
            localStorage.removeItem(quizSaveKey);
            currentQuestion = 1; score = 0; secondsElapsed = 0; currentStreak = 0; bestStreak = 0; 
            questionTimestamps = []; fastestAnswer = { time: Infinity, qNum: null };
            isReviewing = false; reviewingErrorsOnly = false;
            answers = new Array(totalQuestions + 1).fill(null);
            isAnswered = new Array(totalQuestions + 1).fill(false);
            q17_selections = [];
            // Reset visual state of cards
            document.querySelectorAll('.question-card').forEach(card => {
                card.querySelectorAll('.option').forEach(opt => {
                    opt.classList.remove('disabled', 'selected', 'correct', 'incorrect', 'glow');
                });
                const feedback = card.querySelector('.feedback');
                if (feedback) feedback.classList.remove('show', 'correct', 'incorrect');
            });
            startTimer();
        } else {
            updateTimerDisplay();
        }
        
        document.body.classList.remove('results-visible');
        document.body.classList.add('quiz-active'); 
        dom.startScreen.classList.add('hidden');
        dom.quizContent.classList.remove('hidden'); dom.mainHeader.classList.add('header-compact');
        showQuestion(currentQuestion, 'forward');
    }

    function resumeQuiz() {
        const savedProgress = localStorage.getItem(quizSaveKey); if (!savedProgress) { startNewQuiz(); return; }
        try {
            const p = JSON.parse(savedProgress);
            currentQuestion = p.currentQuestion; score = p.score; answers = p.answers; isAnswered = p.isAnswered; 
            secondsElapsed = Number(p.secondsElapsed) || 0; 
            currentStreak = p.currentStreak || 0; 
            bestStreak = p.bestStreak || 0;
            questionTimestamps = p.questionTimestamps || [];
            fastestAnswer = p.fastestAnswer || { time: Infinity, qNum: null };
            q17_selections = p.interactiveStates?.[`q${Q_LAMP_BUILDER}`] || [];
            curiosityTracker = p.curiosityTracker || { videoClicked: false, statsOpened: false, hintHovered: false };
            
            for (let i = 1; i <= totalQuestions; i++) { if (p.isAnswered[i]) { const isC = p.answers[i] === correctAnswers[i] || (INTERACTIVE_QUESTIONS.includes(i) && p.answers[i] === true); updateProgressDot(i, isC); } }
            updateLiveScore();
            startQuiz(false);
            startTimer();
        } catch (e) { console.error("Erreur de chargement de la progression.", e); localStorage.removeItem(quizSaveKey); startNewQuiz(); }
    }
    
    function startNewQuiz() {
        attemptCount++;
        localStorage.setItem(attemptCountKey, attemptCount);
        startQuiz(true);
    }

    function showQuestion(questionNumber, direction = 'forward') {
        const currentCard = document.querySelector('.question-card.active');
        if (currentCard) {
            if (direction === 'backward') {
                currentCard.classList.add('slide-out-right');
            } else {
                currentCard.classList.add('slide-out-left');
            }
            setTimeout(() => {
                currentCard.classList.remove('active', 'slide-out-left', 'slide-out-right', 'slide-from-left');
                displayNewQuestion(questionNumber, direction);
            }, 400);
        } else {
            displayNewQuestion(questionNumber, direction);
        }
    }
    
    function displayNewQuestion(questionNumber, direction) {
        dom.resultsScreen.classList.remove('show'); dom.quizContent.style.display = 'block';
        const card = document.querySelector(`[data-question="${questionNumber}"]`);
        if (card) {
            currentQuestion = parseInt(questionNumber, 10);
            if (!isAnswered[currentQuestion]) {
                questionTimestamps[currentQuestion] = { start: Date.now() };
            }

            const optionsContainer = card.querySelector('.options');
            if (optionsContainer && !isAnswered[currentQuestion]) {
                const options = Array.from(optionsContainer.children);
                for (let i = options.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [options[i], options[j]] = [options[j], options[i]];
                }
                optionsContainer.innerHTML = '';
                options.forEach((option, index) => {
                    const optionNumberSpan = option.querySelector('.option-number');
                    if(optionNumberSpan) { optionNumberSpan.textContent = index + 1; }
                    optionsContainer.appendChild(option);
                });
            }
            
            card.classList.remove('slide-out-left', 'slide-out-right'); 
            card.classList.add('active');
            if (direction === 'backward') { card.classList.add('slide-from-left'); } 
            else { card.classList.remove('slide-from-left'); }
            card.classList.toggle('review-mode-active', isReviewing);
            
            if(isAnswered[currentQuestion]) { renderAnsweredState(currentQuestion, answers[currentQuestion]); }

            const navContainer = card.querySelector('.nav-buttons');
            const prevBtn = navContainer.querySelector('.btn-nav:first-child'); 
            const nextBtn = navContainer.querySelector('.btn-nav:last-child');
            
            let isPrevDisabled = true; let isNextDisabled = true;
            if (isReviewing) {
                if (reviewingErrorsOnly) {
                    const currentIndexInErrors = errorIndices.indexOf(currentQuestion);
                    isPrevDisabled = currentIndexInErrors <= 0;
                    isNextDisabled = currentIndexInErrors >= errorIndices.length - 1;
                } else {
                    isPrevDisabled = currentQuestion <= 1;
                    isNextDisabled = currentQuestion >= totalQuestions;
                }
            } else {
                 isPrevDisabled = currentQuestion <= 1;
                 isNextDisabled = !isAnswered[currentQuestion];
            }
            prevBtn.disabled = isPrevDisabled;
            nextBtn.disabled = isNextDisabled;

            if (currentQuestion === totalQuestions && isAnswered[totalQuestions] && !isReviewing) { nextBtn.innerHTML = 'üèÜ'; nextBtn.title = 'Voir les r√©sultats'; } 
            else { nextBtn.innerHTML = '‚Üí'; nextBtn.title = 'Suivant (‚Üí)'; }
            
            updateProgress();
            const title = card.querySelector('.question-title'); if(title) title.focus({ preventScroll: true });
        }
    }
    
    function handleAnswer(questionNumber, selectedAnswer, element) { if (isAnswered[questionNumber]) return;
        const duration = Date.now() - questionTimestamps[questionNumber].start;
        questionTimestamps[questionNumber].duration = duration;
        
        isAnswered[questionNumber] = true; answers[questionNumber] = selectedAnswer; const isCorrect = correctAnswers[questionNumber] === selectedAnswer; if (isCorrect) { score++; currentStreak++; if(duration < fastestAnswer.time) { fastestAnswer = { time: duration, qNum: questionNumber }; } } else { currentStreak = 0; } if(currentStreak > bestStreak) { bestStreak = currentStreak; } updateLiveScore(); checkBadges(); const card = element.closest('.question-card'); card.querySelectorAll('.option').forEach(opt => opt.classList.add('disabled')); element.classList.add('selected'); if (element.getAttribute('role') === 'radio') element.setAttribute('aria-checked', 'true'); renderAnsweredState(questionNumber, selectedAnswer); const feedback = card.querySelector('.feedback'); feedback.focus(); feedback.scrollIntoView({ behavior: 'smooth', block: 'center' }); card.querySelector('.nav-buttons .btn-nav:last-child').disabled = false; saveProgress(); }
    
    function showResults(isFirstTime = true) {
        isReviewing = false; reviewingErrorsOnly = false;
        if (isFirstTime) { clearInterval(timerInterval); checkBadges(true); saveProgress(); }
        generateSummary(); 
        const categoryData = generateCategoryPerformance();
        document.body.classList.remove('quiz-active');
        document.body.classList.add('results-visible');
        dom.quizContent.style.display = 'none';
        dom.resultsScreen.classList.add('show');
        
        let message, description; const accuracy = score / totalQuestions;
        const scoreCircle = document.getElementById('scoreCircle');
        
        const finalTimeWidgetStrong = document.querySelector('#finalTimeWidget strong');
        const m = Math.floor(secondsElapsed / 60).toString().padStart(2, '0');
        const s = (secondsElapsed % 60).toString().padStart(2, '0');
        if(finalTimeWidgetStrong) finalTimeWidgetStrong.textContent = `${m}:${s}`;

        const attemptCounterWidgetStrong = document.querySelector('#attemptCounterWidget strong');
        if(attemptCounterWidgetStrong) attemptCounterWidgetStrong.textContent = attemptCount;

        if (accuracy >= 0.8) { message = 'üèÜ Visionnaire de la Smart City !'; description = 'Excellent ! Vous ma√Ætrisez parfaitement l\'√©volution de l\'√©clairage urbain.'; scoreCircle.style.background = `linear-gradient(135deg, var(--success-color), var(--accent-color))`; if (isFirstTime) triggerConfetti(); } 
        else if (accuracy >= 0.5) { message = 'üí° Technicien √âclair√©'; description = 'Bien jou√© ! Vous avez de solides connaissances. Continuez √† explorer !'; scoreCircle.style.background = `linear-gradient(135deg, var(--primary-color), var(--secondary-color))`; } 
        else { message = 'Novice de la Nuit'; description = 'C\'est un bon d√©but ! N\'h√©sitez pas √† revoir la vid√©o pour consolider vos acquis.'; scoreCircle.style.background = `linear-gradient(135deg, var(--error-color), #c0392b)`; }
        document.getElementById('scoreMessage').textContent = message; document.getElementById('scoreDescription').textContent = description;
        document.getElementById('personalizedFeedback').innerHTML = generatePersonalizedFeedback(categoryData);
        
        const firstErrorIndex = answers.slice(1).findIndex((ans, i) => ans !== null && ans !== correctAnswers[i + 1]);
        dom.reviewErrorsBtn.disabled = (firstErrorIndex === -1);
        dom.reviewErrorsBtn.title = (firstErrorIndex === -1) ? "F√©licitations, aucune erreur !" : "Aller √† votre premi√®re erreur";

        displayEarnedBadges(); 
        const resultsTitle = document.getElementById('results-title');
        window.scrollTo({ top: dom.resultsScreen.offsetTop, behavior: 'smooth' });
        resultsTitle.focus({ preventScroll: true });
        document.getElementById('scoreDisplay').textContent = `${score}/${totalQuestions}`;
    }

    function renderAnsweredState(qN, uA) { 
        const card = document.querySelector(`.question-card[data-question="${qN}"]`); if (!card) return; 
        const isC = correctAnswers[qN] === uA; 
        const f = card.querySelector('.feedback'); 
        updateProgressDot(qN, isC); 
        f.classList.add(isC ? 'correct' : 'incorrect', 'show'); 
        
        if (card.querySelector('.option')) { 
            card.querySelectorAll('.option').forEach(o => { 
                o.classList.add('disabled'); 
                const oA = o.dataset.answer; 
                if(oA === uA) o.classList.add('selected', isC ? 'correct' : 'incorrect'); 
                const isCorrectAnswer = oA === correctAnswers[qN];
                if(isCorrectAnswer) o.classList.add('correct'); 
                if(!isC && isCorrectAnswer) o.classList.add('glow');
            }); 
        } else {
            const container = card.querySelector('.interactive-question-container'); 
            const autocompleteBtn = card.querySelector('.btn-autocomplete');
            if (autocompleteBtn) autocompleteBtn.style.display = 'none';
    
            if (container) {
                container.classList.add('disabled');
                
                const markItems = (selector, checkLogic) => {
                   card.querySelectorAll(selector).forEach(item => {
                       if (item.parentElement.classList.contains('dropzone')) {
                           const isItemCorrect = checkLogic(item);
                           item.classList.add(isItemCorrect ? 'correct' : 'incorrect');
                       }
                   });
                };

                if (qN === Q_TIMELINE) markItems('#q16-container .draggable-item', item => item.parentElement.dataset.target === item.dataset.id);
                if (qN === Q_RANKING) markItems('#q18-container .draggable-item', item => ['led', 'sodium', 'incandescent'][parseInt(item.parentElement.dataset.rank) - 1] === item.dataset.id);
                if (qN === Q_SORTING) markItems('#q20-container .draggable-item', item => item.parentElement.dataset.target === item.dataset.category);
            }

            if (qN === Q_LAMP_BUILDER) {
                q17_selections.forEach(id => { const el = card.querySelector(`.feature-option[data-id="${id}"]`); if(el) el.classList.add('selected'); }); 
                const dL = document.getElementById('q17-description-list'); const dB = document.getElementById('q17-description-box'); 
                dL.innerHTML = q17_selections.map(id => `<li>‚úÖ <b>${featureDetails[id].name}:</b> ${featureDetails[id].desc}</li>`).join(''); 
                dB.style.display = 'block'; 
                card.querySelectorAll('.feature-option').forEach(el => el.classList.add('disabled')); 
            }
        } 
    }
    
    // --- Navigation & Helper Functions ---
    function nextQuestion(e) {
        const btn = e.currentTarget;
        if (btn.disabled) return;
        if (reviewingErrorsOnly) {
            const currentIndexInErrors = errorIndices.indexOf(currentQuestion);
            if (currentIndexInErrors < errorIndices.length - 1) {
                showQuestion(errorIndices[currentIndexInErrors + 1], 'forward');
            } else {
                showResults(false);
            }
        } else {
            currentQuestion < totalQuestions ? showQuestion(currentQuestion + 1, 'forward') : showResults(true);
        }
    }

    function previousQuestion(e) {
        const btn = e.currentTarget;
        if (btn.disabled) return;
        if (reviewingErrorsOnly) {
            const currentIndexInErrors = errorIndices.indexOf(currentQuestion);
            if (currentIndexInErrors > 0) {
                showQuestion(errorIndices[currentIndexInErrors - 1], 'backward');
            }
        } else {
            if (currentQuestion > 1) showQuestion(currentQuestion - 1, 'backward');
        }
    }
    
    function generateSummary() { const sc = document.getElementById('summaryContent'); sc.innerHTML = questionTitles.map((t, i) => { const n = i + 1; const isCorrect = answers[n] === correctAnswers[n]; let resultHtml = `<span class="summary-result ${isCorrect ? 'correct' : 'incorrect'}">${isCorrect ? '‚úÖ' : '‚ùå'}</span>`; if (!isAnswered[n]) { resultHtml = `<span class="summary-result" style="background: var(--secondary-text-color)">--</span>`; } else if (!isCorrect) { let cAT = ''; const cAV = correctAnswers[n]; if (typeof cAV === 'boolean') { cAT = 'R√©ponse interactive'; } else { const oE = document.querySelector(`.question-card[data-question="${n}"] .option[data-answer="${cAV}"]`); if (oE) { cAT = `R: ${oE.innerText.trim().substring(2)}`; } } if (cAT) { resultHtml += `<small style="margin-left: 10px; color: var(--secondary-text-color);">${cAT}</small>`; } } return `<div class="summary-item" data-question-index="${n}" data-correct="${isAnswered[n] ? isCorrect : 'none'}" role="button" tabindex="0"><span>Q${n}. ${t}</span><div>${resultHtml}</div></div>`; }).join(''); const h = e => { const i = e.target.closest('.summary-item'); if(i && (e.type === 'click' || e.key === 'Enter')) reviewQuestion(i.dataset.questionIndex); }; sc.addEventListener('click', h); sc.addEventListener('keydown', h); }
    
    function reviewQuestions() { 
        isReviewing = true; 
        reviewingErrorsOnly = false; 
        document.body.classList.remove('results-visible');
        document.body.classList.add('quiz-active'); 
        showQuestion(1, 'forward'); 
    }
    
    function reviewErrors() {
        isReviewing = true; 
        reviewingErrorsOnly = true;
        errorIndices = answers.map((ans, i) => (i > 0 && ans !== null && ans !== correctAnswers[i]) ? i : -1).filter(i => i !== -1);
        if(errorIndices.length > 0) {
            document.body.classList.remove('results-visible');
            document.body.classList.add('quiz-active');
            showQuestion(errorIndices[0], 'forward');
        }
    }

    function returnToStartScreen() {
        document.body.classList.remove('quiz-active', 'results-visible');
        dom.resultsScreen.classList.remove('show');
        dom.quizContent.classList.add('hidden');
        dom.startScreen.classList.remove('hidden');
        dom.mainHeader.classList.remove('header-compact');
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function reviewQuestion(questionIndex) { isReviewing = true; reviewingErrorsOnly = false; document.body.classList.remove('results-visible'); document.body.classList.add('quiz-active'); showQuestion(parseInt(questionIndex, 10), 'forward'); }
    function navigateToQuestion(index) { showQuestion(parseInt(index, 10), index > currentQuestion ? 'forward' : 'backward'); }

    function restartQuiz() { if (confirm("√ätes-vous s√ªr de vouloir tout r√©initialiser et recharger la page ? Vos badges ne seront pas affect√©s.")) { localStorage.removeItem(quizSaveKey); location.reload(); } }
    
    function triggerConfetti() { const c = document.getElementById('confetti-container'); if (!c) return; c.innerHTML = ''; const s = getComputedStyle(document.documentElement); const cl = [s.getPropertyValue('--primary-color'), s.getPropertyValue('--secondary-color'), s.getPropertyValue('--accent-color'), s.getPropertyValue('--success-color')]; for (let i = 0; i < 150; i++) { const e = document.createElement('div'); e.classList.add('confetti'); e.style.left = `${Math.random() * 100}%`; e.style.backgroundColor = cl[Math.floor(Math.random() * cl.length)]; e.style.animationDelay = `${Math.random() * 2}s`; e.style.animationDuration = `${3 + Math.random() * 2}s`; e.style.transform = `rotate(${Math.random() * 360}deg)`; c.appendChild(e); } }
    function saveProgress() { const p = { currentQuestion, score, answers: answers.slice(), isAnswered: isAnswered.slice(), interactiveStates: { [`q${Q_LAMP_BUILDER}`]: q17_selections.slice() }, secondsElapsed, currentStreak, bestStreak, questionTimestamps, fastestAnswer, curiosityTracker }; try { localStorage.setItem(quizSaveKey, JSON.stringify(p)); } catch (e) { console.error("Sauvegarde impossible:", e); } }

    // --- Badges, Stats & Modals ---
    function getEarnedBadgeCount() { return Object.values(badges).filter(Boolean).length; }
    function updateBadgeCountDisplay() { const earned = getEarnedBadgeCount(); const total = Object.keys(badgeDetails).length; const badgeCountEl = document.getElementById('badgeCount'); if (badgeCountEl) { badgeCountEl.textContent = `${earned} / ${total}`; } }
    function checkCuriosityBadge() { if (badges.curious || dom.resultsScreen.classList.contains('show') || [curiosityTracker.videoClicked, curiosityTracker.statsOpened, curiosityTracker.hintHovered].filter(Boolean).length < 2) return; badges.curious = true; showToast("Badge d√©bloqu√© !", badgeDetails.curious.description, badgeDetails.curious.icon); localStorage.setItem(badgeStorageKey, JSON.stringify(badges)); updateBadgeCountDisplay(); }
    function checkBadges(isFinalCheck = false) { let newBadgeEarned = false; if(currentStreak > bestStreak) { bestStreak = currentStreak; } const c = { history: () => answers[Q_TIMELINE] === true, smartcity: () => answers[Q_LAMP_BUILDER] === true, calculator: () => [13, 14, 15].every(q => answers[q] === correctAnswers[q]), expert: () => [Q_TIMELINE, Q_RANKING, Q_SORTING].every(q => answers[q] === true), streak: () => bestStreak >= 5, perfect: () => isFinalCheck && score === totalQuestions, sprinter: () => isFinalCheck && secondsElapsed < 600 }; for (const b in c) { if (!badges[b] && c[b]()) { badges[b] = true; newBadgeEarned = true; const d = badgeDetails[b]; if (d) showToast("Badge d√©bloqu√© !", d.description, d.icon); } } if(newBadgeEarned) { localStorage.setItem(badgeStorageKey, JSON.stringify(badges)); updateBadgeCountDisplay(); } }
    function displayEarnedBadges() { const container = document.getElementById('badges-earned'); container.innerHTML = Object.keys(badgeDetails).map(id => `<div class="badge-earned-item ${!badges[id] ? 'unearned' : ''}"><span class="badge-icon">${badgeDetails[id].icon}</span><p>${badgeDetails[id].name}</p><span role="tooltip" class="tooltip-text">${badgeDetails[id].description}</span></div>`).join(''); document.getElementById('badgesEarnedContainer').style.display = 'block'; }
    function openStatsModal() { 
        curiosityTracker.statsOpened = true; checkCuriosityBadge(); 
        const aC = isAnswered.slice(1).filter(Boolean).length; 
        document.getElementById('statsAnswered').textContent = `${aC} / ${totalQuestions}`; 
        document.getElementById('statsAccuracy').textContent = `${aC > 0 ? Math.round((score / aC) * 100) : 0}%`; 
        document.getElementById('statsCurrentStreak').textContent = currentStreak;
        document.getElementById('statsBestStreak').textContent = bestStreak;
        
        const answeredTimes = questionTimestamps.filter(t => t && t.duration).map(t => t.duration);
        const avgTime = answeredTimes.length > 0 ? (answeredTimes.reduce((a, b) => a + b, 0) / answeredTimes.length / 1000).toFixed(2) : '--';
        document.getElementById('statsAvgTime').textContent = `${avgTime} s`;

        const fastestQEl = document.getElementById('statsFastestQ');
        if (fastestAnswer.qNum !== null) {
            const fastTime = (fastestAnswer.time / 1000).toFixed(2);
            fastestQEl.innerHTML = `Q${fastestAnswer.qNum} en <strong>${fastTime}s</strong>`;
        } else {
            fastestQEl.textContent = '--';
        }
        
        dom.modalBadgesGrid.innerHTML = Object.keys(badgeDetails).map(id => { const isUnlocked = badges[id]; return `<div class="badge-earned-item ${!isUnlocked ? 'unearned' : ''}"> <div class="badge-icon">${badgeDetails[id].icon}</div> <p>${badgeDetails[id].name}</p> <span role="tooltip" class="tooltip-text">${badgeDetails[id].description}</span> </div>`; }).join(''); 
        dom.statsModalOverlay.classList.add('show'); 
    }
    function closeStatsModal() { dom.statsModalOverlay.classList.add('hiding'); dom.statsModalOverlay.addEventListener('animationend', () => { dom.statsModalOverlay.classList.remove('show', 'hiding'); }, { once: true }); }
    
    function generateCategoryPerformance() {
        const categories = {};
        document.querySelectorAll('.question-card[data-category]').forEach(card => {
            const cat = card.dataset.category.replace(/<[^>]*>/g, '').trim();
            const qNum = parseInt(card.dataset.question, 10);
            if (!categories[cat]) { categories[cat] = { total: 0, correct: 0, name: cat }; }
            categories[cat].total++;
            if (answers[qNum] === correctAnswers[qNum]) { categories[cat].correct++; }
        });

        const container = document.getElementById('category-performance-list');
        container.innerHTML = Object.values(categories).map(data => {
            const percentage = data.total > 0 ? (data.correct / data.total) * 100 : 0;
            return `
                <div class="category-perf-item">
                    <span class="category-perf-name">${data.name}</span>
                    <div class="category-perf-bar-container">
                        <div class="category-perf-score">${data.correct} / ${data.total}</div>
                        <div class="category-perf-bar">
                            <div class="category-perf-fill" style="width: ${percentage}%;"></div>
                        </div>
                    </div>
                </div>`;
        }).join('');
        
        document.getElementById('categoryPerformanceContainer').style.display = 'block';
        return Object.values(categories);
    }
    
    function generatePersonalizedFeedback(categoryData) {
        if (!categoryData || categoryData.length < 2) return "";
        let bestCat = { score: -1, name: ''};
        let worstCat = { score: 2, name: ''};
        categoryData.forEach(cat => {
            const catScore = cat.correct / cat.total;
            if (catScore > bestCat.score) bestCat = { score: catScore, name: cat.name };
            if (catScore < worstCat.score) worstCat = { score: catScore, name: cat.name };
        });
        if (bestCat.name && worstCat.name && bestCat.name !== worstCat.name && bestCat.score > worstCat.score) {
            return `üí° Excellent travail sur la cat√©gorie "${bestCat.name}" ! Vous pourriez approfondir vos connaissances sur "${worstCat.name}".`;
        }
        return "";
    }

    // --- Interactive Questions Logic ---
    function setupInteractiveQuestions() { const dS = e => { draggedItem = e.target; setTimeout(() => e.target.classList.add('dragging'), 0); }; const dE = () => { if(draggedItem) { draggedItem.classList.remove('dragging'); draggedItem = null; } }; const dO = e => { e.preventDefault(); e.currentTarget.classList.add('over'); }; const dL = e => e.currentTarget.classList.remove('over'); const dH = (e, cF, cFn) => { e.preventDefault(); e.currentTarget.classList.remove('over'); if (draggedItem && cFn(e.currentTarget)) { e.currentTarget.appendChild(draggedItem); cF(); } }; document.querySelectorAll('.draggable-item').forEach(i => { i.addEventListener('dragstart', dS); i.addEventListener('dragend', dE); }); document.querySelectorAll('.dropzone').forEach(z => { z.addEventListener('dragover', dO); z.addEventListener('dragleave', dL); }); document.querySelectorAll('#q16-container .dropzone, #q16-events').forEach(z => z.addEventListener('drop', e => dH(e, checkQ16Completion, t => t.classList.contains('dropzone') ? t.children.length === 0 : true))); document.querySelectorAll('#q18-container .dropzone, #q18-source').forEach(z => z.addEventListener('drop', e => dH(e, checkQ18Completion, t => t.classList.contains('dropzone') ? t.children.length === 0 : true))); document.querySelectorAll('#q20-container .dropzone').forEach(z => z.addEventListener('drop', e => dH(e, checkQ20Completion, () => true))); const q17H = e => { const f = e.target.closest('.feature-option:not(.disabled)'); if (f && (e.type === 'click' || e.key === 'Enter' || e.key === ' ')) { if(e.type !== 'click') e.preventDefault(); toggleFeatureSelection(f); } }; dom.questionsWrapper.querySelector(`#q${Q_LAMP_BUILDER}-builder`).addEventListener('click', q17H); dom.questionsWrapper.querySelector(`#q${Q_LAMP_BUILDER}-builder`).addEventListener('keydown', q17H); document.querySelectorAll('.btn-autocomplete').forEach(btn => btn.addEventListener('click', e => { const qN = parseInt(e.target.closest('.question-card').dataset.question, 10); handleAutoComplete(qN); })); }
    function checkInteractiveQuestion(qN, c, fI, cI, iCF) { if (!c || isAnswered[qN]) return;
        const container = document.getElementById(cI); const iAC = iCF(container); isAnswered[qN] = true; answers[qN] = iAC; if (iAC) { score++; currentStreak++; } else { currentStreak = 0; } if(currentStreak > bestStreak) { bestStreak = currentStreak; } updateLiveScore(); checkBadges(); renderAnsweredState(qN, iAC); const f = document.getElementById(fI); f.focus(); f.scrollIntoView({ behavior: 'smooth', block: 'center' }); const nextBtn = document.querySelector(`.question-card[data-question="${qN}"] .nav-buttons .btn-nav:last-child`); if(nextBtn) nextBtn.disabled = false; saveProgress(); }
    function checkQ16Completion() { checkInteractiveQuestion(Q_TIMELINE, document.getElementById('q16-events').children.length === 0, 'feedback16', 'q16-container', () => { let cC = 0; document.querySelectorAll('#q16-container .dropzone').forEach(z => { const i = z.children[0]; if(i && z.dataset.target === i.dataset.id) cC++; }); return cC === 4; }); }
    function toggleFeatureSelection(feature) { if (isAnswered[Q_LAMP_BUILDER]) return; feature.classList.toggle('selected'); q17_selections = Array.from(document.querySelectorAll(`#q${Q_LAMP_BUILDER}-builder .feature-option.selected`)).map(el => el.dataset.id); if (q17_selections.length >= 4) { checkQ17Completion(); } }
    function checkQ17Completion() { if (isAnswered[Q_LAMP_BUILDER]) return; const isC = q17_selections.length >= 4; if (isC) { checkInteractiveQuestion(Q_LAMP_BUILDER, true, `feedback${Q_LAMP_BUILDER}`, `q${Q_LAMP_BUILDER}-builder`, () => true); } }
    function checkQ18Completion() { checkInteractiveQuestion(Q_RANKING, document.getElementById('q18-source').children.length === 0, `feedback${Q_RANKING}`, `q${Q_RANKING}-container`, () => { const cO = ['led', 'sodium', 'incandescent']; const uO = Array.from(document.querySelectorAll(`#q${Q_RANKING}-container .ranking-slot .dropzone .draggable-item`)).map(i => i.dataset.id); return JSON.stringify(cO) === JSON.stringify(uO); }); }
    function checkQ20Completion() { checkInteractiveQuestion(Q_SORTING, document.getElementById('q20-source').children.length === 0, `feedback${Q_SORTING}`, `q${Q_SORTING}-container`, () => { const aI = Array.from(document.querySelectorAll(`#q${Q_SORTING}-container .dropzone[data-target] .draggable-item`)); return aI.length === 6 && aI.every(i => i.dataset.category === i.parentElement.dataset.target); }); }
    
    function handleAutoComplete(qN) { if (isAnswered[qN]) return; 
        isAnswered[qN] = true; answers[qN] = true; 
        currentStreak = 0; 
        if(currentStreak > bestStreak) { bestStreak = currentStreak; }
        updateLiveScore(); checkBadges(); 
        const card = document.querySelector(`.question-card[data-question="${qN}"]`); 
        const f = card.querySelector('.feedback'); 
        const nextBtn = card.querySelector('.nav-buttons .btn-nav:last-child'); 
        card.querySelector('.btn-autocomplete').style.display = 'none'; 
        showCorrectInteractiveSolution(qN); 
        f.classList.add('correct', 'show'); 
        const fT = f.querySelector('.feedback-title'); 
        const fE = f.querySelector('.feedback-explanation'); 
        if (fT) fT.textContent = "Voil√† la solution !"; 
        if (fE) fE.innerHTML = "La bonne r√©ponse est affich√©e. Prenez le temps de l'analyser.<br><strong>Aucun point n'est attribu√© pour cette question.</strong>"; 
        updateProgressDot(qN, true);
        const container = card.querySelector('.interactive-question-container'); 
        if (container) container.classList.add('disabled'); 
        f.focus(); f.scrollIntoView({ behavior: 'smooth', block: 'center' }); 
        if (nextBtn) nextBtn.disabled = false; 
        saveProgress(); 
    }
    function showCorrectInteractiveSolution(qN) { const card = document.querySelector(`.question-card[data-question="${qN}"]`); if (!card) return; const actions = { [Q_TIMELINE]: () => ['gaz', 'edison', 'led', 'smart'].forEach((id, i) => { const item = card.querySelector(`.draggable-item[data-id="${id}"]`); const target = card.querySelector(`.timeline-slot:nth-child(${i + 1}) .dropzone`); if(item && target) target.appendChild(item); }), [Q_RANKING]: () => ['led', 'sodium', 'incandescent'].forEach((id, i) => { const item = card.querySelector(`.draggable-item[data-id="${id}"]`); const target = card.querySelector(`.dropzone[data-rank="${i + 1}"]`); if(item && target) target.appendChild(item); }), [Q_SORTING]: () => card.querySelectorAll('.draggable-item').forEach(item => { const cat = item.dataset.category; const target = card.querySelector(`.dropzone[data-target="${cat}"]`); if(target) target.appendChild(item); }) }; if (actions[qN]) actions[qN](); card.querySelectorAll('.draggable-item').forEach(i => i.classList.add('correct'));}

    // --- Timer & Video ---
    function updateTimerDisplay() {
        const m = Math.floor(secondsElapsed / 60).toString().padStart(2, '0');
        const s = (secondsElapsed % 60).toString().padStart(2, '0');
        const t = `${m}:${s}`;
        if(dom.timerDisplay) dom.timerDisplay.textContent = t;
        const statsTime = document.getElementById('statsTime');
        if(statsTime) statsTime.textContent = t;
    }

    function startTimer() { 
        if (timerInterval) clearInterval(timerInterval);
        updateTimerDisplay(); // Display initial time immediately
        timerInterval = setInterval(() => { 
            secondsElapsed++; 
            updateTimerDisplay();
        }, 1000); 
    }

    window.onYouTubeIframeAPIReady = function() {
        isYouTubeApiReady = true;
        while(youtubeApiQueue.length) {
            youtubeApiQueue.shift()();
        }
    };
    function createPlayer() {
        if (videoPlayer) {
            videoPlayer.playVideo();
            return;
        }
        curiosityTracker.videoClicked = true;
        checkCuriosityBadge();
        
        dom.videoPlayerContainer.classList.add('player-loading');
        
        const createAction = () => {
            dom.videoPlayerContainer.classList.remove('player-loading');
            dom.videoPlayerContainer.classList.add('player-active');
            dom.videoPlayerContainer.innerHTML = '<div id="player-iframe"></div>';
            videoPlayer = new YT.Player('player-iframe', {
                height: '100%',
                width: '100%',
                videoId: 'GRwOsXCW2jM',
                playerVars: { 'autoplay': 1, 'rel': 0, 'controls': 1 },
                events: { 'onStateChange': e => { dom.videoStatusIcon.textContent = (e.data === YT.PlayerState.PLAYING) ? 'üé∂' : 'üé¨'; } }
            });
        };
        
        if (isYouTubeApiReady || (window.YT && window.YT.Player)) {
            isYouTubeApiReady = true;
            createAction();
        } else {
            youtubeApiQueue.push(createAction);
        }
    }

    // --- Event Listeners & Initialization ---
    function setupEventListeners() {
        dom.startQuizBtn.addEventListener('click', startNewQuiz);
        dom.resumeBtn.addEventListener('click', resumeQuiz);
        dom.toolResetBtn.addEventListener('click', restartQuiz);
        dom.homeBtn.addEventListener('click', returnToStartScreen);
        dom.homeResultsBtn.addEventListener('click', returnToStartScreen);
        dom.resultsReviewBtn.addEventListener('click', reviewQuestions);
        dom.reviewErrorsBtn.addEventListener('click', reviewErrors);
        dom.resultsRestartBtn.addEventListener('click', () => {
            localStorage.removeItem(quizSaveKey);
            location.reload();
        });

        dom.questionsWrapper.addEventListener('click', e => {
            const option = e.target.closest('.option:not(.disabled)');
            if (option) {
                const qCard = option.closest('.question-card');
                const qNum = parseInt(qCard.dataset.question, 10);
                handleAnswer(qNum, option.dataset.answer, option);
            }
            const tsBtn = e.target.closest('.video-timestamp-hint button[data-timestamp]');
            if (tsBtn) {
                if (videoPlayer && typeof videoPlayer.seekTo === 'function') {
                    if (dom.videoWidget.classList.contains('minimized')) dom.videoWidget.classList.remove('minimized');
                    videoPlayer.seekTo(parseInt(tsBtn.dataset.timestamp, 10), true);
                    videoPlayer.playVideo();
                } else {
                    showToast("Vid√©o non lanc√©e", "Veuillez d'abord lancer la vid√©o pour utiliser cette fonctionnalit√©.", "üé¨");
                }
            }
        });
        
        dom.questionsWrapper.addEventListener('keydown', e => {
            if (e.key === 'Enter' || e.key === ' ') {
                 const option = e.target.closest('.option:not(.disabled)');
                 if (option) { e.preventDefault(); option.click(); }
            }
        });

        document.addEventListener('click', e => {
            if (e.target.matches('.review-banner .btn-link-review')) { showResults(false); }
            const dot = e.target.closest('.progress-dot.clickable');
            if (dot) navigateToQuestion(parseInt(dot.dataset.questionIndex, 10));
        });

        document.addEventListener('keydown', e => { if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return; const k = e.key; if (k === 'ArrowRight') { e.preventDefault(); document.querySelector('.question-card.active .nav-buttons .btn-nav:last-child')?.click(); } else if (k === 'ArrowLeft') { e.preventDefault(); document.querySelector('.question-card.active .nav-buttons .btn-nav:first-child')?.click(); } else if (['1', '2', '3', '4'].includes(k)) { const aC = document.querySelector('.question-card.active'); if (aC && aC.querySelector('.option:not(.disabled)')) { const optionNode = aC.querySelector(`.options .option:nth-child(${k})`); if (optionNode && !optionNode.classList.contains('disabled')) { e.preventDefault(); optionNode.click(); } } } else if (k === 'Escape' && dom.statsModalOverlay.classList.contains('show')) { closeStatsModal(); } });
        dom.liveScoreWidget.addEventListener('click', openStatsModal); dom.keyboardHint.addEventListener('mouseover', () => { curiosityTracker.hintHovered = true; checkCuriosityBadge(); }, { once: true });
        dom.videoPlayerContainer.addEventListener('click', createPlayer);
        dom.modalCloseBtn.addEventListener('click', closeStatsModal);
        dom.statsModalOverlay.addEventListener('click', e => { if (e.target === dom.statsModalOverlay) closeStatsModal(); });
        document.getElementById('minimizeBtn').addEventListener('click', (e) => { e.stopPropagation(); dom.videoWidget.classList.toggle('minimized'); });
        dom.videoWidget.addEventListener('click', () => { if (dom.videoWidget.classList.contains('minimized')) dom.videoWidget.classList.remove('minimized'); });
        
        document.querySelector('.summary-filters').addEventListener('click', e => {
            const filterBtn = e.target.closest('button[data-filter]');
            if (!filterBtn) return;
            document.querySelectorAll('.summary-filters button').forEach(b => b.classList.remove('active'));
            filterBtn.classList.add('active');
            const filter = filterBtn.dataset.filter;
            document.querySelectorAll('.summary-item').forEach(item => {
                const itemCorrectState = item.dataset.correct;
                let show = false;
                if (filter === 'all' || itemCorrectState === 'none') {
                    show = true;
                } else if (filter === 'correct' && itemCorrectState === 'true') {
                    show = true;
                } else if (filter === 'incorrect' && itemCorrectState === 'false') {
                    show = true;
                }
                item.classList.toggle('hidden', !show);
            });
        });
    }
    
    function init() {
        totalQuestions = document.querySelectorAll('.question-card').length;
        attemptCount = parseInt(localStorage.getItem(attemptCountKey), 10) || 0;
        const savedBadges = localStorage.getItem(badgeStorageKey);
        if(savedBadges) {
            try { badges = JSON.parse(savedBadges); } catch(e) { console.error("Error parsing badges", e); }
        }
        
        answers = new Array(totalQuestions + 1).fill(null);
        isAnswered = new Array(totalQuestions + 1).fill(false);
        dom.totalQuestionsDisplay.textContent = totalQuestions;

        dom.progressDotsContainer.innerHTML = questionTitles.map((title, i) =>
            `<div class="progress-dot" data-question-index="${i + 1}">
                <span class="tooltip-text">${i + 1}. ${title}</span>
             </div>`
        ).join('');

        dom.questionsWrapper.querySelectorAll('.question-card .nav-buttons').forEach(c => {
            c.innerHTML = `<button class="btn-nav" title="Pr√©c√©dent (‚Üê)" aria-label="Pr√©c√©dent" disabled>‚Üê</button> <button class="btn-nav" title="Suivant (‚Üí)" aria-label="Suivant" disabled>‚Üí</button>`;
            c.querySelector('.btn-nav:first-child').addEventListener('click', previousQuestion);
            c.querySelector('.btn-nav:last-child').addEventListener('click', nextQuestion);
        });
        
        setupTheme();
        setupEventListeners();
        setupInteractiveQuestions();
        updateBadgeCountDisplay();
        
        const savedProgress = localStorage.getItem(quizSaveKey);
        if(savedProgress) { dom.resumeBtn.style.display = 'inline-flex'; dom.startQuizBtn.textContent = 'Recommencer'; dom.startQuizBtn.classList.replace('btn-primary', 'btn-secondary'); dom.resumeBtn.classList.replace('btn-secondary', 'btn-primary'); }
        
        updateLiveScore();
    }
    
    document.addEventListener('DOMContentLoaded', init);
    })();
    </script>
</body>
</html>
